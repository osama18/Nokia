/*
 * Copyright (C) 2012, Nokia gate5 GmbH Berlin
 *
 * These coded instructions, statements, and computer programs contain
 * unpublished proprietary information of Nokia gate5 GmbH, and are
 * copy protected by law. They may not be disclosed to third parties
 * or copied or duplicated in any form, in whole or in part, without
 * the specific, prior written permission of Nokia gate5 GmbH.
 */
(function(h,c,a,f,g){var d=g.call([]);if(!h.isArray)h.isArray=function(b){return g.call(b)===d};if(!a.trim)a.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")};if(!c.bind)c.bind=function(b){var e=this,d;return 1<arguments.length?(d=f.call(arguments,1),function(){return e.apply(b,arguments.length?d.concat(f.call(arguments)):d)}):function(){return arguments.length?e.apply(b,arguments):e.call(b)}};window.history.pushState||function(b,e){function d(b,c,a,g){history_js.setStorage(a,{state:b,
title:c});history_js.hash=a;g?(a||(a=e.hash||"#"),e.replace(a)):e.hash=a}if(!("pushState"in b.history))history_js={},"sessionStorage"in b&&b.JSON?(history_js.setStorage=function(e,d){b.sessionStorage[e]=JSON.stringify(d)},history_js.getStorage=function(e){return b.sessionStorage[e]?JSON.parse(b.sessionStorage[e]):void 0}):(history_js.fake_storage={},history_js.setStorage=function(e,b){history_js.fake_storage[e]=b},history_js.getStorage=function(e){return history_js.fake_storage[e]}),b.history.pushState=
function(e,b,c){d(e,b,c,!1)},b.history.replaceState=function(e,b,c){d(e,b,c,!0)},history_js.hashchange=function(){var d=e.hash;if(d!==history_js.hash)history_js.hash=d,d=history_js.hash?history_js.getStorage(history_js.hash):{},"onpopstate"in b&&"function"===typeof b.onpopstate&&b.onpopstate.apply(b,[{state:d?d.state:null}])},"onhashchange"in b?b.onhashchange=history_js.hashchange:history_js.hashInterval=setInterval(function(){e.hash!==history_js.hash&&history_js.hashchange()},100),e.hash&&history_js.hashchange()}(window,
document.location)})(Array,Function.prototype,String.prototype,[].slice,{}.toString);
(function(){if(!this.nokia||!this.nokia.mh5){var h={},c={},a=a||this.mh5Config||{};nokia=this.nokia||{};nokia.mh5=this.nokia.mh5={assetsPath:"",win:a.win||this,doc:a.doc||this.document,modulePaths:a.modulePaths||{},buildNS:function(c){var e;for(var c=c.split("."),a=0,d=nokia.mh5.win,b;b=c[a++];)e=d[b]=d[b]||{isNs:!0},d=e;return d},provide:function(a){c[a]=1;return nokia.mh5.buildNS(a)},require:function(a){if(c[a])return nokia.mh5.resolve(a);if(h[a])throw Error("Circular Reference in require chain: "+
h);h[a]=1;nokia.mh5.buildNS(a);var g=nokia.mh5.getLoadPath(a);try{nokia.mh5._getScript(g)}catch(d){throw Error("Could not load "+a+", reason: "+d.message);}finally{delete h[a]}c[a]||(c[a]=1);return nokia.mh5.resolve(a)},_getScript:function(a){var c=new XMLHttpRequest;c.open("GET",a,!1);c.send(null);var d=c.status;if(!(!d&&location&&"file:"===location.protocol||200<=d&&300>d||304===d||1223===d||0===d))throw Error("Unable to load "+a+" status: "+c.status);return nokia.mh5.win.eval(c.responseText)},
getLoadPath:function(a,c){var d=nokia.mh5.modulePaths[a];if(!d)for(var b=a.split("."),e=b.pop(),o=[];b.length;){d=b.join(".");if(d=nokia.mh5.modulePaths[d]){d+=o.join("/");d+="/"!==d.charAt(d.length-1)?"/"+e:e;break}o.splice(0,0,b.pop())}return d+("."+(c||"js"))}};nokia.mh5.modulePaths["nokia.mh5"]=nokia.mh5.modulePaths["nokia.mh5"]||function(){for(var a=document.getElementsByTagName("script"),c=0,d=/(^|\/|\\)core[\.\w]*?\.js$/i,b="",e,o,i;e=a[c++];)if(e=e.src||"",o=e.match(d)){if(-1===e.indexOf("://")){b=
nokia.mh5.win.location.href;i=b.indexOf("#");var h=b.indexOf("?");i=i>h&&-1<h?h:i;b=-1<i?b.substring(0,i):b;b=b.substring(0,b.lastIndexOf("/")+1)}i=b+e.substring(0,o.index);i="/"===i.charAt(i.length-1)?i:i+"/"}return i}()}}).call(this);
nokia.mh5.each=function(h,c,a){if(!h)return null;var f=0,g=h.length,d,a=a||h;if("number"!==typeof g||"[object Object]"===Object.prototype.toString.call(h)&&!(g-1 in h))for(d in h){if(h.hasOwnProperty(d)&&!1===c.call(a,h[d],d,h))break}else for(d=h[0];f<g&&!1!==c.call(a,d,f,h);d=h[++f]);return h};
nokia.mh5.extend=function(h,c){for(var a=Object,f=a.defineProperty,g=a.getOwnPropertyNames,a=a.getOwnPropertyDescriptor,d=[].slice.call(arguments,1),b=0,e=d.length,o,i,j,l,m;b<e;++b)for(c=d[b],l=c?g(c):[],o=0,i=l.length;o<i;++o)j=l[o],(m=a(c,j))?m.enumerable&&("function"!==typeof c||"prototype"!==j)&&f(h,j,m):h[j]=c[j];return h};
nokia.mh5.extendDeep=function(h,c){for(var a in c)if(c.hasOwnProperty(a))if(c[a]&&h[a]&&"object"===typeof h[a]&&!Array.isArray(h[a])){var f=h[a];h[a]={};nokia.mh5.extend(h[a],f);nokia.mh5.extendDeep(h[a],c[a])}else c[a]&&"object"===typeof c[a]&&!Array.isArray(c[a])?(h[a]={},nokia.mh5.extendDeep(h[a],c[a])):h[a]=c[a];return h};
nokia.mh5.type=function(h){return null===h&&"null"||void 0===h&&"undefined"||h.callee&&"arguments"||"object"===typeof h&&"number"===typeof h.length&&!h.propertyIsEnumerable("length")&&"array"||h instanceof Date&&"date"||typeof h};nokia.mh5.resolve=function(h,c){c=c||nokia.mh5.win;return!h?c:h.split(".").reduce(function(a,c){return a&&a[c]},c)};
nokia.mh5.Class=function(h){function c(c,i){var h=!i,l;h?i=typeof c===b?c():c:typeof i===b&&(i=i(c[g]));l=e.call(i,f)?i[f]:!h?function(){c.apply(this,arguments)}:function(){};h?(a.prototype=i,l[g]=new a):(nokia.mh5.extend(l,c),a[g]=c[g],nokia.mh5.extend(l[g]=new a,i));l[g][f]=l;e.call(i,d)&&nokia.mh5.extend(l,i[d]);return l}var a=function(){},f="constructor",g="prototype",d="statics",b="function",e=h.Object[g].hasOwnProperty;c[g]=h.Function[g];return c}(this);nokia.mh5.buildNS("nokia.mh5.i18n_languages");
nokia.mh5.i18n_languages.en={"Error.applicationCredential":"appId or appCode is missing. Please apply for API credentials at http://nka.fi/EvZeT.","Error.controlProperty":"Control property is not defined","Error.prepareBindings":"%value% can't be bound because %snmspa% can't be resolved","Error.propertyCannotBeOverwritten":"Property: '%name%' cannot be overwritten","Error.customContentNotAllowed":"You can't use custom content with the name %name% because it's already in use","Error.unableToRemove":"Removing '%name%' is not possible",
"Error.routeTooLong":"Walking routes aren't available for routes longer than %maxWalkingDistance%.","Error.tooLongWalkingDistance":"Your destination isn't within walking distance of your current location.","Warning.placeId":"`id` property in place object was changed to `placeId`","Notification.addedToFavourites":"Added to your Favourites","Notification.cantFindLocation":"Can't find your location. Please enter your starting point above.","Notification.connectionError":"Please check your connection and try again",
"Notification.destInWalkingDistance":"Destination is within walking distance","Notification.error":"There was a problem","Notification.favouritesNoSaved":"Couldn't save Favourite","Notification.goOnline":"Connect to internet to search for places and addresses","Notification.goOnlineForRouting":"Connect to internet to get a route","Notification.goOnlinePlaceHolder":"Connect to internet to search","Notification.lookingForCurrentPosition":"Finding your current location","Notification.noGPSSignal":"Can't find your current location",
"Notification.noModeAvailable":"%mode% mode is unavailable","Notification.noPublicTransportService":"Public transport routing isn't available here","Notification.noResult":"No results","Notification.noResultFound":"No results found","Notification.noRoutingService":"Sorry. Routes aren't available just now. Please try later.","Notification.offRoute":"You seem to be off route by %value%","Notification.placeRemovedByOwner":"Sorry.<br>We don't have any info about this place anymore.","Notification.placeError":"Couldn't show you this place just now. <br>Please try later.",
"Notification.positionNotAvailable":"Can't find your current location","Notification.removedFromFavourites":"Removed from your Favourites","Notification.routeCalculation":"Getting your route","Notification.searchProblem":"There's a problem at the moment. Please try searching again later.","Notification.serverError":"Sorry. There's a problem on our end. Please search again later.","Notification.unableToLoadImage":"Couldn't load the image","Notification.trafficInBeta":"Traffic view is still in beta.",
eating:"Eating out",shopping:"Shopping","going-out":"Going out",sights:"Sights",maps:"Views",layers:"Traffic",mapControl:"Map control",mapTermsOfUse:"Terms of Use",about:"About",beta:"beta",basic:"basic",businessOwner:"Business owner",call:"Call",cancel:"Cancel",done:"Done",favourite:"Favourite",favourites:"Favourites",feedback:"Feedback",from:"From",guides:"Guides",highest:"highest",hr:"hr",min:"min",km:"km",location:"location",minApprox:"min approx",more:"More",nearbyPlaces:"Nearby places",ok:"Ok",
place:"place",refresh:"Refresh",retry:"Retry",reviews:"Reviews",route:"Route",save:"Save",search:"Search",searchPlaces:"Search for places",searching:"Searching",send:"Send",sending:"Sending",signin:"Sign in",signout:"Sign out",share:"Share",source:"Source",start:"Start",submit:"Submit",take:"Take",hi:"Hi %name%!",thankYou:"Thank you.",to:"To",towards:"towards",web:"Web",welcome:"Welcome!",sms:"SMS",tel:"tel",email:"Email",shareVia:"share via",imagesProvidedBy:"Images from ",contentProvidedBy:"Content from ",
openingTimes:"Opening hours",placeDescription:"Place description",followFor:"Follow for",saveMapArea:"Save a map area",paymentMethods:"Payment methods",PT:"Public transport",addingA:"Adding a",removingA:"Removing a",currentLocation:"Current location",messageHere:"Message here",shareAPlace:"Share a place","EP.idLikeTo":"Hey, here's something for you to check out on Nokia Maps.","SMS.plsEnterNum":"Please enter the recipient's number<br />(including country code, e.g. +441234567890)","SMS.plsCheckNum":"Please check the phone number",
"SMS.alsoShort":"Add a short message (if you want to):","SMS.enterCaptcha":"Enter here the characters you see below","SMS.wrongCaptcha":"Please try another security code","SMS.enterCode":"Enter the code here","SMS.unableToSend":"Couldn't send your message. Please try again later.","FV.startSaving":"Start saving them now!","FV.startSavingHint":"The places you love are at your fingertips when you add them to your Favourites.","FV.takeAllFavourites":"Sign in and take your Favourites with you.","FV.simplyTap":"Just tap the blue star on the place page.",
"FV.tapTheHighlighted":"Tap the yellow star, and the place is no longer in your list.","FV.syncing":"Syncing","FV.syncedFavourites":"Everything is synced","FV.addedButUnsyncedFavourites":"Added but not yet synced","FV.addedNotSignedIn":"Added to Favourites","FV.addedSignedIn":"Added to Favourites and syncing","FV.removedNotSignedIn":"Removed from Favourites","FV.removedSignedIn":"Removed from Favourites and syncing","FV.signInToSyncronize":"Sign in to sync","FV.couldNotSync":"Couldn't sync","RA.arriveAt":"Arrive at",
"RA.departFrom":"Depart from","RA.drive":"drive","RA.walk":"walk","RA.walkTo":"Walk to","RA.disclaimer":"Transport information is provided by local transport agencies and is subject to change. More detailed and up-to-date information on schedules and services may be available on the agency website:","UI.SettingsDialog.mapView":"Map view","UI.SettingsDialog.satView":"Satellite view","UI.SettingsDialog.PTView":"Public transport view","UI.SettingsDialog.trafficView":"Live traffic view","UI.SettingsDialog.Km":"Kilometres",
"UI.SettingsDialog.Miles":"Miles","UI.SettingsDialog.Accidents":"Accidents","UI.SettingsDialog.Congestions":"Congestion","UI.SettingsDialog.Constructions":"Construction","UI.SettingsDialog.Others":"Other","UI.SettingsDialog.CommunityMaps":"Community view","UI.SettingsDialog.CommunityMapFootnote":"Community maps are living maps - created and updated by users all over the world","maps.BP.bookmark":"To get the most from Nokia Maps, add our app as a bookmark to your home screen.","maps.BP.install":"To install the app, tap the button %dir% and then 'Add to Home Screen'.",
"maps.CVD.details":"Level of detail you can expect:","maps.CVD.viewDetails":"Level of detail in current view:","maps.CVD.tooLarge":"This area is too large. Move and zoom to centre on the neighbourhood you want to save.","maps.CVD.goOnline":"You need a data connection to save the map.","maps.CVD.rangeOfDetails":"Here's the range of detail you can see in saved map areas. Keep in mind, the more detail you want, the smaller the area of your map.","maps.CVD.world":"Basic details","maps.CVD.country":"Some details",
"maps.CVD.city":"Average details","maps.CVD.district":"Lots of details","maps.CVD.street":"Maximum details","maps.CVD.worldDesc":"See continents, countries, cities, motorways, road numbers and forests","maps.CVD.countryDesc":"See countries, cities, districts, motorways, main streets, road numbers, airports, forests and lakes","maps.CVD.cityDesc":"See cities, districts, detailed street grids, railways &amp; stations, major public transport, parks and lakes","maps.CVD.districtDesc":"See districts, more detailed street grids, railways, all public transport, buildings, parks and paths",
"maps.CVD.streetDesc":"See all streets and names, railways, all public transport, all buildings, parks and paths","maps.SPD.startDownload":"Start your download","maps.SPD.savingArea":"Saving your map area","maps.SPD.instructionStart":"Map downloads can be large, so remember to use Wi-Fi.<br><br>Don't close this app while saving your map, and make sure your screensaver doesn't switch on.","maps.SPD.instructionLoad":"Map downloads can be large, so remember to use Wi-Fi.<br><br>Don't close this app while saving your map, and make sure your screensaver doesn't switch on.",
"maps.SPD.instructionFinished":"Your map's been saved.<br>You can find it now in your springboard.<br><br><span style='font-weight: bold'>Keep in mind that saving a new map area always replaces the last one you saved.</span>","maps.SPD.keepInMind":"Keep in mind that saving a new map area always replaces the last one you saved.","maps.SPD.minZoom":"Your min zoom level","maps.SPD.maxZoom":"Your max zoom level","maps.SPD.waiting":"Waiting for download to start","maps.SPD.smtUnexpected":"There was a problem during the download.",
"maps.SB.saveMap":"Save a map area","maps.SB.viewMap":"View your saved map","maps.NPS.recommend":"How likely are you to recommend Nokia Maps to a friend or colleague?","maps.NPS.notLikely":"Not at all likely","maps.NPS.extremelyLikely":"Extremely likely","maps.NPS.why":"Please tell us why you gave this score","maps.NPS.enterMessage":"Enter message here...","maps.NPS.email":"Enter email address","maps.NPS.NPP":'Your information will be treated according to the <a href="http://nokia.mobi/privacy/policy" target="blank">Nokia Privacy Policy</a>.',
"maps.NPS.noSend":"Unable to send. Please try again.","maps.NPS.contact":"Nokia can contact me for details","maps.Nav.headDirectionforDistance":"Head %direction% for %distance%","maps.Nav.reachedDestination":"You have reached your destination","maps.Nav.speeding":"If you're still walking, you walk very fast! Navigation will start again when you've slowed down.","maps.Nav.tryAgain":"The download didn't work","maps.Nav.disclaimerTitle":"Using audio directions","maps.Nav.disclaimerPoint1":"Be aware of your surroundings and keep an eye open for cars and other urban challenges.",
"maps.Nav.disclaimerPoint2":"Make sure your phone's display doesn't go dark, or you might not be able to hear the navigation instructions clearly. Also, be sure to download a voice file first (1.9MB).","maps.Nav.disclaimerPoint3":"Using Nokia services may involve large amounts of data moving through your service provider's network. Not all services may be available or 100% accurate all the time. Using this service could also involve sending information about your location.","maps.Nav.disclaimerPoint4":'By tapping \'Load audio\', you confirm that you have read and agree to the <a href="http://nokia.mobi/privacy/services/terms/nokia-service" onclick="event.stopPropagation();" target="blank">Nokia Service Terms</a> and <a href="http://nokia.mobi/privacy/policy" onclick="event.stopPropagation();" target="blank">Privacy Policy</a>. For more information <a href="http://nokia.mobi/privacy/services/map-apps" onclick="event.stopPropagation();" target="blank">click here</a>.',
"maps.Nav.success":"Download finished","maps.Nav.load":"Load audio","maps.Nav.start":"Start journey","maps.Traffic.incidentDescription":"on %origin% towards %direction%","maps.Traffic.incidentDescriptionNoDirection":"on %origin%","maps.Traffic.incidentAt":"at %start%","maps.Traffic.incidentUnidir":"from %start% to %end%","maps.Traffic.incidentBidir":"between %start% and %end%","maps.Traffic.incidentStartTime":"Start time","maps.Traffic.incidentEndTime":"Approx end time","maps.Traffic.incidentDateFormat":"%month%/%day%/%year% %hour%:%minute%",
"maps.Traffic.criticalityTitle":"Severity","maps.Traffic.critical":"Critical","maps.Traffic.major":"Major","maps.Traffic.minor":"Minor"};nokia.mh5.provide("nokia.mh5.utils");
(function(h){function c(d,b){return void 0!==this[b]?this[b]:""}var a={},f=h.localStorage||{getItem:function(d){return f["_"+d]},setItem:function(d,b){f["_"+d]=b}},g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};nokia.mh5.utils={place:{getCategoryIconForFav:function(d){var b={accommodation:"01",hotel:"01",motel:"01",hostel:"01",camping:"14","business-services":"02","atm-bank-exchange":"15","police-emergency":"19","post-office":"20","tourist-information":"21","petrol-station":"18","car-rental":"17",
"car-dealer-repair":"16","travel-agency":"02","communication-media":"02","business-industry":"02",service:"02","eat-drink":"03",restaurant:"03","snacks-fast-food":"03","bar-pub":"22","coffee-tea":"23",facilities:"04","hospital-health-care-facility":"26","government-community-facility":"25","education-facility":"04",library:"27","fair-convention-facility":"24","parking-facility":"28","toilet-rest-area":"29","sports-facility-venue":"30",facility:"04","going-out":"05","dance-night-club":"33",cinema:"32",
"theatre-music-culture":"05",casino:"31","administrative-areas-buildings":"06","administrative-region":"06","city-town-village":"35","street-square":"06","outdoor-area-complex":"06",building:"06","leisure-outdoor":"07",recreation:"07","amusement-holiday-park":"34","natural-geographical":"08","body-of-water":"36","mountain-hill":"08","undersea-feature":"08","forest-heath-vegetation":"08",shopping:"09","kiosk-convenience-store":"09",mall:"09","department-store":"09","food-drink":"09",bookshop:"09",
pharmacy:"37","electronics-shop":"09","hardware-house-garden-shop":"09","clothing-accessories-shop":"09","sport-outdoor-shop":"09",shop:"09","sights-museums":"10","landmark-attraction":"38",museum:"10","religious-place":"39",transport:"11",airport:"40","railway-station":"43","public-transport":"11","ferry-terminal":"41","taxi-stand":"42"};return(b[d]?b[d]:"06")+"_01.icon.mh5.basic.png"},getCategoryIcon:function(d){var b=nokia.mh5.assetsPath+"img/categories/",e;if(d.categoryIcon)return d.categoryIcon;
if(!d.icon)d.icon="06.icon";e=d.icon.match(/((\d+)(_\d{2})?\.icon)/);b+=d.favourite&&!e[4]?e[2]+"_01.icon":e[1];return b+".mh5.basic.png"},categoryIdentifier:function(){for(var d=["business-services",["service",215,207,258,"business-services",269,"atm-bank-exchange",47,"car-rental",20,"car-dealer-repair",2,46,51,56,"travel-agency",277,"communication-media",278,"business-industry",5],"transport",["transport",272,218,53,"airport",43,"railway-station",41,"public-transport",58,"ferry-terminal",35,"taxi-stand",
216],"shopping",["food-drink",143,"shop",23,"shopping",270,142,23,"clothing-accessories",205,"clothing-accessories-shop",205,"mall",24,"department-store",189,"electronics",196,"electronics-shop",196,"hardware-house-garden",194,"hardware-house-garden-shop",194,"bookshop",276,"sport-outdoor-shop",191,"kiosk-24-7-convenience-store",197,"kiosk-convenience-store",197],"accommodation",["accommodation",271,"hostel",173,"hotel",38,"motel",174,"camping",32],"going-out",["going-out",274,"dance-or-night-club",
203,"dance-night-club",203,"casino",3,"cinema",4,"theatre-music-culture",181],"facilities",["facilities",261,212,268,"facility",261,212,"fair-convention-facility",7,"government-or-community-facility",12,"government-community-facility",12,"library",31,"parking-facility",39],"natural-geographical",["natural-geographical",265,"body-of-water",262,"mountain-or-hill",45,"undersea-feature",260,"forest-heat-or-other-vegetation",259,"forest-heath-vegetation",259],"administrative-areas-buildings",["administrative-region",
279,"city-town-or-village",283,"city-town-village",283,"outdoor-area-complex",263,"building",280,"administrative-areas-buildings",266],"eat-drink",["bar-pub",33,"eat-drink",275,"restaurant",22,"coffee-tea",63,"snacks-fast-food",64],"leisure-outdoor",["amusement-or-holiday-park",1,"amusement-holiday-park",1,"leisure-outdoor",267,"recreation",48],"sights-museums",["sights-museums",273,213,"landmark-attraction",27,211,213,163,153,150,147,148,149,184,"museum",14],"address",["address",284],"religious-place",
["religious-place",158],"pharmacy",["pharmacy",49],"education-facility",["education-facility",106],"hospital-health-care-facility",["hospital-or-health-care-facility",200,209,"hospital-health-care-facility",200,209],"sport-facility-venue",["sport-outdoor",220,"sports-outdoor",220,"sport-facility-venue",220,"sports-facility-venue",220],"police-emergency",["police-emergency",40],"post-office",["post-office",19],"tourist-information",["tourist-information",28],"petrol-station",["petrol-station",17]],
b={},e={},c=[].indexOf,a=[].forEach,g=function(d){var a=""+this;"number"==typeof d&&9E6>d&&(e[d+9E6]=a,b.hasOwnProperty(a)||(b[a]=[]),0>c.call(b[a],d+9E6)&&b[a].push(d+9E6));e[d]=a},f=0,h=d.length;f<h;f+=2)a.call(d[f+1],g,d[f]);return function(d,a){var c=e[d];return a?b[c].join(","):c}}()},getLocalStorageValue:function(d){return f.getItem(d)},setLocalStorageValue:function(d,b){try{f.setItem(d,b)}catch(e){return!1}return!0},formatString:function(d,b){return d.replace(/%([^%]+)%/g,c.bind(b))},escapeHTML:function(d){return(""+
d).replace(/&(?!\w+;)|[<>"']/g,function(b){return g[b]||b})},cacheObject:function(d,b){if(void 0===b)return a[d];a[d]=b},purify:function(d){if(!(d instanceof Object))return d;var b={},e;for(e in d)if(d.hasOwnProperty(e)&&!("_bindings"===e||d[e]instanceof HTMLElement))b[e]=d[e];return b},formatDistance:function(d,b){return"mi"==b?161>=d?10*Math.round(3.281*d/10)+"ft":(160900>d?(d/1609).toFixed(1):Math.round(d/1609))+"mi":1E3>d?Math.round(d)+"m":(1E5>d?(d/1E3).toFixed(1):Math.round(d/1E3))+"km"},formatTime:function(d){var b=
Math.round(d/60);return 20<b&&55>b?5*Math.ceil(b/5)+"min":55<=b?0.5*Math.ceil(d/1800)+"hr":b+"min"},formatURLParams:function(d){return Object.keys(d).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(d[b]+"")}).join("&")},isPlace:function(d){return!(!d.placeId||!d.placeId.match(/([\w\d]{8}-[\w\d]{32})/))}}})(this);nokia.mh5.provide("nokia.mh5.i18n");
nokia.mh5.i18n=function(){function h(e,b){if(e in f)return e=f[e],b?a(e,b):e}var c=/\/(combined\.js|mh5\.js|src\/).*$/,a=nokia.mh5.utils.formatString,f={},g=this,d,b;[].forEach.call(document.querySelectorAll("script"),function(e){!b&&c.test(e.src)&&(b=e.src.replace(c,"")+"/lang/")});Object.defineProperty(h,"language",{get:function(){return d},set:function(e){d=e;g.nokia_mh5_i18n=nokia.mh5.i18n_languages[e];f=g.nokia_mh5_i18n;delete g.nokia_mh5_i18n;nokia.mh5.utils.setLocalStorageValue("nokia.mh5.i18n",
d)}});"nokia_mh5_i18n"in g?(f=g.nokia_mh5_i18n,delete g.nokia_mh5_i18n):h.language=nokia.mh5.utils.getLocalStorageValue("nokia.mh5.i18n")||"en";return h}.call(this);nokia.mh5.provide("nokia.mh5.jsonp");
nokia.mh5.jsonp=function(){var h=0,c=window.document,a;return function(f,g,d){var b="MH5_"+h++,e=c.createElement("script"),o=function(){try{delete window[b]}catch(d){window[b]=null}e.parentNode.removeChild(e)},i=setTimeout(function(){window[b].call(this,{error:"timeout"})},~~d||15E3);nokia.mh5.event.add(e,"error",function(){});a||(a=c.head||c.getElementsByTagName("head")[0]||c.documentElement);window[b]=function(){o();clearTimeout(i);g.apply(this,arguments)};a.insertBefore(e,a.lastChild).src=f+"="+
b;return{uri:f,timeout:d,cancel:function(){clearTimeout(i);return e&&e.parentNode?(window[b]=o,!0):!1}}}}();nokia.mh5.provide("nokia.mh5.connectors.story.StoryAdapter");
(function(){var h=nokia.mh5.i18n,c="",a="initializing";nokia.mh5.connectors.story.StoryAdapter={msgList:{"000":h("Notification.connectionError"),"010":h("Notification.connectionError"),"020":h("Notification.serverError"),207:h("Notification.serverError"),400:h("Notification.serverError"),403:h("Notification.connectionError"),404:h("Notification.connectionError"),412:h("Notification.connectionError"),500:h("Notification.serverError")},createShareLink:function(a){return link=a.placeId?"http://maps.nokia.com/services/place/"+
a.placeId:"http://maps.nokia.com/map="+a.latitude+","+a.longitude+",16/title="+encodeURIComponent(a.name)},shortLink:function(a,c){nokia.mh5.jsonp("http://m.maps.nokia.com/releases/1.8.0/server/ushare/short.php?longUrl="+encodeURIComponent(a)+"&jsonp",function(d){c(d?d.shortUrl:"")})},init:function(f){if("initialized"!=a){var g=function(d){var b=d||{};!d||b.error||!b.sectoken?(b.success=!1,b.errorMessage=this.msgList["000"]):(b.success=!!(200==b.retCode||403==b.retCode),b.success?(c=b.sectoken,a=
"initialized"):b.errorMessage=this.msgList[b.retCode+""]);f(b)}.bind(this);nokia.mh5.jsonp("http://m.maps.nokia.com/releases/1.8.0/server/ushare/auth.php?jsonp",g)}else f({success:!0})},_getState:function(){return a},getCaptcha:function(f){if("initialized"==a){var g=function(d){var b=d||{};if(d.error)b.success=!1,b.errorMessage=this.msgList["000"];else if(b.success=200==b.result.retCode,!b.success)b.errorMessage=this.msgList[b.result.retCode+""];f(b)}.bind(this);nokia.mh5.jsonp("http://m.maps.nokia.com/releases/1.8.0/server/ushare/captcha.php?sectoken="+
c+"&jsonp",g)}else f({success:!1,errorMessage:this.msgList["010"]})},share:function(f,g){g.url=nokia.mh5.connectors.story.StoryAdapter.createShareLink(g.place);var d="";if("initialized"==a){var b;b=function(e){var b=e||{};if(!e||e.error)b.success=!1,b.errorMessage=this.msgList["000"],f(b);else if(b.success=200==b.result.retCode,!b.success)b.errorMessage=this.msgList[b.result.retCode+""];f(b)}.bind(this);switch(g.targets){case "default@sm":d="http://m.maps.nokia.com/releases/1.8.0/server/ushare/share.php?sectoken="+
c+"&version=1.1&captchaId="+encodeURIComponent(g.captcha.captchaId)+"&captchaVerifyText="+encodeURIComponent(g.captcha.captchaVerifyText)+"&targets=default@sm&type="+encodeURIComponent(g.type)+"&msg="+encodeURIComponent(g.msg)+"&participantSMSPhone="+encodeURIComponent(g.participantSMSPhone)+"&phoneNumber=&title="+encodeURIComponent(g.title)+"&url="+encodeURIComponent(g.url)+(g.place.placeId?"&shareDataObj="+this.encodeShareData(g.place):"");break;case "default@vk":case "default@fb":case "default@tw":case "default@gb":case "default@me":d=
"http://m.maps.nokia.com/releases/1.8.0/server/ushare/share.php?sectoken="+c+"&version=1.1&targets="+g.targets+"&type="+encodeURIComponent(g.type)+"&title="+encodeURIComponent(g.title)+"&url="+encodeURIComponent(g.url)+"&shareDataObj="+this.encodeShareData(g.place);break;default:f({success:!1,errorMessage:this.msgList["020"]})}nokia.mh5.jsonp(d+"&jsonp",b)}else f({success:!1,errorMessage:this.msgList["010"]})},encodeShareData:function(a){return encodeURIComponent(JSON.stringify(a.placeId?{serviceName:"Nokia Maps",
serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name,shareString2:a.address,shareString3:a.categoryGroup+" / "+a.category,shareString4:"",shareString5:a.phone},location:{placesId:a.placeId,latitude:""+a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}:{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name},location:{placesId:"",latitude:""+
a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}))}}})();nokia.mh5.provide("nokia.mh5.platform");
(function(h){var c=h.navigator,a=c.userAgent.toLowerCase(),f=a.match(/\w{2}-\w{2}/)&&RegExp.lastMatch||c.language||c.browserLanguage,g=nokia.mh5.win.location.href,d=h.outerHeight*h.outerWidth/(h.devicePixelRatio||1),d=/lo=tablet/.test(g)||!/lo=phone/.test(g)&&!/ip(?:hone|od)/.test(a)&&(/gt-p1000/.test(a)||614400<d||/iPad/.test(c.platform)),f=f.toLowerCase();nokia.mh5.platform={iphone:/iPhone/.test(c.platform),ipod:/iPod/.test(c.platform),ipad:/iPad/.test(c.platform),ios:/(iPhone)|(iPod)|(iPad)/.test(c.platform),
android:/android/.test(a),playbook:/playbook/.test(a),blackberry:/blackberry/.test(a),tablet:d,phone:!d,android_webview:!!nokia.mh5.win.android_js_interface,n9:/nokian9/.test(a),ios_webview:/(iPhone)|(iPod)|(iPad)/.test(c.platform)&&/phonegap/.test(a),ie:/msie/.test(a),language:f||c.language.toLowerCase()||c.browserLanguage,backButton:/back=on/.test(g),cssTransform3dSupported:function(){var b=nokia.mh5.doc.createElement("div"),e=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective",
"msPerspective"],d=!1,a;for(a in e)if(e[a]in b.style){d=!0;break}b.className="mh5_cssTransform3dTest";nokia.mh5.doc.body.appendChild(b);d=d&&"relative"===nokia.mh5.win.getComputedStyle(b,null).position;b.parentNode&&b.parentNode.removeChild(b);return d}(),hideAddressBar:function(b){var e="undefined"==typeof h.orientation||0===h.orientation||180==h.orientation,d;if(nokia.mh5.platform.iphone||nokia.mh5.platform.ipod)h.document.body.style.minHeight=(e?416:268)+"px",d=setTimeout(function(){clearTimeout(d);
h.scrollTo(0,0)},0);else if(nokia.mh5.platform.android)var a=setTimeout(function(){clearTimeout(a);b&&"orientationchange"===b.type&&h.scrollTo(0,0);var e=h.devicePixelRatio;if(!e||1>e)e=0.9;h.document.body.style.minHeight=h.outerHeight/e+"px";d=setTimeout(function(){clearTimeout(d);h.scrollTo(0,1)},1)},nokia.mh5.platform.hideAddressBar.DELAY)}};nokia.mh5.platform.hideAddressBar.DELAY=200;if(nokia.mh5.platform.ios)nokia.mh5.platform.ios={io4:-1!==a.indexOf("os 4_"),io5:-1!==a.indexOf("os 5_")};if(nokia.mh5.platform.android)c=
/android ([0-9].[0-9])/.exec(a),a=/(Chrome)/.exec(a),nokia.mh5.platform.android={version:c&&0<c.length&&c[1],browser:a?"chrome":"default"};nokia.mh5.platform.undetectable=!(nokia.mh5.platform.ios||nokia.mh5.platform.android||nokia.mh5.platform.blackberry||nokia.mh5.platform.playbook)})(this);nokia.mh5.provide("nokia.mh5.event");
nokia.mh5.event&&nokia.mh5.event.fire||function(h){function c(e){var b=e.replace(y,"");return function(d,a,c,g){if(!x.call(p,"on"+a)||!1!==p["on"+a](b,d,a,c,g))d[e](x.call(M,a)?M[a]:a,c,g)}}function a(e,b,d,a){e==B?u(e,b,d,a):A.push("add",e,b,d,a)}function f(e,b,d,a){e==B?v(e,b,d,a):A.push("remove",e,b,d,a)}function g(e){h[this](e,b,!0);h.documentElement[this](e,b,!0)}function d(e,b,d,a,c){var g=h.createEvent("Event");g.initEvent(x.call(M,b)?M[b]:b,x.call(d,"bubbles")?!!d.bubbles:a,x.call(d,"cancelable")?
!!d.cancelable:c);g.data=d;g.name=b;e.dispatchEvent(g);return g}function b(b){var i=(b.touches||[b])[0].target,b=/^touch/.test(b.type);if(A){if(!b&&(/input/i.test(i.nodeName)||nokia.mh5.platform.android))b="ontouchend"in h;E.forEach(g,w);Object.defineProperty(p,"isTouch",{value:b});M=p.isTouch?{down:"touchstart",move:"touchmove",up:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup"};M.press=M.down;M.release=M.up;K=u;G=v;J=d;e(z);i=0;for(b=A.length;i<b;i+=5)if("string"==typeof A[i])p[A[i]](A[i+
1],A[i+2],A[i+3],A[i+4]);else J(A[i],A[i+1],A[i+2],A[i+3],A[i+4]);c=E=a=f=g=A=null}}function e(e){var b=p.isTouch,b={type:n,mouse:!b,touch:b};for(z=null;e.length;)e.shift()(b)}function o(e,b,d){"function"==typeof e.handleEvent?e.handleEvent(this):e.call(this.target,this);this.stopped&&d.splice(0,d.length)}function i(){this.stopped=!0}function j(){this.defaultPrevented=!0}var l=["insertedintodocument"],m="__evt__"+Math.random(),n="pointerdetect",p={one:function(e,b,d,a){[].concat(b).forEach(function(b){p.add(e,
b,function R(c){p.remove(e,b,R,a);o.call(c,d)},a)});return p},add:function(b,d,a,c){[].concat(d).forEach(function(d){if(!b||b===B||b instanceof C)if(d===n)z?z.push(a):e([a]);else if(~l.indexOf(d))p["on"+d]("add",b,d,a,c);else K(b,d,a,!!c);else{var g=b[m]||(b[m]={}),g=g[d]||(g[d]=[]);0>g.indexOf(a)&&g.push(a)}});return p},remove:function(e,b,d,a){[].concat(b).forEach(function(b){if(!e||e===B||e instanceof C)if(b===n)z&&(b=z.indexOf(d),~b&&z.splice(b,1));else if(~l.indexOf(b))p["on"+b]("remove",e,b,
d,a);else G(e,b,d,!!a);else{var c=e[m]||(e[m]={}),c=c[b]||(c[b]=[]),b=c.indexOf(d);~b&&c.splice(b,1)}});return p},fire:function(e,b,d,a,c){var g;[].concat(b).forEach(function(b){!e||e===B||e instanceof C?g=J(e||B,b,d||{},null==a?!0:!!a,null==c?!0:!!c):((e[m]||{})[b]||[]).slice(0).forEach(o,g={target:e,currentTarget:e,type:b,data:d,stopPropagation:d&&d.stopPropagation||i,preventDefault:d&&d.preventDefault||j})});return g}},x=p.hasOwnProperty,B=h.defaultView,C=B.Node||B.HTMLElement,E="touchstart,touchmove,touchend,mousedown,mousemove,mouseup,mousewheel,DOMMouseScroll".split(","),
y="EventListener",F="add"+y,w="remove"+y,A=[],z=[],u=c(F),v=c(w),K=a,G=f,J=function(e,b,a,c,g){e==B?d(e,b,a,c,g):A.push(e,b,a,c,g)},M={};E.forEach(g,F);Object.defineProperty(nokia.mh5,"event",{writable:!1,configurable:!1,enumerable:!0,value:Object.defineProperties(p,{add:{value:p.add},remove:{value:p.remove},fire:{value:p.fire}})})}(nokia.mh5.doc);nokia.mh5.provide("nokia.mh5.dom");
(function(h){function c(e){if(!h.jstestdriver)return e.stopPropagation(),!1}function a(e){e=d.defaultView.getComputedStyle(e,null);return 1E3*(parseFloat(e.getPropertyValue("-webkit-transition-duration")||e.getPropertyValue("-moz-transition-duration")||e.getPropertyValue("transition-duration"))||0)}var f=h.RegExp,g=nokia.mh5.doc.body,d=h.document;d.addEventListener("touchstart",function(){},!0);var b=nokia.mh5.dom={touchStart:"down",touchMove:"move",touchEnd:"up",contains:function(e,b){return e.contains?
e.contains(b):!!(e.compareDocumentPosition(b)&16)},isNativeScrollingSupported:function(){return!1},dimensions:function(e){return"scrollTo"in e&&e.document?(e=e.document.documentElement,{width:e.clientWidth,height:e.clientHeight}):{width:e.offsetWidth,height:e.offsetHeight}},addClass:function(e,d){b.hasClass(e,d)||(e.className+=(e.className?" ":"")+d)},hasClass:function(e,b){return(new f("(?:^|\\s+)"+b+"(?:\\s+|$)","g")).test(e.className)},removeClass:function(){for(var e=1,b=arguments.length,d=arguments[0];e<
b;e++)d.className=d.className.replace(new f("(?:^|\\s+)"+arguments[e]+"(\\s+|$)","g"),"$1").trim()},addEvent:nokia.mh5.event.add,removeEvent:nokia.mh5.event.remove,fireEvent:nokia.mh5.event.fire,query:function(e,b){return Array.prototype.slice.call((b||d).querySelectorAll(e))},byId:function(b,a){return(a||d).getElementById(b)},createHyperlinkHTML:function(b,d){for(var a="",c=Object.keys(b),g=0;g<c.length;g++)var f=c[g],a=a+(f+"='"+b[f]+"' ");b.target||(a+="target='_blank' ");return"<a "+(a+'onclick="if(event._fake) {event.preventDefault();event.stopPropagation()};"')+
">"+(d?d:"")+"</a>"},transition:function(){var b,d=arguments.length,f,h;"function"===typeof arguments[d-1]&&(b=arguments[d-1],d--);var l=Array.prototype.slice.call(arguments,0,d),m=function(){f&&(clearTimeout(f),f=0,nokia.mh5.dom.removeEvent(g,"tap",c,!0),nokia.mh5.dom.removeEvent(l[0].node,"webkitTransitionEnd",m,!1),nokia.mh5.dom.removeEvent(l[0].node,"MSTransitionEnd",m,!1),b&&setTimeout(b,0))};nokia.mh5.dom.addEvent(g,"tap",c,!0);l.forEach(function(b){b.fromTransformClass&&nokia.mh5.dom.addClass(b.node,
b.fromTransformClass)});setTimeout(function(){l.forEach(function(b){b.fromTransformClass&&nokia.mh5.dom.removeClass(b.node,b.fromTransformClass);nokia.mh5.dom.addClass(b.node,b.transitionClass);nokia.mh5.dom.addClass(b.node,b.toTransformClass)});h=a(l[0].node)+2E3;f=setTimeout(m,h)},0);nokia.mh5.dom.addEvent(l[0].node,"webkitTransitionEnd",m,!1);nokia.mh5.dom.addEvent(l[0].node,"MSTransitionEnd",m,!1)},doTransition:function(b){var d=b.node,a=b.parentNode||d.parentNode||g,f=b.previousNode||!1,h=b.type+
"Transition";b.transition=!0;if(!d)return!1;h=nokia.mh5.dom[h];nokia.mh5.dom.addEvent(g,"tap",c,!0);b.isHistory&&!b.persistance?a.insertBefore(d,f):(f&&nokia.mh5.dom.addClass(f,"mh5_transition_center"),"fade"===b.type&&nokia.mh5.dom.addClass(b.fadeNode?b.fadeNode:d,"in"===b.mode?"mh5_transition_hide":"mh5_transition_show"),"out"!==b.mode&&!b.persistence&&a.appendChild(d));if(b.onNodeAttached)b.onNodeAttached();h(b)},slideTransition:function(b){var a=b.previousNode,f=b.node,h=0,l="mh5_transition_"+
(b.isHistory?"right":"left"),m="mh5_transition_"+(b.isHistory?"left":"right"),n;b.transition?(nokia.mh5.dom.removeClass(f,"[A-Za-z0-9_]*transition[A-Za-z0-9_]*"),nokia.mh5.dom.addClass(f,m),setTimeout(function(){nokia.mh5.dom.addClass(a,"mh5_transition_slide");nokia.mh5.dom.addClass(f,"mh5_transition_slide");var c=d.defaultView.getComputedStyle(b.node,null);b.duration=1E3*(parseFloat(c.getPropertyValue("-webkit-transition-duration")||c.getPropertyValue("-moz-transition-duration")||c.getPropertyValue("transition-duration"))||
0);h=setTimeout(n,b.duration+2E3);setTimeout(function(){nokia.mh5.dom.removeClass(f,m);nokia.mh5.dom.removeClass(a,"mh5_transition_center");nokia.mh5.dom.addClass(a,l)},0)},0)):h=setTimeout(n,1);n=function(){h&&(clearTimeout(h),h=0,nokia.mh5.dom.removeEvent(g,"tap",c,!0),nokia.mh5.dom.removeEvent(f,"webkitTransitionEnd",n,!1),nokia.mh5.dom.removeClass(a,"mh5_transition_slide"),nokia.mh5.dom.removeClass(f,"mh5_transition_slide"),nokia.mh5.dom.removeClass(a,l),a.parentNode&&a.parentNode.removeChild(a),
b.callback&&b.callback())};nokia.mh5.dom.addEvent(f,"webkitTransitionEnd",n,!1)},fadeTransition:function(b){b.fadeNode=b.fadeNode||b.node;if(!b.transition)return!1;var a=0,f=b.isHistory,h;setTimeout(function(){nokia.mh5.dom.addClass(b.fadeNode,"mh5_transition_fade");var c=d.defaultView.getComputedStyle(b.node,null);b.duration=1E3*(parseFloat(c.getPropertyValue("-webkit-transition-duration")||c.getPropertyValue("-moz-transition-duration")||c.getPropertyValue("-ms-transition-duration")||c.getPropertyValue("transition-duration"))||
0);a=setTimeout(h,b.duration+2E3);f||(nokia.mh5.dom.addClass(b.fadeNode,"mh5_transition_"+("in"===b.mode?"show":"hide")),nokia.mh5.dom.removeClass(b.fadeNode,"mh5_transition_"+("in"===b.mode?"hide":"show")))},0);h=function(){a&&(clearTimeout(a),a=0,"out"===b.mode&&!b.persistence&&b.node.parentNode&&b.node.parentNode.removeChild(b.node),nokia.mh5.dom.removeEvent(g,"tap",c,!0),nokia.mh5.dom.removeEvent(b.node,"webkitTransitionEnd",h,!1),nokia.mh5.dom.removeEvent(b.node,"MSTransitionEnd",h,!1),nokia.mh5.dom.removeEvent(b.node,
"tap",h),nokia.mh5.dom.removeClass(b.node,"mh5_transition_fade"),nokia.mh5.dom.removeClass(b.fadeNode,"in"===b.mode?"mh5_transition_show":"mh5_transition_hide"),b.callback&&b.callback())};nokia.mh5.dom.addEvent(b.node,"webkitTransitionEnd",h,!1);nokia.mh5.dom.addEvent(b.node,"MSTransitionEnd",h,!1)}}})(this);nokia.mh5.provide("nokia.mh5.history");
(function(){var h=[],c=nokia.mh5.win.history,a=-1;nokia.mh5.history={back:function(){c.back()},pushState:function(f,g,d){h[++a]=f;c.pushState({index:a},g,d);nokia.mh5.event.fire(nokia.mh5.history,"historypositionchange",{state:f,position:a,historyLength:h.length})},replaceState:function(f,g,d){-1===a&&(a=0);h[a]=f;c.replaceState({index:a},g,d)},reset:function(){h=[];a=-1}};Object.defineProperty(nokia.mh5.history,"length",{get:function(){return h.length}});Object.defineProperty(nokia.mh5.history,"position",
{get:function(){return a}});nokia.mh5.win.onpopstate=function(f){if(nokia.mh5.history.catchNextOnPopState){nokia.mh5.history.catchNextOnPopState(f.state?h[f.state.index]:null);delete nokia.mh5.history.catchNextOnPopState;var g=nokia.mh5.win.onpopstate;nokia.mh5.win.onpopstate=function(){nokia.mh5.win.onpopstate=g};c.forward()}else if(f.state){var d=f.state.index>a;a=f.state.index;f=d?a:a+1;if(h[f])(f=h[f].onPopState)&&f(h[a],d),nokia.mh5.event.fire(nokia.mh5.history,"historypositionchange",{state:h[a],
position:a,historyLength:h.length})}}})();nokia.mh5.provide("nokia.mh5.event.ontap");
(function(){function h(){nokia.mh5.dom.addClass(this,"mh5_active")}function c(){nokia.mh5.dom.removeClass(this,"mh5_active")}function a(b){b.stopPropagation();b=b.touches[0];e=this._tap_={x:b.screenX,y:b.screenY,c:!0,e:b};h.call(this)}function f(b){if((e=this._tap_)&&e.c)b=b.touches[0],e.c=10>d(e.x-b.screenX)&&10>d(e.y-b.screenY)}function g(d){d.stopPropagation();if(e=this._tap_)delete this._tap_,c.call(this),e.c&&(this.noPreventDefault||d.preventDefault(),b.fire(this,"tap",e.e))}var d=Math.abs,b=
nokia.mh5.event,e;b.ontap=function(d,e,j,l,m){b.isTouch?(b[d](e,"down",a,m),b[d](e,"move",f,m),b[d](e,"up",g,m),e[d+"EventListener"]("tap",l,m)):(b[d](e,"down",h,m),b[d](e,"mouseout",c,m),b[d](e,"up",c,m),b[d](e,"click",l,m))}})();nokia.mh5.provide("nokia.mh5.event.onviewportchange");
(function(h,c,a,f,g,d,b){function e(b){h.event.fire(b,"viewportchange",this)}function o(b){g=0;c.forEach(e,b)}function i(b){clearTimeout(g);g=setTimeout(o,h.platform.hideAddressBar.DELAY+50,b)}h.win.addEventListener("orientationchange",i,!0);h.win.addEventListener("resize",i,!0);h.win.addEventListener("focus",i,!0);h.event.onviewportchange=function(e,g,i,h,o){d=c.indexOf(g);b=a[d]&&a[d].indexOf(h);0>d?(d=c.push(g)-1,a[d]=[h],f[d]=[b=0]):0>b&&(b=a[d].push(h)-1,f[d].push(b));f[d][b]+="add"==e?1:-1;
1>f[d][b]&&(f[d].splice(b,1),a[d].splice(b,1),a[d].length||c.splice(d,1));g[e+"EventListener"]("viewportchange",h,o)}})(nokia.mh5,[],[],[],0);nokia.mh5.provide("nokia.mh5.ui.Control");
nokia.mh5.ui.Control=new nokia.mh5.Class(function(){function h(a,d,b,e){if(!a._bindings||!a._bindings[d])return-1;a=a._bindings[d];for(d=a.length-1;0<=d;--d)if(a[d].object===b&&a[d].property===e)return d;return-1}var c=function(a,d){var b=a.indexOf(d);return-1!==b&&b===a.length-d.length},a=function(a,d,b,e){a._bindings=a._bindings||{};a._bindings[d]=a._bindings[d]||[];a._bindings[d].push({object:b,property:e});var c=Object.getOwnPropertyDescriptor(a,d)||Object.getOwnPropertyDescriptor(a.constructor.prototype,
d);if(!c||!c.set){var f=a[d];Object.defineProperty(a,d,{get:function(){return f},set:function(b){if(!(f===b&&"object"!==typeof f&&!Array.isArray(f))){var e=f;f=b;var c,h;if(a._bindings[d])for(var o=a._bindings[d].length-1;0<=o;--o)c=a._bindings[d][o].object,h=a._bindings[d][o].property,"function"===typeof h?h.call(c,b,e):c[h]=b}}})}"function"===typeof e?e.call(b,a[d]):b[e]=a[d]},f=function(a,d,b,e){a._bindings=a._bindings||{};a._bindings[d]=a._bindings[d]||[];a._bindings[d].push({object:b,property:e});
"function"!==nokia.mh5.type(e)&&(b[e]=a[d]);var c="change";if((a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&"value"===d)c="keyup";nokia.mh5.dom.addEvent(a,c,function(){"function"===nokia.mh5.type(e)?e.call(b,a[d]):b[e]=a[d]})};return{statics:{watch:function(c,d,b,e){c instanceof HTMLElement?f(c,d,b,e):a(c,d,b,e)},bindingExists:function(a,d,b,e){return-1<h(a,d,b,e)},removeBinding:function(a,d,b,e){b=h(a,d,b,e);-1<b&&(e=a._bindings[d],e.splice(b,1),0===e.length&&delete a._bindings[d])}},
constructor:function(a,d){this._attachTouchHandler=this._attachTouchHandler.bind(this);nokia.mh5.extend(this,a);this.parent=d;this.root=nokia.mh5.doc.createElement(this.rootHtmlElementName||"div");(this.hScroll||this.vScroll)&&this._setupScrolling();if(this.innerHTML)this.getContentRoot().innerHTML=this.innerHTML;!this.dontBind&&!d&&(this.prepareBindings(),this.prepareDidChangeNotifications());this.cssClass&&0<this.cssClass.length&&nokia.mh5.dom.addClass(this.root,this.cssClass);if(this.id)this.root.id=
this.id;this.onClick&&this._attachTouchHandler();if(void 0===this.visible)this.visible=!0;nokia.mh5.each(this.listeners,function(b,a){nokia.mh5.event.add(this,a,b)},this)},getRootOwnerByClass:function(a){for(var d=this;"parent"in d&&!(d instanceof a);)d=d.parent;return d},_setupScrolling:function(){var a=this;a.scrollContainer=nokia.mh5.doc.createElement("div");a.root.appendChild(a.scrollContainer);a.scrollContainer.style.display="inline-block";var d=nokia.mh5.doc.createElement(a.scrollContainerElementName||
"div");a.scrollContainer.appendChild(d);if(nokia.mh5.dom.isNativeScrollingSupported())a.root.style["overflow-x"]=a.hScroll?"scroll":"hidden",a.root.style["overflow-y"]=a.vScroll?"scroll":"hidden";else{var b,e,c,f,h;a._scroll=new iScroll(a.root,{hScroll:a.hScroll,hScrollbar:!1===a.hScrollbar?!1:!0,vScroll:a.vScroll,vScrollbar:!1===a.vScrollbar?!1:!0,hideScrollbar:!0,bounce:!1===a.bounce?!1:!0,scrollbarClass:"mh5_scrollbar"+(a.scrollbarClass?" "+a.scrollbarClass:""),onBeforeScrollStart:function(d){b=
d.touches?d.touches[0]:d;e=b.pageX;c=b.pageY;a._scrolled=!1},onBeforeScrollMove:function(d){b=d.touches?d.touches[0]:d;f=Math.abs(b.pageX-e);h=Math.abs(b.pageY-c);(!a.vScroll&&f>h||!a.hScroll&&h>f)&&d.preventDefault();a._scrolled=!0},checkDOMChanges:!0});a._scroll.refresh=a._scroll.refresh.bind(a._scroll)}a.hScroll&&nokia.mh5.dom.addClass(a.scrollContainer,"mh5_hScroll");a.vScroll&&nokia.mh5.dom.addClass(a.scrollContainer,"mh5_vScroll")},_attachTouchHandler:function(){nokia.mh5.dom.addEvent(this.root,
"tap",function(a){if(!this._isScrolled())this.onClick(a)}.bind(this),!1)},_isScrolled:function(){return!this._scrolled||400>=(new Date).getTime()-this._scroll.startTime?!1:!0},visibleDidChange:function(a){nokia.mh5.dom[a?"removeClass":"addClass"](this.root,"mh5_hidden")},prepareBindings:function(){var a=nokia.mh5.ui.Control,d;for(d in this)if(c(d,"Binding")){var b=this[d],e=d.slice(0,-7),f=b.split("#"),i=2===f.length?f[0]:null,h=2===f.length?f[1]:f[0],l=null,f=h.split("."),f=f[f.length-1],h=h.substring(0,
h.indexOf("."+f)),l=null,l="this"===i?this:i?nokia.mh5.require(i):nokia.mh5.win;if(!l)throw Error(nokia.mh5.i18n("Error.prepareBindings",{value:b,snmspa:i}));l=nokia.mh5.resolve(h,l);a.watch(l,f,this,e)}},prepareDidChangeNotifications:function(){var a=nokia.mh5.ui.Control,d,b,e;for(e in this)c(e,"DidChange")&&(d=this[e],b=e.slice(0,-9),a.watch(this,b,this,d))},getContentRoot:function(){return this.scrollContainer?this.scrollContainer.children[0]:this.root}}});nokia.mh5.provide("nokia.mh5.ui.AutoLayout");
nokia.mh5.ui.AutoLayout=new nokia.mh5.Class({constructor:function(h){this.setProperties(h)},setProperties:function(h){nokia.mh5.extend(this,h)},reset:function(){}});nokia.mh5.provide("nokia.mh5.ui.Container");
nokia.mh5.ui.Container=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){var c=nokia.mh5.i18n;return{constructor:function(a,f){nokia.mh5.extendDeep(this,a);for(var g=this.children=this.children||[],d=nokia.mh5.doc.createDocumentFragment(),b,e,o=0,i=g.length;o<i;o++)if(a=b=this[g[o]]){e=a.control;if(!e)throw Error(c("Error.controlProperty"),b);this[g[o]]=b=new e(a,this);b.root&&d.appendChild(b.root)}g=this.dontBind;if(!f)this.dontBind=!0;h.constructor.call(this,{},f);this.dontBind=g;this.getContentRoot().appendChild(d);
a=this.layout||{};e=a.type||nokia.mh5.ui.AutoLayout;this.layout=new e(a);this.layout.setProperties({container:this});this.parent||(this.build(),this.dontBind||(this.prepareBindings(),this.prepareDidChangeNotifications()))},build:function(){for(var a,c=0,g=this.children.length;c<g;c++)a=this.children[c],this[a]&&this[a].build&&this[a].build()},prepareDidChangeNotifications:function(){for(var a,c=0,g=this.children.length;c<g;c++)a=this.children[c],(a=this[a])&&a.prepareDidChangeNotifications&&!a.dontBind&&
a.prepareDidChangeNotifications();h.constructor.prototype.prepareDidChangeNotifications.call(this)},prepareBindings:function(){for(var a,c=0,g=this.children.length;c<g;c++)a=this.children[c],(a=this[a])&&a.prepareBindings&&!a.dontBind&&a.prepareBindings();h.constructor.prototype.prepareBindings.call(this)},add:function(a,c){this.children=this.children.concat(c);this[c]=a;a.parent=this;a.root&&this.getContentRoot().appendChild(a.root)},insertBefore:function(a,c,g){var d=this.children.indexOf(g);if(-1!==
d)g=this[g],this.children=this.children.concat([]),this.children.splice(d,0,c),this[c]=a,a.parent=this,a.root&&g.root&&this.getContentRoot().insertBefore(a.root,g.root)},remove:function(a){var c=this.children.indexOf(a);if(-1!==c){var g=this[a];delete this[a];this.children=this.children.concat([]);this.children.splice(c,1);g.root&&this.getContentRoot().removeChild(g.root)}}}});nokia.mh5.provide("nokia.mh5.ui.ColumnLayout");
nokia.mh5.ui.ColumnLayout=new nokia.mh5.Class(nokia.mh5.ui.AutoLayout,function(h){return{setProperties:function(c){h.setProperties.call(this,c);if(c=this.container)c=c.getContentRoot(),"stretch"===this.align&&nokia.mh5.dom.addClass(c,"stretch"),nokia.mh5.dom.addClass(c,"mh5_ColumnLayout")},reset:function(){h.reset.call(this);var c=this.container.getContentRoot();nokia.mh5.dom.removeClass(c,"mh5_ColumnLayout");nokia.mh5.dom.removeClass(c,"stretch")}}});nokia.mh5.provide("nokia.mh5.ui.RowLayout");
nokia.mh5.ui.RowLayout=new nokia.mh5.Class(nokia.mh5.ui.AutoLayout,function(h){return{setProperties:function(c){h.setProperties.call(this,c);if(c=this.container)c=c.getContentRoot(),"stretch"===this.align&&nokia.mh5.dom.addClass(c,"stretch"),nokia.mh5.dom.addClass(c,"mh5_RowLayout")},reset:function(){h.reset.call(this);var c=this.container.getContentRoot();nokia.mh5.dom.removeClass(c,"mh5_RowLayout");nokia.mh5.dom.removeClass(c,"stretch")}}});nokia.mh5.provide("nokia.mh5.ui.List");
nokia.mh5.ui.List=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){return{cssClass:"mh5_List",rootHtmlElementName:"ul",scrollContainerElementName:"ul",layout:{type:nokia.mh5.ui.RowLayout},itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(c){return{rootHtmlElementName:"li",cssClass:"mh5_DefaultListItem",constructor:function(a,f){c.constructor.call(this,a,f);this.update()},update:function(){var a="";this.icon&&(a+="<img src='"+this.icon+"'></img>");this.text&&(a+="<div>"+this.text+"</div>");
this.root.innerHTML=a}}}),constructor:function(c,a){this.items=[];this.renderedItems=[];var c=c||{},f=c.onClick;delete c.onClick;if(c.hScroll||c.vScroll)this.rootHtmlElementName="div";h.constructor.call(this,c,a);this.onClick=f;var g=this.getContentRoot();g.noPreventDefault=!!c.noPreventDefault;nokia.mh5.dom.addEvent(g,"tap",function(a){if(!a._fake&&g.hasChildNodes())for(var a=(a.hasOwnProperty("data")?a.data.target:null)||a.target,a=1!=a.nodeType?a.parentNode:a,b=0,c=g.childNodes.length;b<c;b++)if(nokia.mh5.dom.contains(g.children[b],
a)){if(this.onClick)this.onClick(b,g.children[b]);nokia.mh5.event.fire(this,"tap",{index:b,item:this.items[b]});break}}.bind(this),!0);c.onClick=f},add:function(c,a,f){if(void 0===a)a=this.items.length;var g=[a,0],d=nokia.mh5.doc.createDocumentFragment(),b,e,h=[],i=this.getContentRoot();Array.isArray(c)||(c=[c]);f||(g=g.concat(c),this.items.splice.apply(this.items,g));for(f=0,e=c.length;f<e;f++)b=this._createItem(c[f]),h.push(b),d.appendChild(b.root);i.children[a]?i.insertBefore(d,i.children[a]):
i.appendChild(d);g.length=2;g=g.concat(h);this.renderedItems.splice.apply(this.renderedItems,g);this._scroll&&setTimeout(this._scroll.refresh,0)},remove:function(c){if(c===this.items)this.items=[];else{Array.isArray(c)||(c=[c]);var a,f=c.length,g=0;for(_listRoot=this.getContentRoot();g<f;g++)a=this.items.indexOf(c[g]),-1<a&&(this.items.splice(a,1),this.renderedItems.splice(a,1),_listRoot.removeChild(_listRoot.children[a]))}},_createItem:function(c){var a={};if(this.itemMapping)for(k in this.itemMapping)a[k]=
c[this.itemMapping[k]];else for(k in c)c.hasOwnProperty(k)&&(a[k]=c[k]);return a.itemClass?new a.itemClass(a,this):new this.itemClass(a,this)},itemsDidChange:function(c){for(var a=this.getContentRoot(),f=this.renderedItems.length-1;0<=f;f--)a.removeChild(this.renderedItems[f].root);this.renderedItems=[];this.add(c,0,!0)},update:function(c,a){if(c&&void 0!=a){var f=this.getContentRoot();if(this.items[a]){var g=this._createItem(c);this.items[a]=c;this.renderedItems[a]=g;f.replaceChild(g.root,f.children[a])}}else this.itemsDidChange(this.items)},
scrollTo:function(c,a){this._scroll&&this._scroll.scrollTo(c,a,300)},scrollToElement:function(c){this._scroll&&this.renderedItems[c]&&this._scroll.scrollToElement(this.renderedItems[c].root,300)}}});nokia.mh5.provide("nokia.mh5.ui.Button");
nokia.mh5.ui.Button=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{rootHtmlElementName:"a",cssClass:"mh5_Button",constructor:function(c,a){c=c||{};this._userOnClick=c.onClick;delete c.onClick;h.constructor.call(this,c,a);c.onClick=this._userOnClick;this.update()},onClick:function(c){c&&c.stopPropagation();if(!this.disabled){var a=this.root;this.link?(a.href=this.link,setTimeout(function(){a.removeAttribute("href")},1E3)):c&&c.preventDefault();this._userOnClick&&this._userOnClick.apply(this,
arguments)}},textDidChange:function(){this.update()},iconDidChange:function(){this.update()},disabledDidChange:function(c){nokia.mh5.dom[c?"addClass":"removeClass"](this.root,"mh5_disabled")},update:function(){var c=this.icon,a=this.iconClass,f=this.text||"",g=this.root,d=this.disabled,b="";if(this.target)g.target=this.target;g.className=(this.cssClass||"")+(""!==f?" mh5_textButton":"");nokia.mh5.dom[d?"addClass":"removeClass"](g,"mh5_disabled");c&&(b+="<img src='"+c+"'/>");a&&(b+="<div class='"+
a+"'/>");f&&(b+="<div class='mh5_ButtonText'>"+f+"</div>");g.innerHTML=b;this.visibleDidChange(this.visible)}}});nokia.mh5.provide("nokia.mh5.ui.Notification");
nokia.mh5.ui.Notification=new nokia.mh5.Class(nokia.mh5.ui.Button,function(h){return{statics:{TIMEOUT_DEFAULT:3E3,TIMEOUT_INFINITY:0},cssClass:"mh5_Notification",innerHTML:'<div class="mh5_NotificationText"></div>',timeout:3E3,textDidChange:function(){this.update()},visibleDidChange:function(c){h.visibleDidChange.call(this,c);if(void 0!==this._timeoutId)clearTimeout(this._timeoutId),this._timeoutId=void 0;if(this.visible&&0<this.timeout)this._timeoutId=setTimeout(function(){this.visible=!1}.bind(this),
this.timeout)},update:function(){this.root.children[0].innerHTML!=this.text&&this.visibleDidChange(this.visible);this.root.children[0].innerHTML=this.text?this.text:""}}});nokia.mh5.provide("nokia.mh5.ui.Rating");
nokia.mh5.ui.Rating=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{value:0,count:0,cssClass:"mh5_Rating",constructor:function(c,a){h.constructor.call(this,c,a);this.update()},update:function(){var c="",a=0,f=Math.min(5,Math.round(2*this.value)/2);if(0===f)this.root.innerHTML="";else{for(;++a<=f;)c+='<div class="star"></div>';0!=Math.round(f)-f&&(a++,c+='<div class="halfstar"></div>');for(;5>=a++;)c+='<div class="nostar"></div>';0<this.count&&(c+='<div class="count">('+this.count+")</div>");
this.root.innerHTML=c}},countDidChange:function(){this.update()},valueDidChange:function(){this.update()}}});nokia.mh5.provide("nokia.mh5.components.PlaceSummary");
nokia.mh5.components.PlaceSummary=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){var c=nokia.mh5.i18n;return{cssClass:"mh5_PlaceSummary mh5_standardBackgroundColorDark",layout:{type:nokia.mh5.ui.ColumnLayout},children:["details"],details:{control:nokia.mh5.ui.Container,cssClass:"details"},constructor:function(a){h.constructor.call(this,a);this.update()},update:function(a){if(a){var f="";a.name&&(f+="<h1>"+a.name+"</h1>");a.categoryTitle&&(f+="<h3>"+a.categoryTitle+"</h3>");a.address&&a.address!==
a.name&&(f+='<h2 class="address">'+a.address.replace(/\n/g,", ")+"</h2>");if(a.ratingValue){if(!this.ratingComponent)this.ratingComponent=new nokia.mh5.ui.Rating;this.ratingComponent.value=a.ratingValue;this.ratingComponent.count=a.ratingCount;f+=this.ratingComponent.root.outerHTML}a.providerName&&(f+='<div class="mh5_source">'+c("source")+": "+a.providerName+"</div>");this.details&&(this.details.root.innerHTML=f)}else this.clear()},clear:function(){this.details.root.innerHTML=""}}});nokia.mh5.provide("nokia.mh5.connectors.story.StoryListItem");
nokia.mh5.connectors.story.StoryListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(c){h.constructor.call(this,c);this.update()},update:function(){var c,a;c='<div class="mh5_ColumnLayout"><div class="mh5_icon"></div>'+('<div class="name">'+this.text+"</div>");c+='<div class="status"></div></div>';this.href?(a=this.root.appendChild(nokia.mh5.doc.createElement("a")),a.href=this.href,a.target="_blank"):a=this.root;
a.innerHTML=c}}});nokia.mh5.provide("nokia.mh5.ui.TextInput");
nokia.mh5.ui.TextInput=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){var c=function(a){var c=nokia.mh5.doc.createElement("input");c.setAttribute("type",a);return"text"!==c.type||"datetime"===a};return{cssClass:"mh5_TextInput",placeholder:"",value:"",constructor:function(a,f){var g=nokia.mh5.event.add,a=a||{};a.clear=void 0!==a.clear?a.clear:!0;this.innerHTML="<form  class='mh5_ColumnLayout stretch'><input type='"+(a.type?c(a.type)?a.type:"text":"text")+"' autocomplete='off'>"+(!nokia.mh5.platform.android&&
a.clear?"<div class='mh5_TextInputClear mh5_hidden'></div>":"")+"</form>";h.constructor.call(this,a,f);var d=this.root.children[0],b=d.children[0],e=d.children[1];this.input=b;this.placeholderDidChange();if(this.value)b.value=this.value;nokia.mh5.ui.Control.watch(this,"placeholder",this,this.placeholderDidChange);nokia.mh5.ui.Control.watch(b,"value",this,"value");var o=this;g(b,"focus",function(b){if(nokia.mh5.platform.android&&nokia.mh5.dom.hasClass(nokia.mh5.doc.body,"mh5_hwacc_body"))o._restoreHWAcceleration=
!0,nokia.mh5.dom.removeClass(nokia.mh5.doc.body,"mh5_hwacc_body");nokia.mh5.platform.ios&&nokia.mh5.event.fire(nokia.mh5.win,"hideAddressBar",{},!0,!0);nokia.mh5.dom.addClass(o.root,"focus");0<o.value.length&&e&&nokia.mh5.dom.removeClass(e,"mh5_hidden");if(o.onFocus)o.onFocus(b);nokia.mh5.event.fire(o,"focus",b)});g(b,"blur",function(b){if(o._restoreHWAcceleration)nokia.mh5.dom.addClass(nokia.mh5.doc.body,"mh5_hwacc_body"),o._restoreHWAcceleration=!1;nokia.mh5.dom.removeClass(o.root,"focus");e&&nokia.mh5.dom.addClass(e,
"mh5_hidden");if(o.onBlur)o.onBlur(b);nokia.mh5.event.fire(o,"blur",b)});e&&nokia.mh5.dom.addEvent(e,"down",function(a){a.stopPropagation();a.preventDefault();o.value="";b.value=""},!0);g(d,"submit",function(a){o.value=b.value;b.blur();a.preventDefault();a.stopPropagation();nokia.mh5.event.fire(this,"submit",a);return!1}.bind(this),!0)},isFocused:function(){return nokia.mh5.dom.hasClass(this.root,"focus")},blur:function(){this.root.children[0].children[0].blur()},focus:function(){this.root.children[0].children[0].focus()},
valueDidChange:function(){var a=this.root.children[0].children[1],c=this.root.children[0].children[0];if(c.value!==this.value)c.value=this.value||"";if(a&&this.isFocused())nokia.mh5.dom[0<this.value.length?"removeClass":"addClass"](a,"mh5_hidden")},placeholderDidChange:function(a){if(a&&this.input&&"placeholder"in this.input)this.input.placeholder=a}}});nokia.mh5.provide("nokia.mh5.ui.TextArea");
nokia.mh5.ui.TextArea=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{cssClass:"mh5_ColumnLayout stretch",rootHtmlElementName:"div",constructor:function(c,a){this.innerHTML='<textarea class="mh5_TextArea"></textarea>';h.constructor.call(this,c,a);var f=this.root.children[0],g=this;nokia.mh5.ui.Control.watch(f,"value",this,"value");nokia.mh5.dom.addEvent(f,"focus",function(a){if(nokia.mh5.platform.android&&nokia.mh5.dom.hasClass(nokia.mh5.doc.body,"mh5_hwacc_body"))g._restoreHWAcceleration=
!0,nokia.mh5.dom.removeClass(nokia.mh5.doc.body,"mh5_hwacc_body");nokia.mh5.event.fire(g,"focus",a)});nokia.mh5.dom.addEvent(f,"blur",function(a){if(g._restoreHWAcceleration)nokia.mh5.dom.addClass(nokia.mh5.doc.body,"mh5_hwacc_body"),g._restoreHWAcceleration=!1;nokia.mh5.event.fire(g,"blur",a)});if(this.placeholder&&"placeholder"in f)f.placeholder=this.placeholder;this.rows&&(f.rows=this.rows);this.maxlength&&(f.maxLength=this.maxlength)}}});nokia.mh5.provide("nokia.mh5.ui.Page");
nokia.mh5.ui.Page=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){return{cssClass:"mh5_Page",visible:!1,model:null,getHash:function(){return"{}"},getNavigationState:function(){return this.model?nokia.mh5.utils.purify(this.model):{}},intoView:function(h){var c=nokia.mh5.dom.query(h)[0];c&&setTimeout(function(){window.scroll&&window.scroll(0,c.offsetTop)},1E3)},setModel:function(h){this.model=h}}});nokia.mh5.provide("nokia.mh5.connectors.story.BasePlugin");
nokia.mh5.connectors.story.BasePlugin=new nokia.mh5.Class(nokia.mh5.ui.Page,function(h){return{constructor:function(c,a){h.constructor.call(this);this.story=a;this.prevView=c;this.callSequenceIndex=-1;this.callSequence=[];this.genericCB=this.genericCB.bind(this)},showView:function(c){this.originOnpopstate=nokia.mh5.win.onpopstate;nokia.mh5.win.onpopstate=function(){this.hideView(c)}.bind(this);this.prevView.parentElement.replaceChild(c,this.prevView)},hideView:function(c){nokia.mh5.win.onpopstate=
this.originOnpopstate;nokia.mh5.win.history.forward();this.root.parentNode&&c.parentElement.replaceChild(this.prevView,c)},_nextStep:function(c){this.callSequenceIndex+=c||1;if(this.callSequenceIndex<this.callSequence.length)if(c=this.callSequence[this.callSequenceIndex],"adapter"==c.target)nokia.mh5.connectors.story.StoryAdapter[c.asyncMethod](this.genericCB,c.arg);else{if("plugin"==c.target)this[c.asyncMethod](this.genericCB,c.arg)}else this.callback({success:!0})},genericCB:function(c){this.callSequence[this.callSequenceIndex].cb.call(this,
c)},processSequence:function(){this.callSequence&&this.callSequenceIndex&&this.callback&&this._nextStep()}}});nokia.mh5.provide("nokia.mh5.connectors.story.SmsPlugin");
nokia.mh5.connectors.story.SmsPlugin=new nokia.mh5.Class(nokia.mh5.connectors.story.BasePlugin,function(h){var c=nokia.mh5.i18n;return{cssClass:"mh5_smsShare",children:"header,notification,phoneNumberLabel,phoneNumberLabel_error,phoneNumberInput,messageLabel,messageInput,securityCodeLabel,securityCodeLabel_error,image,text,actions".split(","),layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,rootHtmlElementName:"header",cssClass:"mh5_header mh5_standardBackgroundColorDark",
children:["headline","placeSummary"],headline:{control:nokia.mh5.ui.Control,rootHtmlElementName:"h1",cssClass:"mh5_headline",innerHTML:c("shareVia")+" "+c("sms")},placeSummary:{control:nokia.mh5.components.PlaceSummary}},notification:{control:nokia.mh5.ui.Notification,visible:!1},phoneNumberLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:c("SMS.plsEnterNum")},phoneNumberLabel_error:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label error",visible:!1,rootHtmlElementName:"label",
innerHTML:c("SMS.plsCheckNum")},phoneNumberInput:{control:nokia.mh5.ui.TextInput,type:c("tel"),clear:!1,value:"+"},messageLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:c("SMS.alsoShort")},messageInput:{control:nokia.mh5.ui.TextArea,rows:3,maxlength:140,placeholder:c("messageHere")+"..."},securityCodeLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:c("SMS.enterCaptcha")},securityCodeLabel_error:{control:nokia.mh5.ui.Control,
rootHtmlElementName:"label",cssClass:"mh5_Label error",innerHTML:c("SMS.wrongCaptcha"),visible:!1},image:{control:nokia.mh5.ui.Control,rootHtmlElementName:"img",cssClass:"mh5_captchaImage",src:"",srcDidChange:function(a){this.root.src=a}},text:{control:nokia.mh5.ui.TextInput,clear:!1,placeholder:c("SMS.enterCode")+"...",valueDidChange:function(a){if(0===a.length)this.parent.actions.submitButton.disabled=!0;else if(this.parent.actions.submitButton.disabled)this.parent.actions.submitButton.disabled=
!1}},actions:{control:nokia.mh5.ui.Container,cssClass:"mh5_right",children:["cancelButton","submitButton"],cancelButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_textButton",text:c("cancel"),build:function(){this.root.addEventListener("touchstart",function(a){a.stopPropagation();a.preventDefault()})},onClick:nokia.mh5.history.back},submitButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_textButton",disabled:!0,text:c("submit")}},constructor:function(a,c){h.constructor.call(this,
a,c);this.header.placeSummary.update(this.story.data);this.actions.submitButton.update();this.callSequence=[{target:"adapter",asyncMethod:"getCaptcha",cb:this._getCaptchaCallback,arg:null},{target:"plugin",asyncMethod:"_displayForm",cb:this._displayFormCallback,arg:{}},{target:"adapter",asyncMethod:"share",cb:this._shareCallback,arg:{}}];this.metadata={}},performShare:function(a){this.callback=function(c){this.actions.submitButton.disabled=!1;c.success?(this.notification.text="The SMS was sent successfully!",
this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0),setTimeout(function(){this.notification.visible=!1;this.hideView(this.root);a(c)}.bind(this),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)):(this.hideView(this.root),a(c))}.bind(this);this.processSequence()},_getCaptchaCallback:function(a){if(a.success&&a.result)this.metadata.captcha=a.result.captcha,this.callSequence[1].arg.url=this.metadata.captcha.captchaUrl,this.callSequence[1].arg.captchaWidth=
this.metadata.captcha.captchaWidth,this.callSequence[1].arg.captchaHeight=this.metadata.captcha.captchaHeight,this._nextStep();else{var f=c("Notification.connectionError");this.root.parentNode?(this.notification.text=f,this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0)):(a.errorMessage=f,this.callback(a))}},_shareCallback:function(a){this.notification.visible=!1;a.success?this._nextStep():a.result&&409===a.result.targets[0].retCode?
(this.securityCodeLabel_error.visible=!0,this.text.value="",this.text.root.children[0].children[0].focus(),this._nextStep(-2)):a.result&&400===a.result.targets[0].retCode?(this.phoneNumberLabel_error.visible=!0,this._nextStep(-2)):(this.notification.text=c("SMS.unableToSend"),this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0),this._nextStep(-1))},_displayForm:function(a,c){this.image.src=c.url;this.image.root.width=c.captchaWidth||
200;this.image.root.height=c.captchaHeight||50;this.actions.submitButton.disabled=!this._formInitialized;if(!this._formInitialized)this._formInitialized=!0,this._initializeFormControls(a,c)},_initializeFormControls:function(a){var f=this;this.actions.submitButton.onClick=function(){var g={success:!0,placeTitle:this.story.data.name,phoneNumber:f.phoneNumberInput.value.replace(/[^+0-9]/gi,""),message:f.messageInput.value,captchaVerifyText:this.text.value};this.phoneNumberLabel_error.visible=!1;this.securityCodeLabel_error.visible=
!1;this.notification.text=c("sending");this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_INFINITY;this.notification.visible=!0;this.actions.submitButton.disabled=!0;nokia.mh5.win.scrollTo(0,0);a(g)}.bind(this);this.showView(this.root)},_displayFormCallback:function(a){this.metadata.captcha.captchaVerifyText=a.captchaVerifyText;this.metadata.participantSMSPhone=a.phoneNumber;this.metadata.msg=a.message;this.metadata.title=a.placeTitle;this.metadata.place=this.story.data;this.metadata.targets=
"default@sm";this.metadata.type="place";this.callSequence[2].arg=this.metadata;a.success?this._nextStep():this.callback(a)},visibleDidChange:function(a){if(!a)this.notification.visible=!1}}});nokia.mh5.provide("nokia.mh5.connectors.story.EmailPlugin");
nokia.mh5.connectors.story.EmailPlugin=new nokia.mh5.Class(nokia.mh5.ui.Page,function(){var h=nokia.mh5.i18n;return{constructor:function(c,a){this.story=a},performShare:function(c){var a=this.story.data,f=(a.name+"").replace(/\s+/g," "),g=nokia.mh5.connectors.story.StoryAdapter.createShareLink(a),d;nokia.mh5.connectors.story.StoryAdapter.shortLink(g,function(b){if(b)d=h("EP.idLikeTo")+": "+b+"\n\n"+(a.placeId?a.name+"\n":"")+a.address,d=d.replace(/\r/g,""),nokia.mh5.win.location.href="mailto:?subject="+
encodeURIComponent(f)+"&body="+encodeURIComponent(d);setTimeout(function(){c({success:!!b})},500)})}}});nokia.mh5.provide("nokia.mh5.connectors.story.StoryCreator");
nokia.mh5.connectors.story.StoryCreator=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){var h=nokia.mh5.i18n,c=h("Notification.connectionError"),a=[{name:"facebookCreator",text:"Facebook",cssClass:"mh5_ListItem mh5_share Facebook",symbol:"fb"},{name:"twitterCreator",text:"Twitter",cssClass:"mh5_ListItem mh5_share Twitter",symbol:"tw"},{name:"emailCreator",klass:nokia.mh5.connectors.story.EmailPlugin,text:h("email"),cssClass:"mh5_ListItem mh5_share Email"},{name:"smsCreator",klass:nokia.mh5.connectors.story.SmsPlugin,
text:h("sms"),cssClass:"mh5_ListItem mh5_share SMS"},{name:"gbookmarkCreator",text:"Google Bookmarks",cssClass:"mh5_ListItem mh5_share GBookmark",symbol:"gb"},{name:"meneameCreator",text:"Meneame",cssClass:"mh5_ListItem mh5_share Meneame",symbol:"me"},{name:"vKontakteCreator",text:"VKontakte",cssClass:"mh5_ListItem mh5_share VKontakte",symbol:"vk"}];return{cssClass:"mh5_StoryCreator",children:["header","notification","container"],layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,
layout:{type:nokia.mh5.ui.ColumnLayout},rootHtmlElementName:"header",cssClass:"mh5_header mh5_standardBackgroundColorDark",children:["backButton","headerData"],backButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_back",build:function(){this.root.addEventListener("touchstart",function(a){a.stopPropagation();a.preventDefault()})},onClick:nokia.mh5.history.back},headerData:{control:nokia.mh5.ui.Container,layout:{type:nokia.mh5.ui.RowLayout},children:["headline","placeSummary"],headline:{control:nokia.mh5.ui.Control,
rootHtmlElementName:"h1",cssClass:"mh5_headline",innerHTML:h("shareAPlace")},placeSummary:{control:nokia.mh5.components.PlaceSummary}}},notification:{control:nokia.mh5.ui.Notification,visible:!1},container:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.connectors.story.StoryListItem,items:a,onClick:function(a){this.parent.launchShare(a,this.root.children[a])},noPreventDefault:!0},visibleDidChange:function(a){if(!a)this.notification.visible=!1},launchShare:function(f,g){function d(b){e._hideSpinner(g);
!b||b.success?nokia.mh5.app.controller.back():(e.notification.text=b.errorMessage||c,e.notification.visible=!0)}var b=a[f],e=this;this._showSpinner(g);"emailCreator"===b.name?(new b.klass(this.root,this.story)).performShare(d):"smsCreator"===b.name?nokia.mh5.platform.ios_webview&&nokia.mh5.platform.iphone?window.shareNative(this.story,d):nokia.mh5.connectors.story.StoryAdapter.init(function(a){e._hideSpinner(g);a.success?(new b.klass(e.root,e.story)).performShare(d):d(a)}):setTimeout(d,100)},_showSpinner:function(a){a&&
nokia.mh5.dom.addClass(a,"loading")},_hideSpinner:function(a){a&&nokia.mh5.dom.removeClass(a,"loading")},update:function(c){var g,d;this.story=c;g=c.data.name;c=c.data;d=nokia.mh5.connectors.story.StoryAdapter.createShareLink(c);this.header.headerData.placeSummary.update(c);for(var b=0;b<a.length;b++){var e=a[b];if(void 0!==e.symbol)e.href="http://m.maps.nokia.com/releases/1.8.0/server/ushare/ushare.php?sectoken=&version=1.1&targets=default@"+e.symbol+"&type="+encodeURIComponent("place")+"&title="+
encodeURIComponent(g)+"&url="+encodeURIComponent(d)+"&shareDataObj="+encodeURIComponent(JSON.stringify(c.placeId?{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:c.name,shareString2:c.address,shareString3:c.categoryGroup+" / "+c.category,shareString4:"",shareString5:c.phone},location:{placesId:c.placeId||c.id,latitude:""+c.latitude,longitude:""+c.longitude,streetName:c.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",
countryName:""}}:{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:c.name},location:{placesId:"",latitude:""+c.latitude,longitude:""+c.longitude,streetName:c.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}))}this.container.items=a}}});nokia.mh5.provide("nokia.mh5.geolocation");
nokia.mh5.geolocation=function(h,c){function a(){A&&E.clearWatch(A);F=A=0}function f(b){c.fire(y,b,K)}function g(a){var d=!F;F=1;w=j;K=a;v=a.coords;f(d?b:e)}function d(){a();try{A=E.watchPosition(g,function(b){F?f(i,a(),w=m):2<b.code?setTimeout(d,250):f(o,a(),w=n)},{enableHighAccuracy:p,timeout:x,maximumAge:B})}catch(b){w=l,f(o,a())}}var b="positionactivate",e="positionchange",o="positionerror",i="positionlost",j="active",l="denied",m="lost",n="error",p=!0,x=6E4,B=1E4,C=Object.defineProperty,E=nokia.mh5.win.navigator.geolocation,
y={},F=0,w=E?"inactive":"disabled",A=0,z="complete"==document.readyState,u,v,K;C(y,"enableHighAccuracy",{get:function(){return p},set:function(b){p!==b&&(p=null==b?!0:!!b,F&&d())}});C(y,"timeout",{get:function(){return x},set:function(b){x!==b&&(x=null==b?6E4:b,F&&d())}});C(y,"maximumAge",{get:function(){return B},set:function(b){B!==b&&(B=null==b?1E4:b,F&&d())}});C(y,"latitude",{get:function(){return F&&v.latitude}});C(y,"longitude",{get:function(){return F&&v.longitude}});C(y,"available",{get:function(){return!!F}});
C(y,"status",{get:function(){return w}});C(y,"coords",{get:function(){return v}});C(y,"deactivate",{value:function(){F&&(a(),w="inactive",f("positiondeactivate"))}});C(y,"activate",{value:function(b){if(!(F||"disabled"===w)){w="waiting";b||(b={});if(!z)return u=b;var a=b.enableHighAccuracy;p=null==a?!0:!!a;a=b.timeout;x=null==a?6E4:a;b=b.maximumAge;B=null==b?1E4:b;d()}}});C(y,"disable",{value:function(){F&&a();w="disabled"}});z||c.add(h,"DOMContentLoaded",function J(){z=!0;c.remove(h,"DOMContentLoaded",
J);u&&y.activate(u)});c.add(h,"beforeunload",a);c.add(h,"unload",a);return y}(nokia.mh5.win,nokia.mh5.event);nokia.mh5.provide("nokia.mh5.math");
(function(){function h(b,c){var h=b.longitude*a,j=b.latitude*a,l=c.longitude*a,m=c.latitude*a,h=f(j)*f(m)+g(j)*g(m)*g(h-l);1<h&&(h=1);-1>h&&(h=-1);return d(h)}var c=Math.PI,a=c/180,f=Math.sin,g=Math.cos,d=Math.acos,b=nokia.mh5.math={bearing:function(b,o){var i=b.longitude*a,j=o.longitude*a,l=b.latitude*a,m=o.latitude*a,n=h(b,o),l=n?(f(m)-f(l)*g(n))/(f(n)*g(l)):1;1<l&&(l=1);-1>l&&(l=-1);return 0<=f(j-i)?d(l):2*c-d(l)},pointDistance:function(b,a){return 6371E3*h(b,a)},segmentDistance:function(a,d,c){var g=
b.bearing(d,a),l=b.bearing(d,c),m=h(d,c),c=h(c,a),a=h(d,a);return m<1/6371E3?6371E3*a:0===a||0===c?0:0>(a*a+m*m-c*c)/(2*a*m)||0>(m*m+c*c-a*a)/(2*m*c)?-1:6371E3*Math.abs(Math.asin(f(a)*f(g-l)))},speed:function(a,c){return 1E3*b.pointDistance(a.coords,c.coords)/(c.timestamp-a.timestamp)}}})(this);nokia.mh5.provide("nokia.mh5.components.favourites");
(function(){var h=JSON.parse,c=JSON.stringify,a=nokia.mh5.utils.getLocalStorageValue,f=nokia.mh5.utils.setLocalStorageValue,g=nokia.mh5.utils.formatString;nokia.mh5.components.favourites={changedFavourite:null,_generateID:function(){var c=h(a("favourites")||"{}"),b=1,e;do e="FAV_"+b++;while(c[e]);return e},_findFavourite:function(a,b,c){var g=a.placeId,f,h;for(h in b)if(b.hasOwnProperty(h)&&(f=b[h])&&!f.deleted&&(g?f.placeId===g:a.latitude===f.latitude&&a.longitude===f.longitude))return c?{id:h,fav:f}:
f},_queue:function(a,b,c,g){var f=this.__queue=this.__queue||[],h=this.__dangling=this.__dangling||[];this.__idc=this.__idc||0;var l=this,m=function(b){if(h[b])delete h[b];else if(f[0].tid&&clearTimeout(f[0].tid),f[0].c&&f[0].c.apply(this,Array.prototype.slice.call(arguments,1)),f.shift(),0<f.length){this.__idc++;f[0].tid=setTimeout(function(b){var a=f[0];m(b);h[b]=a},f[0].t,this.__idc);var a=function(b){return function(){m.apply(l,[b].concat(Array.prototype.slice.call(arguments,0)))}}(this.__idc);
f[0].f.apply(l,f[0].p?[f[0].p,a]:[a])}}.bind(this);f.push({f:a,p:b,c:c,t:g});1===f.length&&(f.unshift([]),m())},add:function(d,b){var e=h(a("favourites")||"{}"),g=this._generateID(),i;d.favourite=!0;e[g]={address:d.address,categoryGroup:d.categoryGroup,latitude:d.latitude,longitude:d.longitude,name:d.name,placeId:d.placeId,ratingCount:d.ratingCount,ratingValue:d.ratingValue,date:+new Date};i=f("favourites",c(e));nokia.mh5.sso.isAuthenticated()?this.addServerFav(d,function(a){e[a.id]=e[g];delete e[g];
f("favourites",c(e));d.inSync=!0;b&&b()},function(){b&&b()}):b&&b();nokia.mh5.components.favourites.changedFavourite=d;return i},get:function(c){var b=h(a("favourites")||"{}"),e=[],g;for(g in b)if(b.hasOwnProperty(g)){var f=b[g];delete f.categoryIcon;f.favourite=!0;var j=f.categoryGroup;if(f.categories&&f.categories[0]&&f.categories[0].categoryId)j=f.categories[0].categoryId;f.icon=nokia.mh5.utils.place.getCategoryIconForFav(j)}if(c)return Array.isArray(c)?(c.forEach(function(a){(a=this._findFavourite(a,
b))&&e.push(a)},this),e):this._findFavourite(c,b);for(var l in b)b.hasOwnProperty(l)&&!b[l].deleted&&e.push(b[l]);return e},set:function(d){var b=h(a("favourites")||"{}"),e=this._findFavourite(d,b,!0);if(!e||!e.placeId)return!1;b[e.placeId]={address:d.address,categoryGroup:d.categoryGroup,latitude:d.latitude,longitude:d.longitude,name:d.name,placeId:d.placeId,ratingCount:d.ratingCount,ratingValue:d.ratingValue,date:+new Date};return result=f("favourites",c(b))},remove:function(d,b){var e=h(a("favourites")||
"{}"),g=this._findFavourite(d,e,!0);if(g&&g.fav)g.fav.inSync?(g.fav.deleted=!0,g.fav.inSync=!1):delete e[g.id];delete d.favourite;f("favourites",c(e));nokia.mh5.components.favourites.changedFavourite=d;nokia.mh5.sso.isAuthenticated()?this.removeServerFav(g.id,function(){delete e[g.id];f("favourites",c(e));b&&b()}):b&&b()},clear:function(d){var b=h(a("favourites")||"{}"),e={};if(d)for(var g in b)b.hasOwnProperty(g)&&!b[g].inSync&&(e[g]=b[g]);f("favourites",c(e))},synchronize:function(a){this._queue(this._synchronize,
null,a,3E4)},_synchronize:function(d){var b=this;b.listServerFavs(function(e){if(e.data){for(var g={},i,j={},e=e.data,l=0,m=e.length;l<m;l++)i=e[l],g[i.id]=i;var j=h(a("favourites")||"{}"),n=0,p=Object.keys(j),x=function(a){var c=p[n++];if(c)if(i=g[c],d=j[c],d.inSync)!i||i.deleted?delete j[c]:i&&i.updatedTime>d.updatedTime&&(j[c]=b.mapServerToClient(i)),x(a);else if(d.deleted)i?b.removeServerFav(i.id,function(){delete g[c];delete j[c];x(a)}):(delete j[c],x(a));else if(i)if(i.deleted)delete j[c],x(a);
else{if(!i.deleted&&!d.deleted){var d=b.mapServerToClient(g[c]);d.inSync=!0;j[c]=d;x(a)}}else b.addServerFav(d,function(e){d.inSync=!0;d.updatedTime=e.updatedTime;g[c]=b.mapClientToServer(d);j[e.id]=j[c];delete j[c];x(a)});else a&&a()};x(function(){for(var a in g)if(i=g[a],e=j[a],!i.deleted&&!e){var e=b.mapServerToClient(i);e.inSync=!0;j[a]=e}f("favourites",c(j));d&&d()})}})},mapServerToClient:function(a){var b=a.location||{},c=b.position||{},b=b.address?b.address.text?b.address.text:nokia.mh5.adapters.Search.formatAddress(b.address):
null,c={name:a.name,latitude:c.latitude||null,longitude:c.longitude||null,address:b,favourite:!0,updatedTime:a.updatedTime};if(a.placesId&&(c.placeId=a.placesId,a.categories))c.categoryGroup=a.categories[0].categoryId;return c},mapClientToServer:function(a){var b={type:"favoritePlace",name:a.name,location:{position:{latitude:parseFloat(a.latitude),longitude:parseFloat(a.longitude)},address:{text:a.address}}};if(a.categories&&a.categories[0]&&a.categories[0].categoryId)b.icon=nokia.mh5.utils.place.getCategoryIconForFav(a.categories[0].categoryId);
if(a.placeId)b.placesId=a.placeId,b.categories=[{categoryId:a.categoryGroup}];return b},addServerFav:function(a,b){var c=g("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"add="+encodeURIComponent(JSON.stringify(this.mapClientToServer(a))),appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(c,function(a){b&&b(a)})},removeServerFav:function(a,b){var c=g("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",
{action:"delete="+encodeURIComponent(a),appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(c,function(){b&&b()})},listServerFavs:function(a){var b=g("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"list",appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(b,function(b){a&&a(b)})},favouritize:function(a){this.get(a).forEach(function(b){a.filter(function(a){return a.placeId===b.placeId})[0].favourite=
!0});return a}}})();nokia.mh5.provide("nokia.mh5.components.settings");
(function(){var h={mapSchema:"normal.day",cartoPois:!1,unitSystem:"km",analyticsEnabled:!0,trafficIncidentsEnabled:!1,trafficAccidentsEnabled:!0,trafficCongestionsEnabled:!0,trafficConstructionsEnabled:!0,trafficOthersEnabled:!0},c=JSON.parse(nokia.mh5.utils.getLocalStorageValue("settings")||"{}");nokia.mh5.components.settings={current:nokia.mh5.utils.getLocalStorageValue("settings")?function(){for(var a in c)c.hasOwnProperty(a)&&(h[a]=c[a]);return h}():h,get:function(a){return nokia.mh5.components.settings.current[a]},
set:function(a,f){c[a]=f;nokia.mh5.utils.setLocalStorageValue("settings",JSON.stringify(c));nokia.mh5.components.settings.current[a]=f}}})();nokia.mh5.provide("nokia.mh5.components.PlaceListItem");
nokia.mh5.components.PlaceListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(c,a){h.constructor.call(this,c,a);this.update()},update:function(){var c,a=!(!this.address&&!this.ratingValue);c="<div>"+('<img src="'+nokia.mh5.utils.place.getCategoryIcon(this)+'"></img>');a&&(c+="<div>");this.distance&&(c+='<div class="mh5_ColumnLayout"><div>');c+='<div class="mh5_ListItem_name">'+this.name+"</div>";this.placeId&&this.address&&
(c+='<div class="mh5_ListItem_address">'+this.address.replace(/\n/g,", ")+"</div>");if(this.distance){var f=nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem);c+='</div><div class="mh5_ListItem_distance">'+f+"</div></div>"}if(this.ratingValue){if(!this._rating)this._rating=new nokia.mh5.ui.Rating;this._rating.value=this.ratingValue;c+=this._rating.root.outerHTML}a&&(c+="</div>");this.root.innerHTML=c+"</div>"}}});nokia.mh5.provide("nokia.mh5.maps.sso");
nokia.mh5.sso=function(){var h=nokia.mh5.event,c=nokia.mh5.win,a=nokia.mh5.utils,f,g,d=function(b){b?(f=b,a.setLocalStorageValue("sso_user",JSON.stringify(b))):f=c.localStorage.removeItem("sso_user")};return{init:function(){var b;h.add(c,"message",function(a){if(-1!=="http://demo.maps.public.devbln.europe.nokia.com,http://localhost:4224,http://localhost,http://192.168.56.112:4224,http://192.168.56.101:4224,http://stg.m.maps.nokia.com,http://qa.mh5.public.devbln.europe.nokia.com,http://m.maps.nokia.com,http://convos.americas.nokia.com:8080,http://bsmacvm03.americas.nokia.com:8080,http://conversations-dev.americas.nokia.com:9090/,http://api.qa.pulse.nokia.com,https://ci.ovi.com,https://account.nokia.com".split(",").indexOf(a.origin)){if(a=
JSON.parse(a.data)){if(g)g.visible=!1;a.error||(d(a),h.fire(c,"sso_signin",a))}nokia.mh5.app.controller.current.page.visible=!0}});(b=a.getLocalStorageValue("sso_user"))&&(f=JSON.parse(b));this.isAuthenticated()},login:function(){return nokia.mh5.platform.android_webview?(g=new nokia.mh5.internals.LoginDialog,!0):c.open("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/sso/login.php")},logout:function(a){nokia.mh5.jsonp("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/sso/logout.php?jsonp",
function(){d();h.fire(c,"sso_signout");"function"===typeof a&&a()},1E4);g&&(g=null)},isAuthenticated:function(){if(f){var a=Math.round(Date.now()/1E3);if(!f.validuntil||f.validuntil<a)f=c.localStorage.removeItem("sso_user"),h.fire(c,"sso_signout")}return!!f},getUserData:function(a){return!this.isAuthenticated()?void 0:a?f[a]:f}}}();nokia.mh5.provide("nokia.mh5.maps.analytics");
(function(){var h=Math.round(1E4*Math.random()),c=!1,a=!1,f=nokia.mh5.components.settings,g=!0;nokia.mh5.ui.Control.watch(f.current,"analyticsEnabled",f.current,function(){g=this.analyticsEnabled});nokia.mh5.maps.analytics.log=function(d){if(g){var b=["http://metrics.nokia.com/b/ss/nokiaglobalmwg0prod".concat("/5/",h,"?D=~&ch=ovi:maps:mw&c6=ovimapsmwg0")],e;!a&&/[?&]cid=([^&#?]+)/.test(window.location.href)&&(b.push("&v0="+RegExp.$1),a=!0);for(e in d)d.hasOwnProperty(e)&&b.push("&"+e+"="+d[e]);!c&&
document.referrer&&(b.push("&r="+document.referrer+"&c30=~r&v30=~r"),c=!0);if(nokia.mh5.platform.android_webview||nokia.mh5.platform.ios_webview)b.push("&c50="+(nokia.mh5.platform.android_webview?"android native":"ios native")+"&v50=~c50");(new Image).src=encodeURI(b.join(""))}};nokia.mh5.maps.analytics.getPlaceId=function(a){return a.placeId||a.latitude+","+a.longitude};nokia.mh5.maps.analytics.getContext=function(a){var b="";a&&a.href&&(a=a.href.match(/context=([^?]+)/))&&a[1]&&(b=a[1]);return b};
nokia.mh5.maps.analytics.logIfVisible=function(a,b){a.visible&&!a._wasLogged&&nokia.mh5.maps.analytics.log(b);a._wasLogged=a.visible}})();nokia.mh5.provide("nokia.mh5.connectors.favourites.FavouritesViewer");
nokia.mh5.connectors.favourites.FavouritesViewer=new nokia.mh5.Class(nokia.mh5.ui.Page,function(h){var c,a=nokia.mh5.i18n,f=nokia.mh5.win,g=nokia.mh5.ui.Button,d=nokia.mh5.ui.Control,b=nokia.mh5.ui.Container,e=nokia.mh5.ui.RowLayout,o=nokia.mh5.ui.Notification,i=nokia.mh5.ui.List,j=nokia.mh5.event,l=nokia.mh5.sso,m=nokia.mh5.components.favourites,n=function(){var a=l.isAuthenticated(),b=c.header;b.signin.visible=!a&&!nokia.mh5.platform.android_webview;b.refresh.visible=a};return{cssClass:"mh5_FavouritesViewer",
children:["header","noFavourites","favourites","notification"],layout:{type:e},header:{control:b,layout:{type:nokia.mh5.ui.ColumnLayout},cssClass:"mh5_ssoContainer",children:["title","signin","refresh"],title:{control:d,cssClass:"mh5_title",rootHtmlElementName:"h1",build:function(){var b=function(){var b=l.getUserData("greetingname");return(b?b+"'s ":" ")+a("favourites")};this.root.innerHTML=b();j.add(nokia.mh5.win,["sso_signin","sso_signout"],function(){this.root.innerHTML=b()}.bind(this))}},signin:{control:g,
cssClass:"mh5_action mh5_SignIn mh5_baseColor",build:function(){this.root.onclick=l.login},text:a("signin")},refresh:{control:g,cssClass:"mh5_action mh5_Refresh mh5_baseColor",onClick:function(){this.parent.parent.update()},text:a("refresh"),visible:!1}},noFavourites:{control:d,cssClass:"mh5_noFavourites mh5_RowLayout",visible:!1,innerHTML:'<div class="mh5_divider"></div><h3>'+a("FV.startSaving")+"</h3><div>"+a("FV.startSavingHint")+'</div><ul> <li><div class="mh5_icon"></div><div class="itemtext"><h3>'+
a("addingA")+" "+a("favourite")+"</h3><p>"+a("FV.simplyTap")+'</p></div></li><li><div class="mh5_icon mh5_active"></div><div class="itemtext"><h3>'+a("removingA")+" "+a("favourite")+"</h3><p>"+a("FV.tapTheHighlighted")+'</p></div></li></ul><div class="mh5_divider"></div>'},favourites:{control:b,layout:{type:e},children:["header","list"],cssClass:"mh5_favourites mh5_primaryColorBright",visible:!1,header:{control:d,id:"header",rootHtmlElementName:"h1",visible:!1,innerHTML:a("FV.syncedFavourites")},
list:{control:i,id:"list",itemClass:nokia.mh5.components.PlaceListItem,itemsDidChange:function(a){var b=nokia.mh5.geolocation;if(a&&b.available)for(var c=0,d=a.length;c<d;c++)a[c].distance=nokia.mh5.math.pointDistance(b.coords,a[c]);this.constructor.prototype.itemsDidChange.apply(this,arguments)},onClick:function(a){var b=nokia.mh5.maps.analytics;b.log({gn:"favourites:place",c32:"open place",v32:"~c32",c44:b.getPlaceId(this.items[a]),v44:"~c44"});nokia.mh5.app.controller.details(this.items[a])}}},
notification:{control:o,visible:!1},constructor:function(){h.constructor.call(this);c=this;j.add(nokia.mh5.win,["sso_signin","sso_signout"],function(a){n();"sso_signout"===a.type&&m.clear();c.update()});n()},update:function(){c=this;var b=c.notification,d=c.favourites,e=c.noFavourites,g=function(){var a=m.get();e.visible=0===a.length;d.visible=!e.visible;d.list.items=a},h;l.isAuthenticated()?(h=f.setTimeout(function(){b.timeout=o.TIMEOUT_DEFAULT;b.text=a("FV.couldNotSync")},15E3),b.timeout=o.TIMEOUT_INFINITY,
b.text=a("FV.syncing"),b.visible=!0,m.synchronize(function(){g();f.clearTimeout(h);b.timeout=o.TIMEOUT_DEFAULT;b.text=a("FV.syncedFavourites")})):g()},visibleDidChange:function(a){a&&this.update();h.visibleDidChange.apply(this,arguments)}}});nokia.mh5.provide("nokia.mh5.app.controller");
(function(){var h=nokia.mh5.history,c={},a={},f=function(a,b){return{page:a,params:b,onPopState:function(a,b){nokia.mh5.app.controller.currentViewState=a;nokia.mh5.app.controller.switchTo(a.page,a.params,{dontPushToHistory:!0,isHistory:!b})}}},g=nokia.mh5.app.controller={queue:[],setConfiguration:function(c){a=c},getPage:function(d){return a[d]?c[d]||(c[d]=new nokia.mh5.ui.Page(a[d])):new (nokia.mh5.require(d))},resetViewCache:function(){c={}},getMap:function(){var a=this.current.page;return a.map?
a.map:a.children.map(function(b){return nokia.mh5.resolve(b+".map",a)}).filter(function(a){return!!a&&a instanceof nokia.mh5.components.Map}).pop()},switchTo:function(a,b,c){var f=this.domNode||nokia.mh5.doc.body,h=this.current,j=g.getPage(a);if(this.inTransition)this.queue.unshift(arguments);else if(this.current={name:a,page:j},b&&j.setModel(b),c&&c.replaceLastHistoryEntry?this.updateHistoryEntry():(!c||!c.dontPushToHistory)&&this.pushHistoryEntry(this.current.name,j.getNavigationState(),j.getHash()),
!(h&&h.name===a))if(h)this.inTransition=!0,f={type:"slide",parentNode:f,node:j.root,previousNode:h.page.root,isHistory:c&&c.isHistory,onNodeAttached:function(){if(!j.visible)j.visible=!0,c&&c.intoView&&j.intoView&&j.intoView(c.intoView)},callback:function(){this.inTransition=!1;h.page.visible=!1;if(0<this.queue.length)setTimeout(function(){this.switchTo.apply(this,this.queue.shift())}.bind(this),0);else{var a=document.createEvent("Event");a.initEvent("hideAddressBar",!0,!0);nokia.mh5.win.dispatchEvent(a)}}.bind(this)},
nokia.mh5.dom.doTransition(f);else if(f.appendChild(j.root),!j.visible)j.visible=!0,c&&c.intoView&&j.intoView&&j.intoView(c.intoView)},updateHistoryEntry:function(){if(this.browserHistory){var a=this.current.name,b=this.current.page,c=this.currentViewState=f(a,b.getNavigationState()),g=this.manipulateUrl?"#action="+mappings[a]+"&params="+encodeURIComponent(b.getHash())+"&bmk=1":"";b.model.traffic&&(g+="&traffic=true");h.replaceState(c,a,g)}},pushHistoryEntry:function(a,b,c){if(this.browserHistory)b=
this.currentViewState=f(a,b),c=mappings[a]&&this.manipulateUrl?"#action="+mappings[a]+"&params="+encodeURIComponent(c)+"&bmk=1":"",h.pushState(b,a,c)},back:function(){this.browserHistory&&h.back()},showOnMap:function(a){this.switchTo("search",a)},route:function(a){if(a&&a.from&&a.to){var b="walk";5E3<nokia.mh5.math.pointDistance(a.from,a.to)&&(b="drive");a.parameters=a.parameters||{};a.parameters.mode=b}this.switchTo("route",a)},share:function(a){this.switchTo("share",{data:a})},details:function(a){this.switchTo("search",
{selection:a,mapMode:!0,showDetails:!0})}}})();nokia.mh5.provide("nokia.mh5.adapters.Search");
(function(){var h=nokia.mh5.i18n,c=nokia.mh5.utils,a=nokia.mh5.geolocation,f=Object.prototype.hasOwnProperty;nokia.mh5.adapters.Search={merge:function(a,c){for(var b in c)f.call(c,b)&&("object"===nokia.mh5.type(a[b])&&"object"===nokia.mh5.type(c[b])?c[b]!==a[b]&&c[b]!==a&&(a[b]=nokia.mh5.adapters.Search.merge(a[b],c[b])):void 0===a[b]&&(a[b]=c[b]));return a},formatAddress:function(a){if(!a)return"";var c=a.addrCountryCode||a.countryCode,b=a.addrCountryName||a.country||c,e=a.addrCityName||a.city,f=
e,h=a.addrStateCode||a.state,j=a.addrPostalCode||a.postCode,l=a.addrStreetName||a.thoroughfare&&a.thoroughfare.name,a=a.addrHouseNumber||a.thoroughfare&&a.thoroughfare.number,c=c&&-1<"USA CAN NZL IND GBR AUS IRL FRA LKA".indexOf(c),m=[];l&&(a?m.push(c?a+" "+l:l+" "+a):m.push(l));e&&(c?(h&&(f+=", "+h),j&&(f+=" "+j),m.push(f)):m.push(j?j+" "+e:e));b&&m.push(b);return m.join(", ")},map:function(a,c){var b=nokia.mh5.math.pointDistance,b={address:c.vicinity,placeId:c.id,icon:c.icon,href:c.href,categoryName:c.category.id,
latitude:c.position[0],longitude:c.position[1],distance:a&&b(a,{latitude:c.position[0],longitude:c.position[1]}),name:c.title,ratingValue:c.averageRating};if(c.bbox)b.boundingBox=[{latitude:c.bbox[3],longitude:c.bbox[0]},{latitude:c.bbox[1],longitude:c.bbox[2]}];if(nokia.mh5.components.favourites.get(b))b.favourite=!0;return b},fetch:function(g,d,b,e){var f=nokia.mh5,i=f.adapters.Search,j=i.merge,l,m,n=d&&d.appId||f.appId,p=d&&d.appCode||f.appCode;if(c.isPlace(g))if(l="placeId="+g.placeId,m=c.cacheObject(l))j(g,
m),b(g);else{if(!n||!p)throw Error(h("Error.applicationCredential"));d={app_id:n,app_code:p,ScreenSize:f.win.innerWidth+"x"+f.win.innerHeight};g.href?d.placeUrl=g.href:d.place=g.placeId;a.available&&(d.geolocation="geo:".concat(a.latitude,",",a.longitude,";u=",a.coords.accuracy));f.jsonp("http://m.maps.nokia.com/releases/1.8.0/server/index.php?"+c.formatURLParams(d)+"&jsonp",function(a){if(a&&a.name&&a.latitude&&a.longitude){j(g,a);var d=nokia.mh5.components.favourites.get(g);if(d)g.favourite=!0,
d.categoryGroup!==a.categoryGroup&&nokia.mh5.components.favourites.set(a);c.cacheObject(l,c.purify(g));b(g)}else e&&e(a.error),c.cacheObject(l,null)},2E4)}else if(!g.longitude||!g.latitude)e&&e();else if(l="lat="+g.latitude+"&lon="+g.longitude,m=c.cacheObject(l))j(g,m),b(g);else{g.name=g.name||g.address;if(f=nokia.mh5.components.favourites.get(g))g.favourite=!0,f.categoryGroup!==g.categoryGroup&&nokia.mh5.components.favourites.set(g);g.name?(c.cacheObject(l,c.purify(g)),b(g,!0)):i.reverseGeoCode(g,
d,function(a){g.name=g.address=a.name;c.cacheObject(l,c.purify(g));b(g)})}},getRecommendations:function(g,d,b,e){var f=nokia.mh5,i=f.adapters.Search.merge,j,l;l=d&&d.appId||f.appId;var m=d&&d.appCode||f.appCode;if(!g.longitude||!g.latitude)e&&e();else if(j=g.placeId?"placeId="+g.placeId:"lat="+g.latitude+"&lon="+g.longitude,(e=c.cacheObject(j))&&e.recommendations)i(g,e),b(e);else{if(!l||!m)throw Error(h("Error.applicationCredential"));l={app_id:l,app_code:m,lat:g.latitude,lon:g.longitude};if(g.placeId)l.place=
g.placeId;d&&d.init&&(l.init="true");a.available&&(l.geolocation="geo:".concat(a.latitude,",",a.longitude,";u=",a.coords.accuracy));return f.jsonp("http://m.maps.nokia.com/releases/1.8.0/server/index.php?"+c.formatURLParams(l)+"&jsonp",function(a){i(g,a);c.cacheObject(j,c.purify(g));b(g)},5E3)}},search:function(g,d,b,e){nokia.mh5.each(d,function(a,b){"function"===typeof a&&(d[b]=a())});var f=d.center||d.map.center,i=d.box||d.map.box,j=i[0],i=i[1],l=d.position||d.map&&d.map.position,m=d.suggestions,
n="http://places.nlp.nokia.com/places/v1/"+(m?"suggest/":"discover/search/"),p=d.appId||nokia.mh5.appId,x=d.appCode||nokia.mh5.appCode;if(!p||!x)throw Error(h("Error.applicationCredential"));g={app_code:x,app_id:p,q:g,at:f.latitude+","+f.longitude,size:d.limit||(m?4:25),tf:"plain"};j.longitude&&i.latitude&&i.longitude&&j.latitude&&(g["X-Map-Viewport"]="".concat(j.longitude,",",i.latitude,",",i.longitude,",",j.latitude));a.available&&(g.geolocation="geo:".concat(a.latitude,",",a.longitude,";u=",a.coords.accuracy));
nokia.mh5.jsonp(n+"?"+c.formatURLParams(g)+"&callback",function(a){if(a.error){if(e){var c;"timeout"===a.error&&(c=h("Notification.searchProblem"));e(c)}}else if(m)b(a.suggestions);else{var a=a.results.items||[],g,a=a.map(this.map.bind(this,l));d.map&&0<a.length&&(g=this._getBoundingBox(a,d.map));b({results:a,box:g})}}.bind(this),1E4)},getSuggestions:function(a,c,b,e){var f=c.suggestions;c.suggestions=!0;this.search(a,c,b,e);c.suggestions=f},reverseGeoCode:function(a,c,b,e){var f=c&&c.appId||nokia.mh5.appId,
c=c&&c.appCode||nokia.mh5.appCode;if(!f||!c)throw Error(h("Error.applicationCredential"));nokia.mh5.jsonp("http://geo.nlp.nokia.com/search/6.2/reversegeocode.json".concat("?token="+c+"&app_id="+f,"&prox=",a.latitude,",",a.longitude,"&mode=retrieveAddresses&jsoncallback"),function(a){var c,d;!a.error&&a.Response&&a.Response.View&&a.Response.View[0]&&a.Response.View[0].Result&&a.Response.View[0].Result[0]?(a=a.Response.View[0].Result[0],c=a.Location.DisplayPosition,d=a.Location.Address.Label,b({name:d,
address:d,latitude:c.Latitude,longitude:c.Longitude,properties:a.Location.Address})):e&&("timeout"===a.error&&(c=h("Notification.searchProblem")),e(c))},1E4)},_getBoundingBox:function(a,c){var b=a[0].boundingBox,e=[];if(!b){for(var f=0,h=a.length;f<h;f++)b=a[f],b.hasOwnerContent||e.push(b);e.push(c.center);b=c._map.getZoomLevelFor(e);c.covers(e)?17>b&&17>c.zoom?b=e:(c.zoom=16,b=c.box):12<=b?b=e:(c.zoom=12,c.center=e[0],b=c.box)}return b}}})();nokia.mh5.provide("nokia.mh5.l10n");
nokia.mh5.l10n={imperial:{us:1,gb:1,lr:1,mm:1},tileLanguageMap:{ar:"ARA",zh:"CHI",es:"SPA",fr:"FRE",it:"ITA",de:"GER",ru:"RUS"}};nokia.mh5.provide("nokia.mh5.components.Traffic");
(function(){var h={Accidents:"Accident",Constructions:"Construction",Congestions:"Congestion",Others:"DisabledVehicle,RoadHazard,MassTransit,OtherNews,Weather,Misc,PlannedEvent"},c=function(a){return this=="routeInfo"in a.data},a=function(a){return a.data.incident},f="http://traffic.nlp.nokia.com/traffic/6.0/",g=nokia.mh5.event,d=nokia.mh5.i18n,b=nokia.mh5.components.settings,e=nokia.mh5.utils;nokia.mh5.components.Traffic=new nokia.mh5.Class(nokia.mh5.ui.Container,function(o){function i(a,b){return a.location.latitude-
b.location.latitude||a.location.longitude-b.location.longitude}function j(a,b){return a.incident.criticality-b.incident.criticality||b.incident.id-a.incident.id}function l(a,b){return nokia.mh5.assetsPath+"img/mapsymbols/tmc_"+a+"_"+b+"_pole.png"}function m(a){var b=[];if(0<a.length){b.push(a[0]);for(var c=1;c<a.length;++c){var e=b[b.length-1],d=a[c];0===i(e,d)?b[b.length-1]=0<j(e,d)?d:e:b.push(d)}}return b}function n(a){var b=60*(60*(24*a.getDay()+a.getHours())+a.getMinutes())+a.getSeconds();return function(a,
c,d,g){a=f+"tiles/"+g+"/"+a+"/"+c+"/256/png32";c={appId:nokia.mh5.app.APP_ID,token:nokia.mh5.app.APP_CODE};c.pattern_time=b;return a+"?"+e.formatURLParams(c)}}function p(a){return a.TYPE&&a.content&&a.TYPE==this}function x(a){var b,c,e,d,f;if(a.LOCATION&&a.LOCATION.GEOLOC&&a.LOCATION.GEOLOC.ORIGIN){d=a.LOCATION.GEOLOC.ORIGIN;c={id:""+a.TRAFFICITEMID,startTime:new Date(Date.parse(a.STARTTIME)),endTime:new Date(Date.parse(a.ENDTIME))};b={location:{latitude:d.LATITUDE,longitude:d.LONGITUDE}};e="high";
if(a.CRITICALITY&&a.CRITICALITY.ID)c.criticality=a.CRITICALITY.ID|0,"0"===a.CRITICALITY.ID?e="blocking":"1"===a.CRITICALITY.ID&&(e="veryhigh");switch(a.TRAFFICITEMTYPEDESC){case "CONSTRUCTION":b.icon=l(e,"roadworks");break;case "ACCIDENT":b.icon=l(e,"accident");break;case "CONGESTION":b.icon=l(e,"congestion");break;default:b.icon=l(e,"other")}if(a.TRAFFICITEMDETAIL&&a.TRAFFICITEMDETAIL.ROADCLOSED)c.criticality=0,b.icon=l("blocking","closure");c.type=a.TRAFFICITEMTYPEDESC[0]+a.TRAFFICITEMTYPEDESC.slice(1).toLowerCase();
if(a.LOCATION.DEFINED&&a.LOCATION.DEFINED.ORIGIN){d=a.LOCATION.DEFINED.ORIGIN;f=d.POINT.DESCRIPTION;e=d.DIRECTION.DESCRIPTION;if(f)d=f.filter(p,"LOCAL")[0],c.origin=d&&d.content;if(e)d=e.filter(p,"LOCAL")[0],c.direction=d&&d.content}else if(a.LOCATION.INTERSECTION&&a.LOCATION.INTERSECTION.ORIGIN)d=a.LOCATION.INTERSECTION.ORIGIN,f=a.LOCATION.INTERSECTION.TO,c.origin=d.STREET1&&d.STREET1.ADDRESS1,c.start=d.STREET2&&d.STREET2.ADDRESS1,c.end=f&&f.STREET2&&f.STREET2.ADDRESS1;if(a.RDSTMCLOCATIONS&&a.RDSTMCLOCATIONS.RDSTMC&&
0<a.RDSTMCLOCATIONS.RDSTMC.length){e=a.RDSTMCLOCATIONS.RDSTMC;f=e[0];var g=1;for(d=f.ALERTC;g<e.length;){if(e[g].DIRECTION&&e[g].DIRECTION!==f.DIRECTION){c.bidirectional=!0;break}g+=1}c.start=f.ORIGIN&&f.ORIGIN.LOCATIONDESC;c.end=f.TO&&f.TO.LOCATIONDESC;c.description=d&&d.DESCRIPTION&&d.DESCRIPTION.replace(/\s*\(Q\)\s*/g," ").replace(/\s*\(([^\/]*)\/\/[^\)]*\)\s*/g," $1 ").replace(/\s*--\s*/," ").replace(/^\s*/,"").replace(/\s*$/,"")}d=a.TRAFFICITEMDESCRIPTION&&a.TRAFFICITEMDESCRIPTION.filter(p,"desc")[0];
c.description=c.description||d&&d.content;b.incident=c}return b}return{_map:null,_mapReady:!1,_currentRequest:null,displayIncidents:!1,statics:{getTrafficTypes:function(){return Object.keys(h)},removeNonTrafficPois:function(a){var b=a.getPois();a.removePoi(b.filter(function(a){return!a.data.incident}))}},_clearIncidentsFromMap:function(){this._map.removePoi(this._map.getPois().filter(function(a){return a.data.incident&&!a.originalImage}))},_resetPois:function(b){this._clearIncidentsFromMap();for(var c=
this._map.infoBubbles.filter(a)[0],e=0,f=b.length;e<f;e++)if(!c||!(b[e].location.latitude==c.data.latitude&&b[e].location.longitude==c.data.longitude)){var g=this._map.createPoi(b[e].icon,b[e].location),h=b[e].incident,n=h.origin,i=h.direction;g.data.name=h.type;if(n)g.data.description=d("maps.Traffic.incidentDescription"+(i?"":"NoDirection"),{origin:n,direction:i});g.data.icon=b[e].icon;g.data.incident=h}},_processIncidentsResponse:function(a){var b=[],c=this._timeTravelDate||new Date;a.TRAFFICITEMS&&
a.TRAFFICITEMS.TRAFFICITEM&&(b=a.TRAFFICITEMS.TRAFFICITEM.map(x).filter(function(a){return a&&a.incident.startTime<=c&&a.incident.endTime>=c}));b.sort(i);b=m(b);b.sort(j);40<b.length&&b.splice(39,b.length-40);this._currentRequest=null;this._incidentPois=b;this._resetPois(b)},_types:function(a){return h[a]},_getType:function(){var a=[],c=this;nokia.mh5.each(nokia.mh5.components.Traffic.getTrafficTypes(),function(e){b.get("traffic"+e+"Enabled")&&a.push(c._types(e))});return a.join(",")},_reloadIncidents:function(a,
c){if("undefined"!==typeof a&&"undefined"!==typeof c&&"undefined"!==typeof c[0]&&!isNaN(c[0].latitude)){var d=this._map.geoToPoint(this._map.center),g=this._getType(),h=b.get("trafficIncidentsEnabled"),n=this;d.x=d.x/256|0;d.y=d.y/256|0;if(this.displayIncidents&&g&&h&&8<a){var i=f+"incidents.json?"+e.formatURLParams({appId:nokia.mh5.appId,token:nokia.mh5.appCode,bbox:c[0].latitude+","+c[0].longitude+";"+c[1].latitude+","+c[1].longitude,status:"active",type:g,criticality:"critical,major,minor"})+"&jsoncallback";
if(i+n._timeTravelDate!==n._incidentsUri){if(n._currentRequest)n._currentRequest.cancel(),n._currentRequest=null;n._timeoutId&&nokia.mh5.win.clearTimeout(n._timeoutId);n._timeoutId=nokia.mh5.win.setTimeout(function(){delete n._timeoutId;g=n._getType();if(n.displayIncidents&&g)n._currentRequest=nokia.mh5.jsonp(i,n._processIncidentsResponse)},1E3);n._incidentsUri=i+n._timeTravelDate}else n._resetPois(n._incidentPois)}else n._clearIncidentsFromMap()}},_showInfoBubble:function(a){var b={content:["title",
"description"],left:a.data.icon,listeners:this._map.infoBubbleParams&&this._map.infoBubbleParams.listeners};this._map.hideInfoBubble(this._map.infoBubbles.filter(c,!1));this._map.showInfoBubble(a,b)},constructor:function(a,b){this._onReady=this._onReady.bind(this);this._onZoom=this._onZoom.bind(this);this._onMove=this._onMove.bind(this);this._onPoiClick=this._onPoiClick.bind(this);this._processIncidentsResponse=this._processIncidentsResponse.bind(this);this._incidentPois=[];Object.defineProperty(this,
"map",{get:function(){return this._map},set:function(a){this._map&&(g.remove(this._map,"ready",this._onReady),g.remove(this._map._map,"mapzoomchange",this._onZoom),g.remove(this._map._map,"mapmoveend",this._onMove),g.remove(this._map._map,"poiclick",this._onPoiClick));if(this._map=a)g.add(this._map,"ready",this._onReady),g.add(this._map._map,"mapzoomchange",this._onZoom),g.add(this._map._map,"mapmoveend",this._onMove),g.add(this._map._map,"poiclick",this._onPoiClick)}});o.constructor.call(this,a,
b)},mapSchemaBinding:"nokia.mh5.components.settings#current.mapSchema",mapSchemaDidChange:function(a){if(a&&"normal.day.traffic"==a){var a=nokia.mh5.app.controller.current,b=this._map,c;if(a&&a.page.timeTraveling)c=a.page.header.route.mode.timetravel,c.day.backToDefault(),c.time.backToDefault(),a.page.resetNotification();b&&b.hasLayer("timeTravelTraffic")&&b.removeLayer("timeTravelTraffic")}},_onReady:function(){this._mapReady=!0;if(b.get("trafficIncidentsEnabled"))this.displayIncidents=!0,this._reloadIncidents(this._map.zoom,
this._map.box)},_onZoom:function(b){if(8>=b.data.newValue){var c=this._map.infoBubbles.filter(a)[0];c&&this._map.hideInfoBubble(c)}b.data.oldValue!==b.data.newValue&&this._reloadIncidents(b.data.newValue,this._map.box)},_onMove:function(){this._reloadIncidents(this._map.zoom,this._map.box)},_onPoiClick:function(a){var b=a.data[0];b.data&&b.data.incident&&!b.infoBubble&&(this._showInfoBubble(b),a.preventDefault())},enableTraffic:function(){this.displayIncidents=!0;b.set("mapSchema","normal.day.traffic");
b.set("trafficIncidentsEnabled",!0);nokia.mh5.components.Traffic.getTrafficTypes().forEach(function(a){b.set("traffic"+a+"Enabled",!0)})},enableTimeTravelTraffic:function(c){var e=this._map;this._timeTravelDate=c=c||new Date;var d=this._map.infoBubbles.filter(a)[0];d&&d.data.incident.endTime<this._timeTravelDate&&e.hideInfoBubble(d);this._reloadIncidents(e.zoom,e.box);"normal.day.traffic"==b.get("mapSchema")&&!e.hasLayer("timeTravelTraffic")&&(b.set("mapSchema","normal.day"),e.addLayer(n(c),"timeTravelTraffic"))},
disableTimeTravelTraffic:function(){this._timeTravelDate=null;this._map.hasLayer("timeTravelTraffic")&&this._map.removeLayer("timeTravelTraffic");this._reloadIncidents(this._map.zoom,this._map.box)},reloadIncidents:function(){this._reloadIncidents(this._map.zoom,this._map.box)},showIncidents:function(){if(!this.displayIncidents)this.displayIncidents=!0,this._reloadIncidents(this._map.zoom,this._map.box)},hideIncidents:function(){if(this.displayIncidents){this.displayIncidents=!1;if(this._currentRequest)this._currentRequest.cancel(),
this._currentRequest=null;this._clearIncidentsFromMap()}},checkInfoBubbleOnIncidentsChange:function(){var c=this._map.infoBubbles.filter(a)[0];c&&(!b.get("trafficIncidentsEnabled")||!b.get("traffic"+c.data.incident.type+"sEnabled"))&&this._map.hideInfoBubble(c)}}})})();nokia.mh5.provide("nokia.mh5.ui.Dialog");
nokia.mh5.ui.Dialog=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){var c=function(a){a.preventDefault&&a.stopPropagation&&(a.preventDefault(),a.stopPropagation())},a=nokia.mh5.dom.addEvent,f=nokia.mh5.dom.removeEvent;return{cssClass:"mh5_modal",animationName:"fading",children:["content"],content:{control:nokia.mh5.ui.Container,cssClass:"mh5_Dialog"},allowScrolling:!1,closeOnTap:!1,disableUpdatePosition:!1,constructor:function(a,c){h.constructor.call(this,a,c);this.update&&this.update();this._updatePosition()},
build:function(){["_closeDialog","_updatePosition","_delayedUpdatePosition","_onPointerDetect"].forEach(function(a){this[a]=this[a].bind(this)},this);h.build.call(this);this._scroll&&nokia.mh5.win.setTimeout(this._scroll.refresh,0)},_closeDialog:function(a){a&&c(a);if(this.visible)this.visible=!1},_onPointerDetect:function(f){this.closeOnTap&&a(this.root,f.touch?"down":"tap",this._closeDialog);this.allowScrolling||(f.touch?a(this.root,"move",c):a(nokia.mh5.win,"scroll",this._closeDialog))},_addHandlers:function(){a(nokia.mh5.win,
"pointerdetect",this._onPointerDetect,!1);a(nokia.mh5.win,"viewportchange",this._delayedUpdatePosition,!1)},_removeHandlers:function(){f(nokia.mh5.win,"pointerdetect",this._onPointerDetect,!1);f(nokia.mh5.win,"viewportchange",this._delayedUpdatePosition,!1)},visibleDidChange:function(a){var c={type:"fade",mode:"in",node:this.root};if(a)this._addHandlers(),nokia.mh5.history.catchNextOnPopState=this._closeDialog;else if(this.root.parentNode){this._removeHandlers();delete nokia.mh5.history.catchNextOnPopState;
if(this.withoutAnimation){var b=this.root,e=b.parentNode;if(this.onClose)this.onClose();setTimeout(function(){e&&e.removeChild(b)},0);return}c.mode="out";if(this.onClose)c.callback=this.onClose.bind(this)}if(nokia.mh5.platform.android&&4>nokia.mh5.platform.android.version)c.fadeNode=this.root.firstChild;nokia.mh5.dom.doTransition(c)},_delayedUpdatePosition:function(){nokia.mh5.win.setTimeout(this._updatePosition,400)},_updatePosition:function(){if(!this.disableUpdatePosition)if(this.allowScrolling){if(this.content&&
this.content.root)this.root.style.cssText="min-height: 100%;height: "+Math.max(nokia.mh5.win.innerHeight,this.content.root.offsetHeight)+"px;overflow-x: hidden"}else this.root.style.cssText="height: "+(nokia.mh5.win.innerHeight+1)+"px;overflow: hidden;margin-top: "+nokia.mh5.win.pageYOffset+"px;"}}});nokia.mh5.provide("nokia.mh5.ui.SegmentedButton");
nokia.mh5.ui.SegmentedButton=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{cssClass:"mh5_SegmentedButton mh5_ColumnLayout",_selectedIndex:void 0,constructor:function(c,a){c.items=c.items||[];h.constructor.call(this,c,a);this.update()},_clickHandler:function(c){if(!(this._selectedIndex===c||this.items[c].disabled))if(void 0!==this._selectedIndex&&nokia.mh5.dom.removeClass(this.root.children[this._selectedIndex],"mh5_selected"),nokia.mh5.dom.addClass(this.root.children[c],"mh5_selected"),
this._selectedIndex=c,this.onValueChange)this.onValueChange(this.items[c].value||c)},select:function(c){if(null==c)this._selectedIndex=void 0;else{for(var a=0,f=this.items.length;a<f;a++)if(this.items[a].value===c){this._clickHandler(a);return}this.items[c]&&this._clickHandler(c)}},update:function(){var c=nokia.mh5.doc.createDocumentFragment(),a,f;for(f in this.items)this.items.hasOwnProperty(f)&&(a=this._createItem(this,parseInt(f,10)),c.appendChild(a.root));this.root.innerHTML="";this.root.appendChild(c)},
_createItem:function(c,a){var f=this,g=c.items[a],d=a===c._selectedIndex?["mh5_selected"]:[],b=!g.name&&g.iconClass?"":g.name||"Item "+(a+1);g.cssClass&&d.push(g.cssClass);g.disabled&&d.push("mh5_disabled");return new nokia.mh5.ui.Control({cssClass:d.join(" "),onClick:function(b){f._clickHandler(a);b.stopPropagation()},innerHTML:g.iconClass?"<div class='"+g.iconClass+"'/>":"<div>"+b+"</div>"})},add:function(c){this.items.push(c);this.update()},remove:function(c){for(var a=null,f=[],g=0,d=this.items.length;g<
d;g++)f.push(this.items[g]),this.items[g].value===c&&(a=g);!a&&this.items[c]&&(a=c);if(a){this.items=[];this.items=f.slice(0,a).concat(f.slice(a+1));if(a<=this._selectedIndex)this._selectedIndex=a===this._selectedIndex?void 0:this._selectedIndex-1;this.update()}}}});nokia.mh5.provide("nokia.mh5.ui.RadioItem");
nokia.mh5.ui.RadioItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(c,a){h.constructor.call(this,c,a);this.update()},update:function(){this.root.innerHTML="<div class='mh5_name'>"+this.title+"</div><div class='mh5_status'></div>";nokia.mh5.dom[this.disabled?"addClass":"removeClass"](this.root,"mh5_disabled")}}});nokia.mh5.provide("nokia.mh5.ui.SettingsDialog");
(function(){var h=nokia.mh5.components.settings,c=nokia.mh5.dom,a=nokia.mh5.event,f=nokia.mh5.ui,g=f.Container,d=f.Control,b=f.List,e=f.RadioItem;nokia.mh5.ui.SettingsDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(o){var i=nokia.mh5.i18n,j;return{cssClass:"mh5_SettingsDialog",allowScrolling:!0,constructor:function(a,b){var c=this.content.children.indexOf("settingsToggleIndicator"),e,d;if(!a.traffic&&~c)e=this.content.settingsToggle,d=e.items,this.content.children.splice(c,1),delete e.onValueChange,
d.pop(),d[0].name=i("mapControl"),d[0].cssClass+=" mh5_box-flex1";o.constructor.call(this,a,b)},content:{control:g,cssClass:"mh5_SettingsDialogContainer",vScroll:!0,bounce:!1,layout:{type:f.RowLayout,align:"strech"},children:"mapOffset,settingsToggle,settingsToggleBorder,settingsToggleIndicator,settingsList,fillup".split(","),mapOffset:{control:g,cssClass:"mh5_mapOffset"},settingsToggle:{control:f.SegmentedButton,cssClass:"mh5_SettingsToggle mh5_ColumnLayout mh5_standardBackgroundColorDark",items:[{name:i("maps"),
value:"maps",cssClass:"settings_maps"},{name:i("layers"),value:"layers",cssClass:"settings_layers"}],onValueChange:function(a){var b=this.parent.settingsList,c=this.root.querySelector(".mh5_selected"),c=Math.round(c.offsetLeft+c.offsetWidth/2);this.parent.settingsToggleIndicator.root.style[(nokia.mh5.platform.ie?"ms":"webkit")+"Transform"]="translateX("+c+"px)";"maps"==a?(b.maps.visible=!0,b.layers.visible=!1):(b.maps.visible=!1,b.layers.visible=!0);this.parent.parent.resize()}},settingsToggleBorder:{control:d,
cssClass:"mh5_SettingsIndicatorBorder"},settingsToggleIndicator:{control:d,cssClass:"mh5_SettingsIndicator",innerHTML:"<div></div>"},settingsList:{control:g,cssClass:"mh5_SettingsList mh5_standardBackgroundColorDark",children:["maps","layers"],maps:{control:g,children:["mapModeRadioGroup","communityMap","unitSystemToggle","footnote"],mapModeRadioGroup:{control:b,cssClass:"mh5_mapTypes mh5_List",itemClass:e,items:[{title:i("UI.SettingsDialog.mapView"),schema:"normal.day"},{title:i("UI.SettingsDialog.satView"),
schema:"hybrid.day"},{title:i("UI.SettingsDialog.PTView"),schema:"normal.day.transit"},{title:i("UI.SettingsDialog.trafficView"),schema:"normal.day.traffic"}],listeners:{tap:function(a){var b=a.data.index,e=a.data.item,a=a.data.community,d=this.parent.communityMap,f=d.renderedItems[0],g=a||c.hasClass(f.root,"mh5_selected")&&2>b;if(!e.disabled){var i=this.getContentRoot();c.removeClass(i.children[j],"mh5_selected");c.addClass(i.children[b],"mh5_selected");e=g?e.schema+".community":e.schema;e!==h.get("mapSchema")&&
(h.set("mapSchema",e),nokia.mh5.maps.analytics.log({gn:"settings",c32:"change schema",v32:"~c32"}));j=b;f.disabled=d.items[0].disabled=1<b;f.update();a&&c.addClass(f.root,"mh5_selected")}}}},communityMap:{control:b,itemClass:e,cssClass:"mh5_List mh5_RowLayout mh5_TrafficOnOff mh5_CommunityMap",items:[{title:i("UI.SettingsDialog.CommunityMaps")+"*",value:!0}],listeners:{tap:function(a){var b=this.root.children[0],e=c.hasClass(b,"mh5_selected"),d=h.get("mapSchema");a.data.item.disabled||(c[e?"removeClass":
"addClass"](b,"mh5_selected"),h.set("mapSchema",e?d.slice(0,-10):d+".community"))}}},unitSystemToggle:{control:f.SegmentedButton,cssClass:"mh5_SegmentedButton mh5_UnitSystemToggle mh5_ColumnLayout",items:[{name:i("UI.SettingsDialog.Km"),value:"km"},{name:i("UI.SettingsDialog.Miles"),value:"mi"}],onValueChange:function(a){h.get("unitSystem")!=a&&(h.set("unitSystem",a),nokia.mh5.maps.analytics.log({gn:"settings",c32:"change units",v32:"~c32"}))}},footnote:{control:d,cssClass:"mh5_CommunityFootnote",
innerHTML:"<p>* "+i("UI.SettingsDialog.CommunityMapFootnote")+"</p>"}},layers:{control:g,children:["trafficOnOffSwitch","trafficSettingsContainer","criticalitySigns"],visible:!1,trafficOnOffSwitch:{control:b,itemClass:e,cssClass:"mh5_List mh5_RowLayout mh5_TrafficOnOff",items:{title:"Traffic Incidents",value:!0},onClick:function(){var a=this.root.children[0],b=this.getRootOwnerByClass(f.SettingsDialog);nokia.mh5.maps.analytics.log({gn:"settings",c32:!nokia.mh5.dom.hasClass(a,"mh5_select")?"incidents on":
"incidents off",v32:"~32"});b._changeIncidents(a,"Incidents")}},trafficSettingsContainer:{control:b,itemClass:new nokia.mh5.Class(d,function(a){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(b,c){a.constructor.call(this,b,c);this.update()},update:function(){c[this.disabled?"addClass":"removeClass"](this.root,"mh5_disabled");var a=document.createDocumentFragment(),b=document.createElement("div");b.className="mh5_image mh5_image"+this.title;a.appendChild(b);b=document.createElement("div");
b.className="mh5_name";b.innerHTML=this.title;a.appendChild(b);b=document.createElement("div");b.className="mh5_status";a.appendChild(b);this.root.appendChild(a)}}}),cssClass:"mh5_List mh5_RowLayout mh5_TrafficSettings",items:nokia.mh5.components.Traffic.getTrafficTypes().map(function(a){return{title:i("UI.SettingsDialog."+a),value:a}}),onClick:function(a){if(!this.items[a].disabled){var b=this.root.children[a],a=this.items[a].value;this.getRootOwnerByClass(f.SettingsDialog)._changeIncidents(b,a)}}},
criticalitySigns:{control:b,cssClass:"mh5_criticalitySigns",itemClass:new nokia.mh5.Class(d,function(a){return{rootHtmlElementName:"li",cssClass:"mh5_CriticalitySign",constructor:function(b,c){a.constructor.call(this,b,c);this.update()},update:function(){this.root.innerHTML='<div class="text">'+i("maps.Traffic."+this.type)+'</div> <div class="img img_'+this.type+'"></div>'}}}),items:[{type:"minor"},{type:"major"},{type:"critical"}]}}},fillup:{control:d,cssClass:"mh5_fillup mh5_standardBackgroundColorDark"}},
build:function(){this.resize=this.resize.bind(this);this.onGlobalTap=this.onGlobalTap.bind(this);o.build.call(this)},resize:function(){var a=this.content,b=a.getContentRoot();c[b.offsetHeight>this.root.offsetHeight?"addClass":"removeClass"](a.root,"mh5_autoHeight");nokia.mh5.win.setTimeout(a._scroll.refresh,1)},_update:function(){this.visible&&(this._updateMapModeSelection(),this._updateUnitSystem(),this._updateTrafficIncidentSelection(),this._updateTrafficOnOffButton(),this.resize())},onGlobalTap:function(a){(!c.contains(this.root,
a.target)||this.content.mapOffset.root===a.target)&&this._closeDialog(a)},visibleDidChange:function(b){var e=this;b?(a.add(nokia.mh5.win,"viewportchange",e.resize,!1),a.add(nokia.mh5.doc.body,c.touchStart,e.onGlobalTap,!0),a.add(nokia.mh5.doc.body,"focus",e.onGlobalTap,!0),setTimeout(function(){e.content.settingsToggle.select("maps")},1),this._update()):(a.remove(nokia.mh5.win,"viewportchange",e.resize,!1),a.remove(nokia.mh5.doc.body,c.touchStart,e.onGlobalTap,!0),a.remove(nokia.mh5.doc.body,"focus",
e.onGlobalTap,!0));o.visibleDidChange.apply(e,arguments)},_updateUnitSystem:function(){this.content.settingsList.maps.unitSystemToggle.select(h.get("unitSystem"))},_updateTrafficIncidentSelection:function(){var a=this.content.settingsList.layers.trafficSettingsContainer;nokia.mh5.each(nokia.mh5.components.Traffic.getTrafficTypes(),function(b){var e=h.get("traffic"+b+"Enabled"),d=a.renderedItems.filter(function(a){return a.value===b})[0].root;c[e?"addClass":"removeClass"](d,"mh5_selected")})},_updateTrafficOnOffButton:function(){var a=
h.get("trafficIncidentsEnabled");c[a?"addClass":"removeClass"](this.content.settingsList.layers.trafficOnOffSwitch.renderedItems[0].root,"mh5_selected")},_updateMapModeSelection:function(){var b=this.content.settingsList.maps.mapModeRadioGroup,c=h.get("mapSchema"),e=/\bcommunity$/.test(c),d=b.items;"normal.day.grey"==c&&(c="normal.day.transit");if(c)for(var f in d){if(d[f].schema===c||e&&d[f].schema===c.slice(0,-10)){j=f;break}}else j=0;a.fire(b,"tap",{index:j,item:d[j],community:e})},_changeIncidents:function(a,
b){var e=c.hasClass(a,"mh5_selected");h.set("traffic"+b+"Enabled",!e);c[e?"removeClass":"addClass"](a,"mh5_selected");e=nokia.mh5.app.controller.current.page.traffic;e.checkInfoBubbleOnIncidentsChange();if(h.get("trafficIncidentsEnabled"))e["Incidents"==b?"showIncidents":"reloadIncidents"]();else e.hideIncidents()}}})})();nokia.mh5.provide("nokia.mh5.components.InfoBubble");
nokia.mh5.components.InfoBubble=function(){function h(a,b){u.font=b;u.textBaseline="bottom";u.fillStyle="rgb(255,255,255)";return u.measureText(a||" ").width}function c(a,b,c){for(var e=h(a,b);c<e;)a=a.substr(0,a.length-2)+"\u2026",e=h(a,b);return{text:a,textWidth:e}}function a(a){return Math.round(16*a/12)}function f(a,b){setTimeout(a.next=function(){return(b=a.shift())?!!b(a)||!0:!1},0);return a}function g(a,b,c){var e=(c||a.params)[b];"string"==typeof e?(c=new Image,c.src=e,c.onload=a.next,a[b]=
c):e.width||e.height?(a[b]=(c||a.params)[b],a.next()):e instanceof Image&&(e.addEventListener("load",function t(){e.removeEventListener("load",t,!1);a.next()},!1),a[b]=e)}function d(a){g(a,"left")}function b(a){g(a,"right")}function e(a){g(a,"image")}function o(a){y.star.src=nokia.mh5.assetsPath+"img/fullstar_icon.png";g(a,"star",y)}function i(a){y.hstar.src=nokia.mh5.assetsPath+"img/halfstar_icon.png";g(a,"hstar",y)}function j(a){y.estar.src=nokia.mh5.assetsPath+"img/emptystar_icon.png";g(a,"estar",
y)}function l(a,b,c){u.save();u.beginPath();u.strokeStyle="#FFFFFF";u.moveTo(a,b);u.lineTo(a,c-b);u.stroke();u.closePath();u.restore()}function m(b){var e=document.createElement("CANVAS"),d=b.params,f=nokia.mh5.extend({},b.data),g=b.left||E,h=b.right||E,i=b.image||E,j=0,o=Number.MAX_VALUE,m=0,A=0,w=0,H=0,z="background"in d?d.background:"rgba(0,15,26,0.85)",F=a(d.borderRadius||2),L=a(1),N=a(14),S=a(12),ja=d.maxWidth||Number.MAX_VALUE,ba,Q=0,Z=300,Y=d.content,fa,ga,ha;C.forEach(function(a){a in d&&
d[a]&&(f["title"==a?"name":a]=d[a])});Array.isArray(Y)&&3<Y.length&&(Y=Y.slice(0,3));u=e.getContext("2d");if(i!=E)w+=i.width+(z?26:0);else{if(g!=E&&(w+=26+g.width,ba||h!=E))w+=1;if(h!=E&&(w+=26+h.width,ba||g!=E))w+=1}if(Y&&i==E){-1!=Y.indexOf("rating")&&f.ratingValue&&(H+=16,Q=70,ba=!0);Z=Math.max(ja-w-26,Q);if(-1!=Y.indexOf("title")&&f.name)H+=N+6,ja=c(f.name,"bold 14pt Arial",Z),fa=ja.text,Q=Math.max(Q,ja.textWidth),ba=!0;if(-1!=Y.indexOf("description")&&f.description)H+=S+6,ja=c(f.description,
"12pt Arial",Z),ga=ja.text,Q=Math.max(Q,ja.textWidth),ba=!0;if(-1!=Y.indexOf("more")&&f.more)H+=S+6,ja=c(f.more,"12pt Arial",Z),ha=ja.text,Q=Math.max(Q,ja.textWidth),ba=!0}ba&&(w+=Q+26);H&&(H-=6);H=Math.max(H,g.height,h.height,i.height)+(z?16:0);e.width=w;e.height=H+(z?16:0);z&&B(e.width,H,L,F,z);if(i!=E)u.drawImage(i,z?m+13:0,z?~~((H-i.height)/2):0);else{g!=E&&(m+=13,u.drawImage(g,m,~~((H-g.height)/2)),m+=g.width+13,(ba||h!=E)&&d.leftDelimiter&&l(m,8,H),j=m);if(ba){m+=13;u.textBaseline="top";u.fillStyle=
"#FFFFFF";A=n(fa,"bold 14pt Arial",m,A,6,N);A=n(ga,"12pt Arial",m,A,6,S);A=n(ha,"12pt Arial",m,A,6,S);if(-1!=Y.indexOf("rating")){r=0;for(A+=6;r<~~f.ratingValue;)p(y.star,r++,m,A);for(r<f.ratingValue&&p(y.hstar,r++,m,A);5>r;)p(y.estar,r++,m,A)}m=m+Q+13}h!=E&&(o=m,ba&&d.rightDelimiter&&l(m,8,H),u.drawImage(h,m+13,~~((H-h.height)/2)))}z&&(u.translate(w/2,H-1),x(z));u=null;nokia.mh5.event.add(e,"down",function(a){var b=d.listeners,c,e=a.offsetX||a.data.offsetX,a=a.offsetY||a.data.offsetY;if(b){if(b.leftclick&&
e<j)c=b.leftclick;else if(b.rightclick&&e>o)c=b.rightclick;else if(b.click)c=b.click;c&&c.call(this,{clickedPoint:{x:e,y:a}})}}.bind(this),!1);e.leftDelimiter=j;e.rightDelimiter=o;b.callback(e)}function n(a,b,c,e,d,f){if(a)d=e+=d,u.font=b,u.fillText(a,c,d),e+=f;return e}function p(a,b,c,e){u.drawImage(a,c+14*b,e)}function x(a){u.beginPath();u.moveTo(6,0);u.lineTo(0,14);u.lineTo(-6,0);u.closePath();u.fillStyle="rgb(255,255,255)";u.fill();u.fillStyle=a;u.fill();u.translate(0,14);u.save();u.scale(1.9,
1);u.beginPath();u.arc(0,0,2.6,0,2*Math.PI,!1);u.fillStyle="rgba(0,0,0,0.35)";u.fill();u.closePath();u.restore()}function B(a,b,c,e,d){var f=c/2,g=e+f,h=a-g,i=b-g;u.fillStyle=d;u.lineWidth=c;u.lineCap="round";u.moveTo(g,f);a=[h,f,h,g,e,A,z,a-f,i,h,i,e,z,w,g,b-f,g,i,e,w,F,f,g,g,g,e,F,A];b=0;for(c=a.length;b<c;)u.lineTo(a[b++],a[b++]),u.arc(a[b++],a[b++],a[b++],a[b++],a[b++]);u.fill()}document.createElement("CANVAS");var C=["title","description","more"],E={height:0,width:0},y={star:new Image,hstar:new Image,
estar:new Image},F=Math.PI,w=F/2,A=3*w,z=0;a(16);var u;return function(a,c,g){this.data=a;this.params=c;this.parent=c.parent;f([function(f){f.params=c;f.data=a;f.callback=g;c.hasOwnProperty("left")&&c.left&&f.unshift(d);c.hasOwnProperty("right")&&c.right&&f.unshift(b);c.hasOwnProperty("image")&&c.image&&f.unshift(e);c.hasOwnProperty("content")&&~c.content.indexOf("rating")&&(f.unshift(o),f.unshift(i),f.unshift(j));f.next()},m.bind(this)])}}();nokia.mh5.provide("nokia.mh5.internals.Map");
nokia.mh5.internals.Map=function(h){function c(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}function a(a,b){var c=nokia.mh5.event,e=c.add,d,f,g,i=h.navigator.msPointerEnabled?"touchstart":"down";e(a,i,function nc(n){c.remove(a,i,nc);d=c.isTouch||h.navigator.msPointerEnabled;b.init(d?"touch":"mouse");d?(f=b.touch,g=b.gesture,h.navigator.msPointerEnabled?(e(a,"touchstart",f.start),e(a,"touchmove",f.move),e(a,"touchend",f.end)):(e(a,"down",f.start),e(a,"move",
f.move),e(a,"up",f.end)),e(a,ub,g.start),e(a,Ua,g.change),e(a,za,g.end),f.start(n)):(f=b.mouse,e(a,"down",f.down),e(a,"move",f.move),e(a,"up",f.up),e(a,Pb,f.wheel),e(a,oc,f.wheel),f.down(n));c=e=d=f=g=null})}function f(a,b,c){function e(a,b,c,h,i,n,q,t,v,j,o,l){var q=q+(t-q)*o,m=H(a+q*v),G=H(b+q*j);m!=i||G!=n?(g.move(m-c,G-h),f=p(e,l,a,b,m,G,i,n,q,t,v,j,o,l)):d(g.end())}function d(){x(f);f=0}var f=0,g={kick:function(a,b,c,h){var c=9*c,i=9*h,h=D(c*c+i*i),c=c/h,i=i/h,n=!0;f&&d();!B(c)&&!B(i)?(g.start(),
e(a,b,a,b,H(a+h*c),H(b+h*i),0,h,c,i,0.2,17)):n=!n;return n},stop:d,start:a||K,move:b||K,end:c||K};return g}function g(d,g,v){var l,m,G,B,D,A;function y(a){Ra&&Qb(a||s[ca])}function z(){1===va&&ha(na,ra)}function ha(a,b){var c=na=a,e=ra=b,c=c+l,e=e+m,d=!!Va,f=d&&Va.length,h=sa.add,i=~~(c/P),n=~~(e/P),q=c%P,t=e%P,e=oa-q,c=pa-t,j,o,i=i-(q=aa(e/P)),n=n-(t=aa(c/P)),e=e-P*q,c=c-P*t;I.clear();for(sa.clear();e<g;){t=c;for(q=n;t<v;){h("".concat(i,"-",q,"-",T,"-",Fa),i,q,e,t);if(d)for(j=0;j<f;)(o=Va[j](i,q,
Aa,T,W,Fa))&&h(o,i,q,e,t,o),++j;t+=P;++q}e+=P;++i}Ga&&Ba.call(rb(),Ta);Ca&&Ba.call(pc(),za);ub&&drawBuildings();Rb()}function ya(a,b,c,e){I.strokeStyle=a||wb;I.lineWidth=b||xb;I.lineCap=c||Sb;I.lineJoin=e||Sb}function ba(a,b){for(var c=a.length,e=2*c,d=new Tb(e),f;c--;)f=ia(a[c],b),d[--e]=f.y,d[--e]=f.x;return d}function wa(a,b){for(var c=a.length,e=new Tb(c),d;c--;)d={},d[da]=a[c],d[ea]=a[c-1],d=ia(d,b),e[c--]=d.y,e[c]=d.x;return e}function db(a,b,c){for(var e="",d,f;c--;)d=0,f=1<<c,0!==(a&f)&&d++,
0!==(b&f)&&(d+=2),e+=d;return e}function Ob(){return null!=na&&(ka=Wa({x:na,y:ra},W))}function Qb(a){if(a){var b=ia(a,W);Ra=!ha(b.x-G,b.y-B);ka={};ka[ea]=a[ea];ka[da]=a[da];o(s,"centerset",ka)}}function Qa(a,b){"shape"in a&&(a=a.shape);for(var c=s.size,e=ta,d=P<<ta,f=[],g=[],h=0,i=0,n=a.length,q,v;h<n;++h)Q(v=a[h])&&(v={latitude:v,longitude:a[++h]}),q=ia(v,d),f[i]=q.x,g[i++]=q.y;h=M.apply(J,f);i=M.apply(J,g);n=t.apply(J,f);q=t.apply(J,g);n=f=n-h;for(q=g=q-i;c.height<q||c.width<n;)q/=2,n/=2,--e;if(b)s[ca]=
Wa({x:f/2+h,y:g/2+i},d),s.zoom=e;return e<=ta&&Ha<=e?e:0}function vb(a){this.width=a;this._int32Vector=[]}function hb(a){for(var b=P<<T,c=ia(a[0],b),b=ia(a[1],b),c=((b.x/P|0)+1-(c.x/P|0))*((b.y/P|0)+1-(c.y/P|0)),a=T,b=c;a++<ta&&(b+=c<<=2)<hb.max;);return--a}function yb(a){var b=!Da;Da="online"==a.type;Y=Z.src=Da?Xa.settings.defaultImage||zb.settings.defaultImage:nokia.mh5.assetsPath+"img/empty_tile_offline.png";b&&(sa.clear(),sa.gc(),y())}function ib(a,b,c,e,d,f,g,h){return(h-b)*(d-a)>(f-b)*(g-a)!=
(h-e)*(d-c)>(f-e)*(g-c)&&(f-b)*(c-a)>(e-b)*(d-a)!=(h-b)*(c-a)>(e-b)*(g-a)}function za(a){var b=a.shape,c=a.style,a=na-oa,e=ra-pa,d=g+a,f=v+e,h=0,i=0,n=b.length,q,t,j;ya(c.color,c.width,c.cap,c.join);for(I.beginPath();h<n;){c=b[h];q=b[h+1];switch(!0){case a<=c&&e<=q&&c<=d&&q<=f:i&&(I.moveTo(b[h-2]-a,b[h-1]-e),i=0);case !i++:h?I.lineTo(c-a,q-e):I.moveTo(c-a,q-e);break;case ib(t=b[h-2],j=b[h-1],c,q,a,e,d,f):case ib(t,j,c,q,d,e,a,f):I.moveTo(t-a,j-e),I.lineTo(c-a,q-e),i=0}h+=2}I.stroke()}function pc(){Ya[T]||
Ba.call(Ca,qc,Ya[T]=[]);return Ya[T]}function jb(a){return a&&ea in a&&da in a&&!a.shape}function qc(a,b){var c=Q(a[0])||jb(a[0])?a:a.shape;Ya[T][b]={style:a==c?0:a,shape:Q(c[0])?wa(c,W):ba(c,W)}}function rc(a){var a=a.shape||a,b=this.x,c=this.y,e=a.length,d=0,f=!1,g,h,i,n,q,t,v;i=a[e-2];for(n=a[e-1];d<e;)g=a[d++],h=a[d++],g>i?(q=i,v=g,t=n,n=h):(q=g,v=i,t=h),g<b==b<=i&&(c-t)*(v-q)<(n-t)*(b-q)&&(f=!f),i=g,n=h;return f}function Ta(a){for(var b=a.shape,a=a.style,c=na-oa,e=ra-pa,d=g+c,f=v+e,h=0,i=b.length,
n,q,t,j;h<i;){n=b[h];q=b[h+1];if(c<=n&&e<=q&&n<=d&&q<=f||ib(t=b[h-2],j=b[h-1],n,q,c,e,d,f)||ib(t,j,n,q,d,e,c,f)){I.beginPath();I.fillStyle=a.color||"rgba(100,100,100,.1)";I.moveTo(b[0]-c,b[1]-e);for(h=2;h<i;)I.lineTo(b[h]-c,b[h+1]-e),h+=2;I.fill();I.fillStyle=Ab;break}h+=2}}function Ua(a,b){return Ia[T][b].shape.length!=(a.shape||a).length}function rb(){if(!Ia[T]||Bb.call(Ga,Ua).length)Ba.call(Ga,sb,Ia[T]=[]);return Ia[T]}function sb(a,b){var c=Q(a[0])||jb(a[0])?a:a.shape;Ia[T][b]={origin:Ga[b],style:a==
c?0:a,shape:Q(c[0])?wa(c,W):ba(c,W)}}function ia(a,b){var c=a[da]/360+0.5,e=M(1,t(0,0.5-q(R(S+N*a[ea]/180))/L/2));return{x:H(c*b),y:H(e*b)}}function Wa(a,b){var c=a.x/b,e=a.y/b,d={};d[ea]=0>=e?90:1<=e?-90:ja*(2*O(V(L*(1-2*e)))-N);d[da]=360*(1===c?1:(c%1+1)%1)-180;return d}var Ja=sc(),Za=d.appendChild(ga()),I=Za.getContext("2d"),xa=c(Za);D=0;A=0;G=0;B=0;l=0;m=0;var s={},Cb=0,Ra=0,va=1,ub=0,Da=C.onLine,Ea=!0,Ka=!0,$a=0,Ca=null,Va=null,Ya=[],wb=Ub,Ab="rgba(0,0,0,1)",xb=9,Sb="round",Db=0,Eb=0,ab="%[1-4]%.maps.nlp.nokia.com",
bb="maptile",Fb="newest",Ga=null,Vb,Ia,na,ra,ka,W,T,Fa,Aa,oa,pa,La,Ma,sa,Xa,zb,kb,Rb,ua,Wb,Sa,$,U,Gb,Na,la,Xb,Hb="?",lb;try{I.mozImageSmoothingEnabled=!1}catch(Pb){}w(s,"box",ka={get:function(){var a=ia(s[ca],W),b;a.x-=oa;a.y-=pa;b=Wa(a,W);a.x+=g;a.y+=v;a=Wa(a,W);return[b,a]},set:function(a){Qa(a,!0)}});w(s,"bbox",ka);w(s,"apiKey",{set:function(a){Hb="?app_id="+a.appId+"&token="+a.appCode},get:function(){return Hb}});w(s,ca,ka={get:function(){return ka||Ob()},set:Qb});w(s,"centre",ka);ka=0;la={resetDefault:function(){la.defaultPrevented=
!1},preventDefault:function(){la.defaultPrevented=!0}};w(s,"geoToPoint",{value:function(a){return ia(a,W)}});w(s,"getZoomLevelFor",{value:Qa});w(s,"layer",{get:function(){return Va},set:function(a){Va=a&&[].concat(a)}});w(s,"move",{value:function(a,b){ha(na+a,ra+b);(a||b)&&(ka=0)}});vb.prototype.set=function(a,b,c){var e,d,f,g;for(e=0;e<c;e++)for(d=0;d<c;d++)f=a+e,g=b+d,f=g*this.width+f,g=f>>5,this._int32Vector[g]|=1<<f-(g<<5)};vb.prototype.get=function(a,b){a=b*this.width+a;b=a>>5;return this._int32Vector[b]&
1<<a-(b<<5)};hb.max=2200;w(s,"maxStorableZoom",{value:function(a){a||(a=s.box);return hb(a)}});w(s,"areaToTiles",{value:function(a){a||(a=s.box);var b=a,c=T,a=hb(a),c=t(c,Ha),a=M(a,ta),e=[],d=[4,3,2,1],f=P<<c,g=ia(b[0],f),h=ia(b[1],f),b=g.x/P|0,g=g.y/P|0,f=(h.x/P|0)+1,h=(h.y/P|0)+1,i=f-b,n=h-g,q,v,j,l,m;for(l=c;l<=a;l++){m=new vb(i,n);for(v=b;v<f;v++)for(j=g;j<h;)if(m.get(v-b,j-g))j++;else{for(c=0;q=d[c];c++)if(0===v%q&&0===j%q&&v-b+q<=i&&j-g+q<=n){e.push({x:v,y:j,z:l,size:q});m.set(v-b,j-g,q);break}j+=
q||1}i<<=1;n<<=1;b<<=1;f<<=1;g<<=1;h<<=1}return e}});w(s,"offset",{get:function(){return{left:xa.x,top:xa.y}},set:function(a){xa={x:~~(ma.call(a,"x")?a.x:a.left)||0,y:~~(ma.call(a,"y")?a.y:a.top)||0}}});w(s,"geometry",{get:function(){return{left:D,top:A}},set:function(a){D=~~(ma.call(a,"x")?a.x:a.left)||0;A=~~(ma.call(a,"y")?a.y:a.top)||0;G=void 0;B=void 0;G=H(D/2);B=H(A/2)}});h.addEventListener("online",yb,!1);h.addEventListener("offline",yb,!1);(function(a){function b(a,c){var e=a.zIndex_,d=c.zIndex_;
return e===d?0:e<d?-1:1}function c(){G.sort(b)}function e(a){return"string"!=typeof a&&a.constructor!=F&&!(a instanceof Image)}function d(a,b){var c=a.info_;if("string"==typeof c.text){var e=i.createElement("canvas"),f=e.getContext("2d"),g=b.width,h=b.height,n=c.text,q;c||(c={});e.width=g;e.height=h;f.drawImage(b,0,0,g,h);f.textBaseline=c.textBaseline||"top";f.fillStyle=c.fillStyle||c.color||"rgb(255,255,255)";f.font=c.font||"bold "+(c.fontHeight||~~(h/3)+"px")+" sans-serif";q=f.measureText(n||"").width;
f.fillText(n,c.x||(g-q)/2,c.y||~~(h/3-3));c=e}else c=b;a.img_=c}function f(){var a=this._,b,c;for(this.onload=null;a.length;)b=a.shift(),b.loaded=1,this===b.img_&&d(b,this),(c=b.onload)&&c.call(b)}function h(){var a=mb.call(O,this);~a&&(O.splice(a,1),ua(this,W),G.push(this),z())}function n(a){var b=a.height/2;if(b=X(a.x-this.x)<a.width/2&&X(a.y-b-this.y)<b)a.clickedPoint.x=this.x-a.x,a.clickedPoint.y=this.y-a.y;return b}function q(a){a.loaded?(ua(a,W),G.push(a),z()):(O.push(a),a.onload=h)}function t(a){var b=
mb.call(O,a);~b?O.splice(b,1):~(b=mb.call(G,a))&&G.splice(b,1)}var j={writable:!0,value:null},o={},G=[],O=[],K=0,B,J,D;Gb=function(b,c){var e=ia(a[ca],W);e.x+=b-oa+l;e.y+=c-pa+m;return Bb.call(G,n,e).concat(U&&X(U.x-e.x)<U.width/2&&X(U.y-e.y)<U.height/2&&U||[]).reverse()};kb=function(a,b,c){var e,d,f=a.scale_,c=a.y-c,g=null!=a.locationX?a.locationX:0.5,h=null!=a.locationY?a.locationY:1;I.drawImage(a.image,a.x-b-(e=a.width/va*f)*g,c-(d=a.height/va*f)*h,e,d)};Rb=function(){for(var a=na-oa+l,b=ra-pa+
m,c=g+a,e=v+b,d=0,f=0,h=G.length,i,n,q,t,j,o=[[],[],[]];d<h;)q=G[d++],f=q.x,t=q.y,a<f&&b<t&&f<c&&t<e&&(q.privileged_?j=q:null!=q.privilegeLevel?o[q.privilegeLevel].push(q):kb(q,a,b));for(d=0;t=o[d];d++)for(f=0;f<t.length;f++)kb(t[f],a,b);if((q=U)&&q.loaded)if(f=q.x,t=q.y,a<f&&b<t&&f<c&&t<e){t-=b;f-=a;if(!Ka&&!Ea&&(h=~~($[Ib]*W/4.007501668E7)))I.fillStyle="rgba(61,137,12,0.2)",I.drawCircle(f,t,h),I.fillStyle=Ab;I.drawImage(q.image,f-(i=q.width/va)/2,t-(n=q.height/va)/2,i,n)}(q=j)&&kb(q,a,b)};ua=function(a){var b=
ia(a,W),c=a.img_;a.x=b.x;a.y=b.y;a.width=c.width;a.height=c.height};Wb=function(){Ba.call(G,ua);U&&ua(U)};Sa=function(a,b){var c=typeof a==Yb||a instanceof Image||e(a)?{image:a}:a,g=c.image;this.zIndex_=0;this.lt_=b[ea];this.ln_=b[da];this.scale_||(this.scale_=1);this.data=b;this.clickedPoint={x:0,y:0};this.info_=c;"string"==typeof g?ma.call(o,g)?((c=this.img_=o[g])._.push(this),c.onload||f.call(c)):(c=this.img_=o[g]=new Image,c.onload=f,c._=[this],c.src=g,this.width=this.height=0):(d(this,g),this.loaded=
1)};B={zIndex_:j,lt_:j,ln_:j,img_:j,info_:j,scale_:j,privileged_:j,clickedPoint:j,x:j,y:j,width:j,height:j,data:j,onload:j,loaded:j,constructor:{value:J=Sa},zIndex:{enumerable:!0,get:function(){return this.zIndex_},set:function(a){this.zIndex_=a;x(K);K=p(c,60)}},toJSON:{value:function(a){var b={};for(a in this)!ma.call(B,a)&&!/_$/.test(a)&&(b[a]=this[a]);b.icon=this.img_.src;b[ea]=this.lt_;b[da]=this.ln_;return b}},image:{enumerable:!0,get:function(){return this.img_},set:function(a){a instanceof
Image||e(a)?(d(this,a),ua(this)):(t(this),typeof a==Yb?this.info_.image=a:this.info_=a,this.loaded=0,J.call(this,this.info_,this),q(this));z()}},isPosition:{enumerable:!0,get:function(){return this==U}},privileged:{enumerable:!0,get:function(){return!!this.privileged_},set:function(a){var b;if(a){for(b=G.length;b--;)G[b].privileged_=!1;b=mb.call(G,this);~b&&(G.push(this),G.splice(b,1))}this.privileged_=!!a;z()}},coordinate:D={get:function(){return this},set:function(a){this.lt_=a[ea];this.ln_=a[da];
ua(this);z()}},coords:D,latitude:{enumerable:!0,get:function(){return this.lt_},set:function(a){this.lt_=a;ua(this);z()}},scale:{get:function(){return this.scale_},set:function(a){this.scale_=a;z()}},longitude:{enumerable:!0,get:function(){return this.ln_},set:function(a){this.ln_=a;ua(this);z()}}};eb?Sa=fa(Zb+"Poi"+$b,B):Jb(Sa.prototype,B);w(a,"addPoi",{value:function(a){Ba.call([].concat(a),q);x(K);K=p(c,60)}});w(a,"createPoi",{value:function(a,b){q(a=new Sa(a,b));return a}});w(a,"removePoi",{value:function(a){null==
a?(O=[],G=[]):Ba.call([].concat(a),t);z()}})})(s);w(s,"pointToGeo",{value:function(a){return Wa(a,W)}});w(s,"position",{get:function(){function a(b){b=b.coords||b.data.coords;$[ea]=b[ea];$[da]=b[da];$[Ib]=b[Ib];$.heading=b.heading;$.speed=b.speed;$.available=!0;if(U)Ka=Ea=!1,U.coords=b,o(s,cb,$);else if($.marker)U=new Sa(nokia.mh5.assetsPath+"img/position.png",b),U.onload=function(){if(U)ua(U),U.loaded=1,z()},U.image.width&&ua(U),h($)}function c(a){d();i(a)}function d(a){$.available=!1;U=null;z();
a&&o(s,nb,$)}var f=nokia.mh5.geolocation,g=function(){e(f,type,data)},h,i;$={marker:!0,deactivate:function(){g(Kb,d);g(nb,d);g(Lb,a);g(cb,a);g(ob,c);f.deactivate();d()},activate:function(e,g){if("disabled"==f.status)return g({type:ob});h=e;i=g;if(U)return h($);b(f,Kb,d);b(f,nb,d);b(f,Lb,a);b(f,cb,a);b(f,ob,c);f.available?a({data:f}):f.activate()},toJSON:function(){var a={};a[ea]=$[ea];a[da]=$[da];return a},available:!1};return function(){return $}}()});w(s,"route",{get:function(){return Ca&&1==Ca.length?
Ca[0]:Ca},set:function(a){a?(Ya=[],Ca=!ac(a)||Q(a[0])||jb(a[0])?[a]:a):Ca=null;z()}});w(s,"shape",{get:function(){return Vb},set:function(a){a?(Ia=[],Vb=a,Ga=!ac(a)||Q(a[0])||jb(a[0])?[a]:a):Ga=null;z()}});w(s,"scale",{get:function(){return va},set:function(a){1===va&&1!==a&&(o(s,bc,{}),Ea=!0);I.clearRect(0,0,g,v);va=a;I.save();I.setTransform(a,0,0,a,-a*(La-l)+(La-l),-a*(Ma-m)+(Ma-m));ha(na,ra);I.restore()}});w(s,Oa,{get:function(){return Db?cc+".traffic":Fa},set:function(a){Db=Eb=0;(Db=/\btraffic\b/.test(a))?
(Fa=cc+".grey",bb="traffictile",ab="maps.nlp.nokia.com",Fb="newest"):(Eb=/\bcommunity$/.test(a))?(Fa=a,ab="%[1-4]%.communitymaptiles.nokia.com/tilehub/live/",bb=~a.indexOf("hybrid")?"sat":"map"):(Fa=a,bb="maptile",ab="%[1-4]%.maps.nlp.nokia.com",Fb="newest");sa.clear();sa.gc();y()}});w(s,"size",{get:function(){return{width:g,height:v}},set:function(a){var b=Ra&&s[ca];ma.call(a,"width")?(g=a.width,v=a.height):(g=a[0],v=a[1]);oa=La=~~(g/2);pa=Ma=~~(v/2);Za.width=g;Za.height=v;I.font="7pt sans-serif";
I.textBaseline="top";I.fillStyle=Ab;ya();y(b)}});Jb(s,{restore:{value:function(){var a=Ja.get(ca),b=Ja.get(Pa),c=Ja.get(Oa);Ja.get(tc);null!=b&&(s[Pa]=b);null!=c&&(s[Oa]=c);a&&(s[ca]=a);return!!a}},save:{value:function(){var a=s[Oa],b=s[Pa],c=Ra&&s[ca];a&&Ja.set(Oa,a);b&&Ja.set(Pa,b);c&&(c={},c[ea]=s[ca][ea],c[da]=s[ca][da],Ja.set(ca,c))}}});w(s,"tileServer",{get:function(){return Xa},set:function(a){var b;Xa=a||zb;Da?(b=Xa.settings.defaultImage)&&(Y=Z.src=b):yb({});sa.clear();sa.gc();y()}});w(s,
"tileLang",{get:function(){return lb},set:function(a){lb=a}});zb={settings:{defaultImage:nokia.mh5.assetsPath+"img/empty_tile.png"},create:function(a,b,c){var e=new Image;e.src=Eb?"http://".concat(ab.replace(/\%\[1\-4\]\%/,1+c%4),bb,"/png/",db(b,c,a)):"http://".concat(ab.replace(/\%\[1\-4\]\%/,1+c%4),"/maptile/2.1/",bb,"/",Fb,"/",Fa,"/",a,"/",b,"/",c,"/",P,"/png8",Hb,"&",lb?"lg="+lb:"");return e}};(function(){function a(){1===s.scale&&(h=!0,s.moveTo(d))}function c(){h||(s.tracking=!1);h=!1}var d=
s.position,f=!1,g,h;w(s,"tracking",{get:function(){return f},set:function(i){i=!!i;i!=f&&(g=(f=i)?b:e,la.resetDefault(),f?(o(s,dc,la),la.defaultPrevented||(d.available&&a(),h=!1)):o(s,ec,la),g(s,cb,a),g(s,Mb,c),g(s,Nb,c))}})})();(function(){function a(){Da&&(this._layer&&(e[this._id]=1),delete d[this._id])}function b(){this.loaded=1;if((Ea||Ka)&&!--h)Ea=Ka=!1;g||(g=n(z,500))}function c(a){if(!(a in this))d[a].onload=null,d[a].src=Y,delete d[a]}var e={},d={},f={},g=0,h=0;n(function(){Da&&(Na||sa.gc())},
/iP(?:ad|od|hone)/.test(E)?1E4:uc);sa={gc:function(){Ba.call(fc(d),c,f)},add:function(c,g,i,n,q,t){var v=d[c];f[c]=1;if(!v&&(s.tracking||!Na)){if(t){if(!(c in e))v=d[c]=new Image,v.src=t,v._layer=!0}else v=d[c]=Xa.create(T,(g%Aa+Aa)%Aa,(i%Aa+Aa)%Aa);if(v)v.onload=b,v.onerror=a,v._id=c}else v&&v.loaded?v.complete&&I.drawImage(v,n,q):((!Da||!Ea&&!Ka)&&t!=c&&Z.complete&&I.drawImage(Z,n,q),++h)},clear:function(){h=0;f={}}}})();w(s,"toJSON",{value:function(a){a={_:a};a[ca]=s[ca];a[Pa]=s[Pa];a[Oa]=s[Oa];
return a}});Xb=function(a){a=t(M(a,ta),Ha);if(T!=a){var b=Ra&&s[ca];Ra&&(s.scale=qa(2,a-T));Ea=!1;Ka=!0;16<a?(wb=vc,xb=8):(wb=Ub,xb=5);W=P<<a;Aa=1<<a;o(s,gc,{oldValue:T,newValue:a});T=a;ya();Da&&sa.gc();Wb();s.route=s.route;va=1;y(b)}else va=1};w(s,Pa,{get:function(){return T},set:function(a){Xb(a)}});Jb(s,{MAX_ZOOM_LEVEL:{get:function(){return ta},set:function(a){ta=null==a?wc:a}},MIN_ZOOM_LEVEL:{get:function(){return Ha},set:function(a){Ha=null==a?xc:a}}});var P=256;(function(){function a(c){b(s,
c,this)}function c(a){e(s,a,this)}function d(a,b){[hc,ic,Mb,jc,kc,gc,bc,Nb,lc,dc,ec,cb,nb,ob,Lb,Kb].forEach(a,b)}var f=[],g=[],h;w(s,"addNotifications",{value:function(b){h=f.indexOf(b);0>h&&(h=f.push(b)-1,d(a,g[h]={handleEvent:function(a){o(b,a.type,a.data)}}))}});w(s,"dropNotifications",{value:function(a){h=f.indexOf(a);-1<h&&(d(c,g[h]),f.splice(h,1),g.splice(h,1))}})})();a(Za,function(){function a(b,c){var e=s.geoToPoint(s.center),d=s.size;return s.pointToGeo({x:e.x-d.width/2+b,y:e.y-d.height/
2+c})}function b(c,e){d();o(s,kc,a(c,e))}function c(){$a&&(x($a),La=oa,Ma=pa,$a=0,++s.zoom)}function e(a,b){if(2===t(s.scale+0.1,2))s.scale+=0.1,$a=p(e,30,a,b);else{s.scale=2;var d=I.drawImage,f=I.clearRect,g=I.drawCircle,h=I.lineTo;I.drawImage=I.clearRect=I.drawCircle=I.lineTo=K;c();s.move(a,b);I.drawImage=d;I.clearRect=f;I.drawCircle=g;I.lineTo=h}}function d(){x(z);z=0}function g(a,b){d();b.length&&o(s,yc,b);if(a.length){if(!a[0].privileged_)a:{for(var c=0,e=a.length,f;e--;){f=a[e];if(f.privileged_){a.splice(e,
1);a.unshift(f);f.privileged=1;break a}if("privilegeLevel"in f&&(!("privilegeLevel"in a[c])||f.privilegeLevel>a[c].privilegeLevel))c=e}0<c&&a.unshift(a.splice(c,1)[0])}o(s,hc,a)}}function h(a){if(!Y&&(A(a),!Na&&!(pb<X(H-ga)||pb<X(N-fa)))){qb(a);var c=(aa||a.pageX)-xa.x,a=(fb||a.pageY)-xa.y,f=Gb(c,a),i;i=c;var n=a;if(Ga){var q=ia(s[ca],W);q.x+=i-oa+l;q.y+=n-pa+m;i=Bb.call(Ia[T],rc,q).reverse()}else i=[];f.length||i.length?(d(),z=p(g,Q,f,i)):z?(d(),la.resetDefault(),o(s,Nb,la),!la.defaultPrevented&&
s.zoom<ta&&(c-=oa-l,a-=pa-m,La+=c,Ma+=a,$a=p(e,Q,c,a))):(La=oa,Ma=pa,z=p(b,Q,c,a))}}function i(a){E?(gb=new u,qb(a),a=(a.touches||[a])[0],ga=a.screenX,fa=a.screenY,L?s.move(tb=F-ga,ya=R-fa):L=(pb<X(H-ga)||pb<X(N-fa))&&q(),F=ga,R=fa):(a=(a.touches||[a])[0],F=a.screenX,R=a.screenY)}function n(){v(ka=0);o(s,jc,{})}function q(){C();Ka=Ea=!1;la.resetDefault();o(s,Mb,la);return!la.defaultPrevented}function v(a){H=ga=F=tb=N=fa=R=ya=0;return a}function O(){return 100>new u-gb&&v(y.kick(F,R,tb,ya))}function J(){Na=
0}function D(){Cb=0;E=1}function C(){x(Z);Z=0}function V(){C();Y=1;o(s,lc,a(aa-xa.x,fb-xa.y))}function M(){1!==S&&(s.scale=S);qa=p(M,20)}var Q=250,A=eb?function(a){a.pageX=a.clientX+j.scrollLeft;a.pageY=a.clientY+j.scrollTop}:K,y=f(function(){Na=1},function(a,b){s.move(a,b)},function(){Na=0;ha(na,ra);n()}),z=0,Z=0,E=1,L=1,Y=0,qa=0,H,N,F,R,ga,fa,aa,fb,tb,ya,gb,S;w(s,"moveTo",{value:function(a){var a=ia(a,W),b=a.x-na-G,a=a.y-ra-B;q()&&y.kick(b+oa,a+pa,b/9,a/9)}});return{init:function(a){"mouse"==a&&
(E=0)},mouse:{down:function(a){A(a);Z=p(V,800);c();y.stop();qb(a);gb=Y=0;H=F=ga=a.screenX;N=R=fa=a.screenY;aa=a.pageX;fb=a.pageY;E=1;L=0},move:function(a){A(a);E&&(L||(L=q()));i(a);E||(a=Gb(a.pageX-xa.x,a.pageY-xa.y),a.length&&o(s,ic,a))},up:function(a){C();F!=H||R!=N?O()||n():E&&p(J,50)&&h(a);E=0},wheel:function(a){var b=0>(a.detail||a.wheelDelta)?1:-1;ma.call(a,"wheelDelta")||mc&&(b*=-1);s.zoom-=b}},touch:{start:function(a){var b=a.touches,e=b.length;qb(a);if(!(1<e)&&(Z=p(V,800),c(),gb=Y=0,E))y.stop(),
L=0,E=2>e,a=b[0],H=F=ga=a.screenX,N=R=fa=a.screenY,aa=a.pageX,fb=a.pageY},move:function(a){i(a)},end:function(a){var b=a.touches;Z&&C();E?L?O()||n():(Na=0,h(a)):(E=!Cb&&2>b.length)&&ha(na,ra)}},gesture:{start:function(){C();y.stop(J());Cb=1;Ob(E=L=0);M(S=1)},change:function(a){S=a.scale},end:function(){clearInterval(qa);s.zoom+=0.9>S?-(0.1>S?3:0.5>S?2:1):1.1<S?3<S?3:2<S?2:1:0;p(D,33)}},click:h}}(s));eb&&(s=fa(Zb+$b++,s)());s.tileServer=null;s.size=[g||d.offsetWidth,v||d.offsetHeight];s.zoom=12;s.schema=
"normal.day";return s}var d=nokia.mh5.event,b=d.add,e=d.remove,o=d.fire,i=h.document,j=i.documentElement,l=h.escape,m=h.unescape,n=h.setInterval,p=h.setTimeout,x=h.clearTimeout,B=h.isNaN,C=h.navigator,E=C.userAgent,y=h.Array,F=h.Object,w=F.defineProperty,A={}.__defineGetter__,z={}.__defineSetter__,u=h.Date,v=h.Function,K=v(),G=h.JSON,J=h.Math,M=J.min,t=J.max,q=J.log,O=J.atan,V=J.exp,D=J.sqrt,qa=J.pow,R=J.tan,H=J.round,aa=J.ceil,X=J.abs,L=J.PI,N=L/2,S=L/4,ja=180/L,ba=2*L,Q=function(a){return typeof a==
ya},Z=new Image,Y,fa,ga,ha=!!i.createElement("canvas").getContext,wa=!!w,db=!!A&&!!z,mc=!+"\u000b1",eb;if(wa)try{if(!w({},"_",{value:1})._)throw wa;}catch(Ob){wa=!wa}eb=!(wa||db);var Zb="Gaia_",ya="number",Yb="string";(new u).getFullYear();var Qa=ha?"addEventListener":"attachEvent",ea="latitude",da="longitude",ta=20,Ha=3,wc=ta,xc=Ha,hc="poiclick",ic="poiover",yc="shapeclick",tc="position-available",Mb="mapmovestart",jc="mapmoveend",kc="mapclick",gc="mapzoomchange",bc="mapscalechange",Nb="mapdblclick",
lc="maplongpress",dc="maptrackingstart",ec="maptrackingend",ca="center",Pa="zoom",Oa="schema",Ib="accuracy",cb="positionchange",nb="positionlost",ob="positionerror",Lb="positionactivate",Kb="positiondeactivate",vc="rgba(102,17,68,0.55)",Ub="rgba(102,17,68,0.69)",Pb=(ha?"":"on")+"mousewheel",oc="DOMMouseScroll",ub="gesturestart",Ua="gesturechange",za="gestureend",uc=6E4,pb=9,cc="normal.day";wa||(w=db?function(a,b,c){ma.call(c,"value")?a[b]=c.value:(ma.call(c,"get")&&A.call(a,b,c.get),ma.call(c,"set")&&
z.call(a,b,c.set));return a}:function(a,b,c){a[b]=c;return a});var Jb=F.defineProperties||function(a,b){for(var c=fc(b),e=c.length,d;e--;)ma.call(b,d=c[e])&&w(a,d,b[d])},fc=F.keys||function(a){var b=[],c=0,e;for(e in a)ma.call(a,e)&&(b[c++]=e);return b},rb=F.prototype,ma=rb.hasOwnProperty,sb=rb.toString,zc=sb.call([]),ac=y.isArray||function(a){return sb.call(a)==zc},Ta=y.prototype,Bb=Ta.filter||function(a,b){for(var c=[],e=0;e<this.length;++e)a.call(b,this[e],e,this)&&c.push(this[e]);return c},Ba=
Ta.forEach||function(a,b){for(var c=0;c<this.length;++c)a.call(b,this[c],c,this)},mb=Ta.indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);return b},Ac=Ta.slice,Tb=h.Int32Array||y;p(function(a){if(!a){var b=p,c=n,e=function(a,b,c,e){e=Ac.call(e,2);return a(function(){b.apply(this,e)},c)};p=function(a,c){return e(b,a,c,arguments)};n=function(a,b){return e(c,a,b,arguments)}}},0,1);var qb=ha?function(a){a.preventDefault()}:function(a){(a||h.event).returnValue=!1};"on"+za in i||Qa in i&&function(){function a(c,
e,f){l=i.createEvent("Event");l.initEvent(f,d,d);l.scale=f==Ua?j=b(e)/v:f==za?j:1;(c.target||i).dispatchEvent(l)}function b(a){t=a[0];o=t[c];G=t[e];t=a[a.length-1];m=t[c];p=t[e];return D(qa(p-G,2)+qa(m-o,2))}if(!i["_on"+za]){var c="screenX",e="screenY",d=!0,f=!1,g=!1,n,q,t,v,j,l,o,m,G,p;h.navigator.msPointerEnabled&&function(a){function b(a,c,e){q=i.createEvent("Event");q.initEvent(e,d,d);q.touches=c;q.isTouch=!0;(a.target||i).dispatchEvent(q)}function c(a,d){g=a.pointerId;h=e[g];if(void 0!==h){f.splice(h,
1);delete e[g];for(var i in e)e.hasOwnProperty(i)&&e[i]>h&&e[i]--;d&&b(a,f,"touchend")}}var e={},f=[],g,h,q;nokia.mh5.event.add(a,"MSPointerDown",function(a){g=a.pointerId;if(void 0===e[g])e[g]=f.length,f[f.length]=a,b(a,f,"touchstart")});nokia.mh5.event.add(a,"MSPointerMove",function(a){g=a.pointerId;void 0!==e[g]&&(f[e[g]]=a,b(a,f,"touchmove"))});nokia.mh5.event.add(a,"MSPointerUp",function(a){c(a,!0)});nokia.mh5.event.add(a,"MSPointerCancel",function(a){c(a,!1)})}(i);i[Qa]("touchstart",function(c){n=
f;q=c.touches||[];f=1<q.length;f!=n&&(g=d,v=b(q),a(c,q,"gesturestart"))},d);i[Qa]("touchmove",function(b){f&&!g&&a(b,b.touches||[],Ua);g=!1},d);i[Qa]("touchend",function(b){q=b.touches||[];f&&2>q.length&&(f=!1,a(b,q,za))},d);i["_on"+za]=d}}();var sc=function(){var a=G.stringify,b=G.parse,c=h.localStorage,e=0;return function(){var d={get:function(a){var c=""+i.cookie,e=c.indexOf((a=l(f+a))+"=");return~e?b(m(c.slice(e+a.length+1).split(";")[0])):null},set:function(b,c){var e=new u;e.setFullYear(e.getFullYear()+
1);i.cookie="".concat(l(f+b),"=",l(a(c)),";","expires=",e.toGMTString())}},f=++e+"html5-map-";return{get:c?function(a){var e=c.getItem(f+a);try{return null===e?d.get(a):b(e)}catch(g){return null}}:d.get,set:c?function(b,e){try{c.setItem(f+b,a(e))}catch(g){d.set(b,e)}}:d.set}}}();ha&&(ga=function(){function a(b,c,e){this.beginPath();this.arc(b,c,e,0,ba);this.fill()}return function(){var b=i.createElement("canvas"),c=b.getContext("2d");c.clear=K;c.drawCircle=a;return b}}());var $b=0;g.MAX_ZOOM_LEVEL=
ta;g.MIN_ZOOM_LEVEL=Ha;return g}(this);nokia.mh5.provide("nokia.mh5.internals.CartoPOI");
nokia.mh5.internals.CartoPOI=nokia.mh5.Class(function(){function h(){if(this._timeout)clearTimeout(this._timeout),this._timeout=0}function c(a){var b;a.placeId=a.id;delete a.id;if(a.placeId&&!(a.placeId in this._cache)&&(a={categoryGroup:l(a.category),placeId:a.placeId,cartopoi:!0,latitude:a.lat,longitude:a.lon,name:a.location_name,categories:[{id:a.category,cartopoi:!0}],properties:{cartopoi:!0,placeId:a.placeId,priority:a.priority,title:a.location_name,geoLatitude:a.lat,geoLongitude:a.lon}},this._cache[a.placeId]=
1,b=l(a.categories[0].id)))a=this._map.createPoi(nokia.mh5.assetsPath+"img/mapsymbols/carto_POI_"+b+".png",a),a.zIndex=-1,this._draw.push(a)}function a(){this.parentNode&&this.parentNode.removeChild(this)}function f(){this._map.removePoi(this._drawn);this._poi={};this._cache={};this._drawn=[]}function g(a,b){a._zoomtimeout=0;if(b!==a._zoom)a._clearTimeout(),a._zoom=b,f.call(a),14<b&&(a._timeout=setTimeout(a._boundmove,1E3))}function d(){for(var a=this._wrapper,b=this._wrapper.infoBubbles,c,e=0,d=
b.length;e<d;e++)c=b[e],c.poi.data.cartopoi&&a.hideInfoBubble(c)}function b(a,b,c,e){14<e&&(this._poi[(e-3>>0)+"/"+(a/8>>0)+"/"+(b/8>>0)]=1)}function e(a){clearTimeout(this._zoomtimeout);this._zoomtimeout=setTimeout(g,1,this,a.data.newValue)}function o(){var b=nokia.mh5.doc,e=this,d=e._poi,f=[],g=[],h=0,i,l,o;if(j.onLine)for(l in d)++h,i=b.body.appendChild(b.createElement("script")),i.src="http://b.heatmaps.maps.svc.ovi.com/heatmaps/v2/mapsymbols.default/"+l+"/1024/jsonp",i.onload=i.onerror=a;if(h)o=
function(){if(!--h){for(l in d)f=f.concat(d[l]);f.forEach(c,{_cache:e._cache,_map:e._map,_draw:g});e._drawn=e._drawn.concat(g)}},mapsymbols.callback=function(a,b){d[a]=b;o()};this._poi={};this._clearTimeout()}if(!("mapsymbols"in window))window.mapsymbols={};var i=nokia.mh5.event,j=nokia.mh5.win.navigator,l=nokia.mh5.utils.place.categoryIdentifier;return{constructor:function(a,c){this._active=!1;this._bound=b.bind(this);this._boundmove=o.bind(this);this._boundzoom=e.bind(this);this._boundHideInfoBubble=
d.bind(this);this._boundCleanPois=f.bind(this);this._clearTimeout=h.bind(this);this._poi={};this._cache={};this._drawn=[];this._map=c;this._wrapper=a;this._zoomtimeout=this._timeout=this._zoom=0},activate:function(){if(!this._active){var a=this._map,b=[].concat(a.layer||[]);b.push(this._bound);a.layer=b;i.add(a,"mapscalechange",this._boundHideInfoBubble);i.add(a,"mapscalechange",this._boundCleanPois);i.add(a,"mapzoomchange",this._boundzoom);i.add(a,"mapmoveend",this._boundmove);i.add(a,"mapmovestart",
this._clearTimeout);this._boundzoom({data:{newValue:a.zoom}});this._active=!0}},deactivate:function(){if(this._active){var a=this._map,b=[].concat(a.layer);b.splice(b.indexOf(this._bound),1);a.removePoi(this._drawn);a.layer=b;i.remove(a,"mapscalechange",this._boundHideInfoBubble);i.remove(a,"mapscalechange",this._boundCleanPois);i.remove(a,"mapzoomchange",this._boundzoom);i.remove(a,"mapmoveend",this._boundmove);i.remove(a,"mapmovestart",this._clearTimeout);g(this,0);this._active=!1}}}});nokia.mh5.provide("nokia.mh5.internals.SQLTileServer");
nokia.mh5.internals.SQLTileServer=nokia.mh5.Class(function(){function h(a,b,d,f){function h(){V=p.started=!1}function q(a){J.type=a;(p[x]||g).call(p,J)}function n(a,b){if(V)h(),J.message=(b||a).message,q("error"),t(),nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download failed",ev:"event33"})}function t(){V=null;p.started=!1;q("loadend")}function v(){p.started=!0;if(!V&&p.dbCreated){V=!V;for(var b=0;b<m&&a.length;b++)o(a.pop())}}function j(a){C=0;c(function(){p.dbCreated=!0;V&&(h(),q("abort"),
t(),nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download canceled by user",ev:"event34"}));a&&a()})}function l(){q("load");t();nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download completed",ev:"event35"})}function o(c){function g(f){i(j,K,function(g){function i(){x-=1;if(!x){p.downloaded+=m;if(V)p.current+=h*h,p.estimated=p.downloaded/p.current*p.total,q("progress"),C+=1,C==D&&e(aa,G,{p1x:b[0].latitude,p1y:b[0].longitude,p2x:b[1].latitude,p2y:b[1].longitude,minZoom:O,maxZoom:B,
schema:d},l,n);V&&a.length&&o(a.pop())}}v=c.z;f.forEach(function(a,b){B=Math.max(v,B);O=Math.min(v,O||B);var d={z:v,x:c.x+b%h,y:c.y+Math.floor(b/h),base64:a};if("idb"===N)d.id=[d.x,d.y,d.z].join(";");e(j,K,d,i,n,g);x+=1})})}var h=c.size,t,v,j=H?L:X,m=0,x=0;nokia.mh5.jsonp("http://maps.nlp.nokia.com/maptile/2.1/maptile/newest/normal.day/"+c.z+"/"+c.x+"/"+c.y+"/256/png8"+f+"&output=base64&range="+h+"x"+h+"&callback_func",function(b){if(b.error)return a.push(c),n(null,{message:b.error});if(V){for(t=
b.length;t--;m+=b[t].length);g(b)}else a.push(c)})}var p=this,m=3,O=0,B=0,J={data:p},D=a.length,C=0,V;p.total=a.reduce(function(a,b){return a+b.size*b.size},0);p.current=0;p.downloaded=0;p.dbCreated=p.started=!1;p.stop=j;p.start=function(){null==V?j(v):v();nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download started",v32:"~c32",ev:"event32",c33:"lat0:"+b[0].latitude+",lon0:"+b[0].longitude+",lat1:"+b[1].latitude+",lon1:"+b[1].longitude,v33:"~c33"})};p.pause=h;p.resume=v;p[x]=null}function c(b){b=
b||g;a(function(){f(b)})}function a(a){a=a||g;i(aa,G,function(b){if("sql"===N)p(b,C+G,[],function(){d(a)},g);else{var c=b.objectStore(G);c.openCursor().onsuccess=function(b){(b=b.target.result)?(c["delete"](b.key),b["continue"]()):a()}}})}function f(a){a=a||g;i(X,K,function(b){if("sql"===N)p(b,C+K,[],function(){l(a)},g);else{var c=b.objectStore(K);c.openCursor().onsuccess=function(b){(b=b.target.result)?(c["delete"](b.key),b["continue"]()):a()}}})}function g(){}function d(a){a=a||g;"sql"===N?i(aa,
G,function(b){p(b,B+G+" ("+E+" "+v+", "+y+" "+v+", "+F+" "+v+", "+w+" "+v+", "+A+" "+v+", "+z+" "+v+", schema TEXT NOT NULL)",[],a,g)}):(L.createObjectStore(G,{autoIncrement:!0}),a())}function b(a){!X&&!H&&j(q,O,V,D,function(b){X=b;l(a)})}function e(a,b,c,e,d,f){if("sql"===N){var g=function(a){for(var f=Object.keys(c),g=[],h=[],i=0,q=f.length;i<q;i++)g.push("?"),h.push(c[f[i]]);p(a,"INSERT INTO "+b+" VALUES ("+g.join(",")+")",h,e,d)};f?g(f):i(a,b,g)}else a=(f||a.transaction([b],"readwrite",0)).objectStore(b).put(c),
a.onsuccess=e,a.onerror=d}function o(a,b,c,e){if("sql"===N)a[M](function(a){p(a,"SELECT * FROM "+b,[],function(a,b){e(b)})});else{var b=a.transaction([b]).objectStore(b),d=[];if(!c)b.openCursor().onsuccess=function(a){(a=a.target.result)?(d.push(a.value),a["continue"]()):e(d)}}}function i(a,b,c){if("sql"===N)a[J](c);else c(a[J]([b],"readwrite",0))}function j(a,b,c,e,d,f){"sql"===N?(f=window.openDatabase(a,b,c,e),d(f)):(a=S.open(a),a.onsuccess=function(a){d(a.target.result)},a.onerror=f)}function l(a){a=
a||g;"sql"===N?i(X,K,function(b){p(b,B+K+" (z "+u+", x "+u+", y "+u+", base64 TEXT)",[],a,g)}):(L.createObjectStore(K,{keyPath:"id"}),a())}function m(a){if(!R)throw"Web SQL not available";this.settings=a||{}}var n=function(a,b){n=a.item?function(a,b){return a.item(b)}:function(a,b){return a[b]};return n(a,b)},p=function(a,b,c,e,d){a.executeSql(b,c,e,d)},x="onprogress",B="CREATE TABLE IF NOT EXISTS ",C="DROP TABLE ",E="tl_latitude",y="tl_longitude",F="br_latitude",w="br_longitude",A="MIN_ZOOM_LEVEL",
z="MAX_ZOOM_LEVEL",u="INTEGER NOT NULL",v="TEXT NOT NULL",K="offline_tiles",G=K+"_bbox",J="transaction",M="readTransaction",t=window.openDatabase,q="m_nokia_maps",O="1.0",V="",D=47185920,qa=52428800,R=!0,H=!nokia.mh5.platform.ios,aa,X,L,N,S=window.indexedDB||window.mozIndexedDB;t?N="sql":S?N="idb":(N="none",R=!1);if("2.2"!=nokia.mh5.platform.android.version)if("undefined"!=typeof PGSQLitePlugin)p=function(a,b,c,e,d){a.executeSql(c&&c.length?[b].concat(c):b,e,d)},H=!0,M=J,document.addEventListener("deviceready",
function(){L=new PGSQLitePlugin(q+".sqlite3",function(){i(L,G,d);i(L,K,l)})},!1);else if(H)if(L=null,"sql"===N)for(;!L&&5242880<qa;){try{L=aa=X=t(q,O,V,qa),L[J](d),L[J](l)}catch(ja){}qa-=5242880}else{if("idb"===N)t=S.open(q,1),t.onsuccess=function(a){L=aa=X=a.target.result;R=!0},t.onerror=function(){R=!1},t.onupgradeneeded=function(a){L=aa=X=a.target.result;R=!0;d();l()}}else try{j(q+"_flag",O,V,1024,function(a){aa=a;i(a,G,d)})}catch(ba){R=!1}else R=!1;m.AVAILABLE=nokia.mh5.platform.offlineStorageSupported=
R;h.prototype.onprogress=null;return{constructor:m,create:function(a,b,c){var e=this.settings,d=e.apiKey||"",f=new Image;if("sql"===N)X[M](function(g){p(g,"SELECT base64 FROM "+K+" WHERE z = ? AND x = ? AND y = ?",[a,b,c],function(g,h){var i=(h||g).rows;if(i.length)f.src="data:image/png;base64,"+n(i,0).base64;else if(!e.offlineOnly)f.src="http://".concat(1+c%4,".maps.nlp.nokia.com","/maptile/2.1/","maptile","/newest/","normal.day","/",a,"/",b,"/",c,"/",256,"/png8",d)})});else{var g=X.transaction([K]).objectStore(K).get([b,
c,a].join(";"));g.onsuccess=function(){var h=g.result;if(h)f.src="data:image/png;base64,"+h.base64;else if(!e.offlineOnly)f.src="http://".concat(1+c%4,".maps.nlp.nokia.com","/maptile/2.1/","maptile","/newest/","normal.day","/",a,"/",b,"/",c,"/",256,"/png8",d)}}return f},getBoundingBox:function Z(a){var c=H?L:aa;c?o(c,G,null,function(c){"sql"===N?(c=c.rows,c.length?(b(),c=n(c,0),a([{latitude:1*c[E],longitude:1*c[y]},{latitude:1*c[F],longitude:1*c[w]}],1*c.MIN_ZOOM_LEVEL,1*c.MAX_ZOOM_LEVEL,c.schema)):
a(null)):c[0]&&(c=c[0],a([{latitude:c.p1x,longitude:c.p1y},{latitude:c.p2x,longitude:c.p2y}],c.maxZoom,c.minZoom,c.schema))}):setTimeout(Z,100,a)},storeBoundingBox:function(a,c){if(!c)c=a.bbox;var e=new h(a.areaToTiles(c),c,a.schema,this.settings.apiKey||"");b(e);return e},removeBoundingBox:function(){c()}}});nokia.mh5.provide("nokia.mh5.components.Map");
nokia.mh5.components.Map=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){var c=nokia.mh5.i18n,a=nokia.mh5.event,f=nokia.mh5.platform,g=nokia.mh5.ui.Button,d=nokia.mh5.ui.Control,b=nokia.mh5.internals,e=3,o=function(){return"ongestureend"in nokia.mh5.doc||f.android_webview||f.ie||f.n9},i=nokia.mh5.win.setTimeout,j=nokia.mh5.win.clearTimeout,l=nokia.mh5.win.clearInterval,m=nokia.mh5.win.setInterval;return{children:["zoomButtons","positionButton","settingsButton","mapLogo"],cssClass:"mh5_Map mh5_hwacc_viewer",
statics:{MAX_ZOOM_LEVEL:b.Map.MAX_ZOOM_LEVEL,MIN_ZOOM_LEVEL:b.Map.MIN_ZOOM_LEVEL},passive:!1,zoomButtons:{control:nokia.mh5.ui.Container,children:["zoomin","zoomout"],visible:!o(),cssClass:"mh5_zoom",layout:new nokia.mh5.ui.RowLayout,zoomin:{control:g,cssClass:"mh5_Button mh5_zoomIn",onClick:function(){var a=this.parent.intervalId,b=this.parent.parent._map;"number"===typeof a&&l(a);if(b.zoom<b.MAX_ZOOM_LEVEL)a=this.parent.intervalId=m(function(){1.9>b.scale?b.scale+=0.09:(l(a),a=void 0,b.zoom++)}.bind(this),
33)}},zoomout:{control:g,cssClass:"mh5_Button mh5_zoomOut",onClick:function(){var a=this.parent.intervalId,b=this.parent.parent._map;"number"===typeof a&&l(a);if(b.zoom>b.MIN_ZOOM_LEVEL)a=this.parent.intervalId=m(function(){0.5<b.scale?b.scale-=0.05:(l(a),a=void 0,b.zoom--)}.bind(this),33)}}},positionButton:{control:g,cssClass:"mh5_Button position missing",onClick:function(){var a=this.parent._map;"available"===this.parent.positionStatus?a.tracking=!a.tracking:this.parent.initPositioning("buttonClicked")}},
settingsButton:{control:g,cssClass:"mh5_Button settings",onClick:function(){var a=this.parent;new nokia.mh5.ui.SettingsDialog({traffic:a.traffic,visibleDidChange:function(b){a.passive=b;this.constructor.prototype.visibleDidChange.apply(this,arguments)}})}},mapLogo:{control:d,cssClass:"mh5_mapLogo",innerHTML:'<div class="logo"></div><a>'+c("mapTermsOfUse")+"</a>",onClick:function(){nokia.mh5.maps&&nokia.mh5.maps.Application?nokia.mh5.app.controller.switchTo("nokia.mh5.maps.AboutPage"+(f.android_webview||
f.ios_webview?"Native":""),null,{intoView:".terms"}):nokia.mh5.win.open("http://m.maps.nokia.com/tnc.html","_blank")}},infoBubbleParams:void 0,positionStatus:"uninitialized",isReady:!1,addressLookup:!0,dontBind:!0,initPositioning:function(a){var b=this,c=b._map,d=nokia.mh5.utils.getLocalStorageValue("mh5-isFirstTime");if(!this.passive&&"buttonClicked"!==a&&("uninitialized"===this.positionStatus||"unavailable"===this.positionStatus))d&&JSON.parse(d)&&nokia.mh5.jsonp("http://maps.nokia.com/services/iplookup/get?NORD&callback",
function(a){if("available"!==b.positionStatus&&!a.error&&!a.errors)c.zoom=6,c.moveTo(a.location)}),this.positionStatus="requesting",c.position.activate(function(a){this.positionStatus="available";if(this.moveToUserPosition)c.zoom=c.MAX_ZOOM_LEVEL-4,c.moveTo(a)}.bind(this),function(a){this.positionStatus=1==a.code?"denied":"unavailable";if(!c.center||!c.center.longitude||!c.center.latitude)c.zoom=e}.bind(this))},positionStatusDidChange:function(a){var b=this.positionButton&&this.positionButton.root;
if(b)if("available"===a)nokia.mh5.dom.removeClass(b,"missing"),nokia.mh5.dom.addClass(b,"available");else if("unavailable"===a)nokia.mh5.dom.addClass(b,"missing"),nokia.mh5.dom.removeClass(b,"available"),this._map.tracking=!1;if(this.onPositionStatusChange)this.onPositionStatusChange(a)},_onPositionLost:function(){this.positionStatus="unavailable"},_setupMap:function(){var b=this.root,c=this._map;c.tileLang=nokia.mh5.l10n.tileLanguageMap[f.language.substr(0,2)];c.offset=function(a){var b=0,c=0;do b+=
a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{top:c,left:b}}(b);c.size={width:b.offsetWidth,height:b.offsetHeight};Object.defineProperty(this,"pois",{set:function(a){var b=this.getPois();0<b.length&&this.removePoi(b);if(a&&0<a.length)for(var b=0,c=a.length;b<c;b++)this.createPoi(a[b].mapIcon||nokia.mh5.utils.place.getCategoryIcon(a[b]),a[b])},get:function(){return this.getPois()}});d.watch(nokia.mh5.components.settings.current,"mapSchema",this,function(a){if(this.schema!==a)this.schema=
a});this._onMapLongPress=this._onMapLongPress.bind(this);this._onPoiClick=this._onPoiClick.bind(this);this._onPositionLost=this._onPositionLost.bind(this);(b=this.listeners)&&nokia.mh5.each(b,function(b,e){a.add("ready"==e?this:c,e,b.bind(this))},this);a.add(c,"mapmoveend",c.save);a.add(c,"mapclick",function(a){a.defaultPrevented||this.hideInfoBubble()}.bind(this));a.add(c,"maplongpress",this._onMapLongPress);a.add(c,"poiclick",this._onPoiClick);a.add(c,"positionlost",this._onPositionLost)},passiveDidChange:function(a){this.zoomButtons.visible=
!o()&&!a;this.positionButton&&(this.positionButton.visible=!a);this.settingsButton&&(this.settingsButton.visible=!a);nokia.mh5.dom[a?"addClass":"removeClass"](this.root,"mh5_passive");if(f.android_webview)!a&&this.visible?nokia.mh5.components.Map.active=this:a&&delete nokia.mh5.components.Map.active},_onSchemaChange:function(a){var b=this._map,c=this._server;if(c&&"normal.day"===a)try{c.getBoundingBox(function(a){if(null!==a)b.tileServer=c})}catch(e){}else b.tileServer=null;if(nokia.mh5.components.settings.current.mapSchema!==
a)nokia.mh5.components.settings.current.mapSchema=a},_prepareAPI:function(){function a(c,e,d){var f={get:function(){return b[e]}};if(d)f.set=function(a){b[e]=a;"schema"===e&&c._onSchemaChange(a)};d=c[e];Object.defineProperty(c,e,f);d&&(c[e]=d)}var b=this._map;a(this,"position");a(this,"route",!0);a(this,"center",!0);a(this,"box",!0);a(this,"offset",!0);a(this,"geometry",!0);a(this,"schema",!0);a(this,"size",!0);a(this,"zoom",!0);a(this,"tracking",!0);a(this,"apiKey",!0);a(this,"tileServer",!0);a(this,
"shape",!0);this.moveTo=b.moveTo;this.geoToPoint=b.geoToPoint;this.pointToGeo=b.pointToGeo;this.save=b.save;this.restore=b.restore;this.move=b.move},createPoi:function(a,b){var c=this._map.createPoi(a,b);if(b.placeId)c.placeId=b.placeId;if(b.href)c.href=b.href;this._pois.push(c);return c},removePoi:function(a){this._map.removePoi(a);if(a)for(var a=[].concat(a),b=0,c;b<a.length;b++)c=this._pois.indexOf(a[b]),~c&&this._pois.splice(c,1);else this._pois=[]},addPoi:function(a){this._map.addPoi(a);this._pois=
this._pois.concat(a)},getPois:function(a,b){if(a){var c=this.comparePOIs,e=this._pois.filter(function(b){return c(b,a)});return a.placeId||b?e[0]:e}return this._pois},_onPoiClick:function(a){var b=a.data[0];b.infoBubble?(a=b.image,nokia.mh5.event.fire(a,"down",{offsetX:b.clickedPoint.x+a.width/2,offsetY:b.clickedPoint.y+a.height/2})):a.defaultPrevented||(b.isPosition?this.addressLookup&&(this.hideInfoBubble(),this._triggerReverseGeoCoding(b)):b.data.name?(this.hideInfoBubble(),this.showInfoBubble(b)):
this._triggerReverseGeoCoding(b))},_onMapLongPress:function(a){if(this.addressLookup&&!a.defaultPrevented)this.hideInfoBubble(),a.data.renderOnly=!0,this._triggerReverseGeoCoding(a.data)},_triggerReverseGeoCoding:function(a){var b=this,c=nokia.mh5.adapters.Search,e=a.data||a,d;c.reverseGeoCode(e,{appId:this.appId,appCode:this.appCode},function(f){e.renderOnly&&(d=b.infoBubbleParams?nokia.mh5.extend({renderOnly:!0},b.infoBubbleParams):{content:["title"],maxWidth:245,renderOnly:!0},delete e.renderOnly);
c.merge(e,f);b.hideInfoBubble();b.showInfoBubble(a,d)})},constructor:function(d,g){var n;this.getPoi=this.getPois;this.infoBubbles=[];this._pois=[];this._layer={};this.resize=this.resize.bind(this);this._orientationOrResizeHappened=0;var j,l;if(d){if(d.listeners)j=d.listeners,delete d.listeners;if(d.infobubble||d.infoBubble){if(d.infobubble)d.infoBubble=d.infobubble;this.infoBubbleParams=d.infoBubble;delete d.infoBubble}}h.constructor.call(this,d,g);this.appId=this.appId||nokia.mh5.appId;this.appCode=
this.appCode||nokia.mh5.appCode;if(!this.appId||!this.appCode)throw Error(c("Error.applicationCredential"));if(j)this.listeners=d.listeners=j;j=this.root;f.android&&nokia.mh5.dom.addEvent(j,"mousemove",function(a){a.stopPropagation();a.preventDefault()},!0);n=this._map=new b.Map(j,j.offsetWidth||10,j.offsetHeight||10),j=n;j.apiKey={appId:this.appId,appCode:this.appCode};this._cartoPOI=new b.CartoPOI(this,j);f.offlineStorageSupported&&(this._server=new b.SQLTileServer({apiKey:j.apiKey}));e=this._map.MIN_ZOOM_LEVEL;
(!d||null==d.suggestions||d.suggestions)&&!this.passive&&this._cartoPOI.activate();this.prepareBindings();this.prepareDidChangeNotifications();if(!j.restore())j.center={latitude:52.52081,longitude:13.38855},j.zoom=e,this.moveToUserPosition=d&&d.hasOwnProperty("moveToUserPosition")?!!d.moveToUserPosition:!0;if(l=this.positionButton)a.add(j,"maptrackingstart",function(){nokia.mh5.dom.addClass(l.root,"tracking")}),a.add(j,"maptrackingend",function(){nokia.mh5.dom.removeClass(l.root,"tracking")});this._prepareAPI();
i(function(){this._setupMap();this.initPositioning();this.isReady=!0;a.fire(this,"ready")}.bind(this),0)},resize:function(){j(this._orientationOrResizeHappened);this._orientationOrResizeHappened=i(function(){var a=this.root,b=a.offsetWidth,a=a.offsetHeight;this._orientationOrResizeHappened=0;if(b&&a&&(b!==this._map.size.width||a!==this._map.size.height))this._map.size={width:b,height:a}}.bind(this),f.hideAddressBar.DELAY+50)},visibleDidChange:function(a){h.visibleDidChange.call(this,a);if(a){if(nokia.mh5.dom.addEvent(nokia.mh5.win,
"viewportchange",this.resize,!1),this.resize(),f.android_webview&&!this.passive)nokia.mh5.components.Map.active=this}else nokia.mh5.dom.removeEvent(nokia.mh5.win,"viewportchange",this.resize,!1),f.android_webview&&nokia.mh5.components.Map.active===this&&delete nokia.mh5.components.Map.active},showInfoBubble:function(a,b){b=b||this.infoBubbleParams||{content:["title"],maxWidth:245};if(!a.infoBubble){if(!b.listeners&&this.infoBubbleParams&&this.infoBubbleParams.listeners)b.listeners=this.infoBubbleParams.listeners;
a.infoBubble=!0;var c=this._map,e=this,d;e._infoBubbleAnimationTimerId&&(l(e._infoBubbleAnimationTimerId),delete e._infoBubbleAnimationTimerId);b.maxWidth=Math.max(e._map.size.width-50,245);if(!b.parent)b.parent=e;a.image?a.originalImage=a.image:(d=c.createPoi(nokia.mh5.doc.createElement("CANVAS"),a),d.locationX=a.locationX,d.locationY=a.locationY,d.infoBubble=!0,delete d.data.infoBubble,a=d);d=new nokia.mh5.components.InfoBubble(a.data,b,function y(d){if(a.infoBubble)20>c.size.width?i(function(){y(d)},
5):(a.image=d,"privilegeLevel"in b?a.privilegeLevel=b.privilegeLevel:a.privileged=!0,a.scale=0.7,e._infoBubbleAnimationTimerId=m(function(a){a.scale+=0.2;if(0.9<a.scale&&(l(e._infoBubbleAnimationTimerId),delete e._infoBubbleAnimationTimerId,a.scale=1,!b.renderOnly)){var f=c.geoToPoint(c.center),g=c.geoToPoint(a),h=f.x,a=f.y,i=g.x,g=g.y,j=c.size,o=j.width/2,n=d.width/2,m=h+o,h=h-o,o=i-n,i=i+n;o<h?f.x-=h+16-o:m<i&&(f.x+=i+16-m);o=j.height/2;n=d.height;m=a+o;h=a-o;o=g-n;i=g+n;o<h?f.y-=h+16-o:m<i&&(f.y+=
i+16-m);c.moveTo(c.pointToGeo(f))}},40,a))});d.poi=a;e.infoBubbles.push(d)}},hideInfoBubble:function(a){var b;if(a)Array.isArray(a)||(a=[a]);else{if(0===this.infoBubbles.length)return;a=this.infoBubbles;this.infoBubbles=[]}for(var c=0,e=a.length;c<e;c++)b=a[c],this.infoBubbles.splice(this.infoBubbles.indexOf(b),1),b=b.poi,delete b.infoBubble,b.originalImage?(b.image=b.originalImage,delete b.originalImage,b.privileged=!1):this._map.removePoi(b)},addLayer:function(a,b){var c=this._map,e=[].concat(c.layer||
[]);if(0>e.indexOf(a))c.layer=e.concat(a),"string"==typeof b&&(this._layer[b]=c.layer[c.layer.length-1])},removeLayer:function(a){var b,c,e=[].concat(this._map.layer||[]);switch(typeof a){case "string":if("function"==typeof(b=this._layer[a]))if(~(b=e.indexOf(b)))e.splice(b,1),e.length?(this._map.layer=e,delete this._layer[a]):(this._map.layer=null,this._layer={});break;case "function":if(~(b=e.indexOf(a)))if(e.splice(b,1),e.length)for(c in this._map.layer=e,this._layer){if(this._layer[c]==a){delete this._layer[c];
break}}else this._map.layer=null,this._layer={}}},hasLayer:function(a){return"string"==typeof a&&"function"==typeof this._layer[a]||"function"==typeof a&&~[].concat(this._map.layer||[]).indexOf(a)?!0:!1},comparePOIs:function(a,b){return a.placeId?a.placeId===b.placeId:a.latitude===b.latitude&&a.longitude===b.longitude},covers:function(a){var b=this.box,c=this.geoToPoint,e=c(b[0]),d=c(b[1]);return!a.some(function(a){a=c(a);return a.x<e.x||a.x>d.x||a.y<e.y||a.y>d.y})},storeTiles:function(a){var b=this._server;
if(b)return b=b.storeBoundingBox(this._map,a&&a.box),a&&a.callback&&(b.onprogress=a.callback),a&&!a.hold&&b.start(),b},showStoredTiles:function(a,b){var c=this._map,e=this._server;e?e.getBoundingBox(function(d,f,g){d?(c.tileServer=e,c.box=d,c.zoom=f,c.schema=g,a&&a(d,f,g)):b&&b()}):b&&b()},removeStoredTiles:function(){this._server&&this._server.removeBoundingBox()}}});nokia.mh5.provide("nokia.mh5.components.RouteListItem");
nokia.mh5.components.RouteListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){var c=nokia.mh5.i18n;return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,c){h.constructor.call(this,a,c);this.update()},update:function(){var a;a=this.first&&" mh5_maneuver_start"||this.last&&" mh5_maneuver_end"||"";var f="";this.waypoint?(nokia.mh5.dom.addClass(this.root," mh5_pt"),f=0<=this.action.indexOf("Walk")?" mh5_pt_walk":" mh5_pt_tube",a='<div class="mh5_pt_waypoint'+a+'"><div><\!--waypoint icon--\></div>'+
("<div>"+this.waypoint+"</div>"),a+="</div>",this.last||(a+='<div class="mh5_pt_line" style="background-color:'+this.color+'"></div>',nokia.mh5.dom.addClass(this.root,f),a=a+'<div class="mh5_pt_action"><div><\!--action icon--\></div>'+("<div>"+this.action+"</div>"),a+="</div>"),this.root.innerHTML=a):((this.first||this.last)&&(this.iconIndex=0),a="<div>"+('<div class="mh5_ListItem_icon'+a+'"></div>'),this.distance&&(a+="<div>"),a+='<div class="mh5_ListItem_name">'+this.instruction+"</div>",this.distance&&
(a+='<div class="mh5_ListItem_address">'+c("followFor")+" <span>"+nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem)+"</span></div>"),this.root.innerHTML=a+"</div></div>",this.root.firstChild.firstChild.style.backgroundPositionX=-3.6*this.iconIndex+"rem")}}});nokia.mh5.provide("nokia.mh5.adapters.Route");
(function(){function h(a){return!a.length||2>a.length?[]:a.map(function(b,c){var e=!c,d=c===a.length-1,f=d?/\.?\s*The trip takes.*<\/span>/:/\s*<span class="distance-description">.*<\/span>/,h=d&&a[c-1].shape?a[c-1].shape.slice(-2):b.shape,i=b.instruction.match(/<span class="direction">(\w+)<\/span>/),o=c&&!("action"in a[c-1])&&"forward"==b.direction,y=b.instruction.slice(0,4).toLowerCase();if("bear"==y&&i&&i[1])b.direction=y+(i[1].charAt(0).toUpperCase()+i[1].slice(1));return{action:e&&"depart"||
d&&"arrive"||!o&&b.direction,direction:d&&i&&i[1],instruction:b.instruction.replace(f,""),first:e,last:d,iconIndex:"action"in b?g[b.action]:g[b.direction],distance:b.length,latitude:b.position.latitude,longitude:b.position.longitude,shape:h&&h.reduce(function(a,b,c,e){return c%2?a:a.concat([{latitude:b,longitude:e[c+1]}])},d?[{latitude:h[h.length-2],longitude:h[h.length-1]}]:[])}})}function c(a){if(!a.length||2>a.length)return[];a[0].name=e;a[a.length-1].name=o;return a.map(function(c,e){var f,g=
"",h,i=0===e,o=e===a.length-1;f=i||o?d[i?0:2]+'<span class="mh5_pt_highlight">'+c.name+"</span>":"<span>"+d[1]+c.name+"</span>";if(!o)if(g=b[c.action],0===c.action){if((h=a[e+1])&&(h.name||h.line))g+='<span class="mh5_pt_highlight">'+(h.name!=c.name||!h.line?h.name:h.line)+"</span>"}else 1===c.action&&(g=0<=g.indexOf("{0}")?g.replace("{0}",'<span class="mh5_pt_highlight">'+(c.line||"")+"</span>"):g,g+='<span class="mh5_pt_highlight">'+c.direction+"</span><br>",g+='<span class="mh5_pt_light">For '+
c.stops+" stops</span>");return{waypoint:f,wIconIndex:0,action:g,aIconIndex:0,first:i,last:o,duration:c.duration,color:c.color,latitude:c.position.latitude,longitude:c.position.longitude}})}function a(a,b,c,e){var d,f,g=b.mode,h=a[0],o=a[a.length-1];"pt"===g?(d="http://m.maps.nokia.com/releases/1.8.0/server/PublicTransport.php",f={slat:h.latitude,slon:h.longitude,dlat:o.latitude,dlon:o.longitude,date:(b.departure||new Date(Date.now()-6E4*(new Date).getTimezoneOffset()+9E5)).toISOString().substr(0,
19)},a="jsonp"):(d="http://route.nlp.nokia.com/routing/6.2/calculateroute.json",f={token:b.appId,mode:[b.type||"fastest","drive"==g?"car":"pedestrian","traffic:"+("walk"==g||!1===b.traffic?"disabled":"enabled")].join(";"),routeattributes:"sh,bb,sm",maneuverattributes:"po,le,ac,di"+("walk"==g?",sh":""),instructionformat:"html",jsonAttributes:"33",departure:b.departure&&b.departure.toISOString()||"now"},a.forEach(function(a,b){f["waypoint"+b]=a.latitude+","+a.longitude}),b.features&&(f.mode+=";"+Object.keys(b.features).map(function(a){return a+
":"+b.features[a]}).join(",")),a="jsoncallback");d+="?"+nokia.mh5.utils.formatURLParams(f)+"&"+a;i&&i.cancel();i=nokia.mh5.jsonp(d,function(a){a.error?e&&e(a.error):c(a.response)},15E3)}var f=nokia.mh5.i18n,g={depart:0,departAirport:0,arrive:0,arriveAirport:0,arriveLeft:0,arriveRight:0,leftLoop:5,leftUTurn:3,sharpLeftTurn:11,leftTurn:9,slightLeftTurn:7,"continue":0,slightRightTurn:6,rightTurn:8,sharpRightTurn:10,rightUTurn:2,rightLoop:4,leftExit:17,rightExit:16,leftRamp:19,rightRamp:18,leftFork:21,
middleFork:1,rightFork:20,leftMerge:15,rightMerge:14,nameChange:1,trafficCircle:48,ferry:47,leftRoundaboutExit1:34,leftRoundaboutExit2:35,leftRoundaboutExit3:36,leftRoundaboutExit4:37,leftRoundaboutExit5:38,leftRoundaboutExit6:39,leftRoundaboutExit7:40,leftRoundaboutExit8:41,leftRoundaboutExit9:42,leftRoundaboutExit10:43,leftRoundaboutExit11:44,leftRoundaboutExit12:45,rightRoundaboutExit1:22,rightRoundaboutExit2:23,rightRoundaboutExit3:24,rightRoundaboutExit4:25,rightRoundaboutExit5:26,rightRoundaboutExit6:27,
rightRoundaboutExit7:28,rightRoundaboutExit8:29,rightRoundaboutExit9:30,rightRoundaboutExit10:31,rightRoundaboutExit11:32,rightRoundaboutExit12:33,forward:0,uTurnRight:2,bearRight:4,lightRight:6,right:8,hardRight:10,uTurnLeft:3,bearLeft:5,lightLeft:7,left:9,hardLeft:11},d=["<span>"+f("RA.departFrom")+"</span> ","Station ","<span>"+f("RA.arriveAt")+"</span> "],b=["<span>"+f("RA.walkTo")+"</span> ","<span>"+f("take")+"</span> {0} <span>"+f("towards")+"</span> "],e="Start",o="",i;nokia.mh5.adapters.Route=
{fetch:function(b,d,g,i,p){var x,B,C=function(a){var b=a&&a.route&&(a.route[0]?a.route[0]:a.route),e="pt"==d.mode?c:h;if(b&&b.shape&&b.shape.length){a=b.summary;b={box:a.bbox||b.boundingBox&&[b.boundingBox.topLeft,b.boundingBox.bottomRight]||b.shape,shape:b.shape,summary:{distance:a.distance||0,time:a.trafficTime||a.baseTime},maneuvers:e(b.maneuvers||Array.prototype.concat.apply([],b.leg.map(function(a){return a.maneuver})),this.ename)};if(a.disclaimers)b.summary.disclaimers=a.disclaimers;g(b)}else E.call(a&&
a.error)},E=function(a){var b=d.mode;"timeout"===a?a=f("Notification.noRoutingService"):"pt"==b?"too near"===a?a=f("Notification.destInWalkingDistance"):"unavailable"===a&&(a=f("Notification.noPublicTransportService")):a||(b=f("Notification.noModeAvailable",{mode:f("RA."+b)}),a=b.charAt(0).toUpperCase()+b.slice(1));i(a||f("Notification.noRoutingService"))},y,F;if(Array.isArray(b)&&2<=b.length)x=b[0],B=b[b.length-1];else if(b&&b.hasOwnProperty("latitude")&&b.hasOwnProperty("longitude")&&d&&d.hasOwnProperty("latitude")&&
d.hasOwnProperty("longitude"))x=b,B=d,b=[x,B],d=g,g=i,i=p;else{i(f("Notification.error"));return}y=d.appId=d.appId||nokia.mh5.appId;F=d.appCode=d.appCode||nokia.mh5.appCode;i=i||function(){};if(!y||!F)throw Error(f("Error.applicationCredential"));if("pt"===d.mode)if(o=B.name,x.name)e=x.name;else var w=C,C=function(a){nokia.mh5.adapters.Search.reverseGeoCode(x,{appId:y,appCode:F},function(b){e=b.name;w.call(this,a)},E)};a(b,d,C,E)}}})();nokia.mh5.provide("nokia.mh5.components.Navigation");nokia.mh5.provide("nokia.mh5.ui.ImageDialog");
nokia.mh5.ui.ImageDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(h){var c=nokia.mh5.i18n;return{cssClass:"mh5_ImageDialog mh5_modal mh5_modalBg",children:["content","spinner","errorMessage","imageProviderText"],content:{control:nokia.mh5.ui.Control,rootHtmlElementName:"img",cssClass:"mh5_CarouselImage",visible:!1},spinner:{control:nokia.mh5.ui.Control,cssClass:"mh5_spinner_big_bright",visible:!0},errorMessage:{control:nokia.mh5.ui.Control,cssClass:"mh5_errorMessage",innerHTML:c("Notification.unableToLoadImage"),
visible:!1},imageProviderText:{control:nokia.mh5.ui.Control,cssClass:"mh5_imageProvider",visible:!1},constructor:function(a,c){a.closeOnTap=!0;h.constructor.call(this,a,c);var g=this,d=this.content.root,b=nokia.mh5.win.setTimeout(function(){nokia.mh5.dom.addClass(g.root,"mh5_loading")},50);d.onload=function(){nokia.mh5.win.clearTimeout(b);nokia.mh5.dom.removeClass(g.root,"mh5_loading");g.content.visible=!0;g.provider&&g._showimageProviderText(g.provider)};d.onerror=function(){nokia.mh5.win.clearTimeout(b);
nokia.mh5.dom.removeClass(g.root,"mh5_loading");g.errorMessage.visible=!0};d.src=a.src},_updatePosition:function(){h._updatePosition.call(this);this._updateTextPosition()},_updateTextPosition:function(){this.imageProviderText.root.style.top=this.content.root.offsetTop+this.content.root.offsetHeight+5+"px";this.imageProviderText.root.style.left=this.content.root.offsetLeft+"px"},_showimageProviderText:function(a){this.imageProviderText.root.innerHTML=c("source")+": "+a;this.imageProviderText.visible=
!0;this._updateTextPosition()}}});nokia.mh5.provide("nokia.mh5.ui.Carousel");
nokia.mh5.ui.Carousel=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){return{cssClass:"mh5_Carousel",hScroll:!0,hScrollbar:!1,visible:!0,imagePool:[],onClick:function(h){h=(h.hasOwnProperty("data")?h.data.target:null)||h.target;"IMG"===h.tagName&&new nokia.mh5.ui.ImageDialog({src:h.getAttribute("data-image-src"),provider:h.getAttribute("data-image-provider")||"Business Owner"})},imagePoolDidChange:function(h){if(!h||0===h.length)this.getContentRoot().innerHTML="",this.visible=!1;else{var c=
"",a=0;h.forEach(function(a){c+='<img src="'+a.thumbnailSrc+'" data-image-src="'+a.imageSrc+'" data-image-provider="'+(a.providerName?a.providerName:"")+'" draggable = "false" />'});h=this.getContentRoot();h.innerHTML=c;for(var f=h.children,g=this,h=f.length-1;0<=h;--h){var d=f[h];d.onerror=function(){this.parentNode&&this.parentNode.removeChild(this)};d.onload=function(){a=a++;++a===f.length-1&&g._scroll&&g._scroll.refresh()}}this.visible=!!c}}}});nokia.mh5.provide("nokia.mh5.components.PlaceDetails");
nokia.mh5.components.PlaceDetails=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){var c=nokia.mh5.i18n,a=[{name:c("eating"),value:"eating",cssClass:"eating"},{name:c("shopping"),value:"shopping",cssClass:"shopping"},{name:c("going-out"),value:"going-out",cssClass:"goingOut"},{name:c("sights"),value:"sights",cssClass:"sights"},{name:c("PT"),value:"public-transport",cssClass:"publicTransport"}],f=["summary","recommendations","legalNote"],g=nokia.mh5.platform,d=nokia.mh5.dom;return{control:nokia.mh5.ui.Container,
children:"summary,actions,images,ad,ownerContent,guides,reviews,spinner,recommendations,fillup,legalNote".split(","),layout:{type:nokia.mh5.ui.RowLayout},summary:{control:nokia.mh5.components.PlaceSummary},actions:{control:nokia.mh5.ui.Container,cssClass:"mh5_placeActions actions stretch mh5_standardBackgroundColorDark",layout:{type:nokia.mh5.ui.ColumnLayout},children:["dial","share","route","website","addFavourite"],dial:{control:nokia.mh5.ui.Button,cssClass:"button contact mh5_primaryColorDark",
disabled:!0,text:c("call"),onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"dial",a.place)}},share:{control:nokia.mh5.ui.Button,cssClass:"button share mh5_primaryColorDark",disabled:!0,onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"share",a.place)},text:c("share")},route:{control:nokia.mh5.ui.Button,cssClass:"button route mh5_primaryColorDark",disabled:!0,onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"route",a.place)},text:c("route")},website:{control:nokia.mh5.ui.Button,
cssClass:"button web mh5_primaryColorDark",disabled:!0,text:c("web"),target:"blank",onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"website",a.place)}},addFavourite:{control:nokia.mh5.ui.Button,cssClass:"button favourite mh5_primaryColorDark",disabled:!0,text:c("favourite"),onClick:function(){var a=this.parent.parent,e=a.place,f=this.root,h=this.parent.parent.parent.notification,j=this;nokia.mh5.components.favourites.get(e)?(nokia.mh5.components.favourites.remove(e),d.removeClass(f,
"saved"),f="removed",nokia.mh5.sso.isAuthenticated()?(h.text=c("FV.removedSignedIn"),h.visible=!0,setTimeout(function(){j.parent.parent.parent.notification.text=c("FV.syncedFavourites");j.parent.parent.parent.notification.visible=!0},3E3)):(h.text=c("FV.removedNotSignedIn"),h.visible=!0)):nokia.mh5.components.favourites.add(e)?(d.addClass(f,"saved"),f="added",nokia.mh5.sso.isAuthenticated()?(h.text=c("FV.addedSignedIn"),h.visible=!0,setTimeout(function(){j.parent.parent.parent.notification.text=c("FV.syncedFavourites");
j.parent.parent.parent.notification.visible=!0},3E3)):(h.text=g.android_webview?c("FV.addedNotSignedIn"):c("FV.addedNotSignedIn")+". "+c("FV.signInToSyncronize")+".",h.visible=!0)):f="failed2add";nokia.mh5.event.fire(a,"favourite",nokia.mh5.extend({},e,{status:f}))}}},images:{control:nokia.mh5.ui.Carousel,clear:function(){this.imagePool=[]}},ad:{control:nokia.mh5.ui.Control,visible:!1},ownerContent:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,clear:function(){this.root.innerHTML=
""}},guides:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,update:function(a){this.clear();if(a){for(var e="",f,g=0,h=a.length;g<h;g++)f="",a[g].providerUrl&&(f=d.createHyperlinkHTML({href:a[g].providerUrl,"class":"mh5_link",target:"_blank"},c("more"))),e+='<div class="mh5_guide">',e+=a[g].providerIcon?'<img class="mh5_icon" src="'+a[g].providerIcon+'">':"",e+="<div>",e+='<h2 class="title">'+a[g].providerName+"</h2>",e+=this.parent._formatDescription(a[g].description,
f),e+="</div>",e+="</div>";this.root.innerHTML='<div class="mh5_guides"><h1 class="mh5_title">'+c("guides")+"</h1>"+e+"</div>";this.visible=!0}},clear:function(){this.root.innerHTML="";this.visible=!1}},reviews:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,update:function(a){this.clear();if(a){for(var e="",f,g=0,h=a.length;g<h;g++){f="";e+='<div class="mh5_review">';e+='<img class="mh5_icon" src="'+a[g].providerIcon+'">';e+="<div>";e+="<h2>"+(a[g].title||
this.parent.place.name)+"</h2>";if(a[g].ratingValue){var l=new nokia.mh5.ui.Rating;l.value=a[g].ratingValue;e+=l.root.outerHTML}a[g].url&&(f=d.createHyperlinkHTML({href:a[g].url,"class":"mh5_link",target:"_blank"},c("more")));e+=this.parent._formatDescription(a[g].description,f);e+='<p class="mh5_reviewFooter">Posted'+(a[g].userName?" by "+a[g].userName:"")+" on "+a[g].date+"</p>";e+="</div>";e+="</div>"}this.root.innerHTML='<div class="mh5_reviews"><h1 class="mh5_title">'+c("reviews")+"</h1>"+e+
"</div>";this.visible=!0}},clear:function(){this.root.innerHTML="";this.visible=!1}},spinner:{control:nokia.mh5.ui.Control,visible:!1,innerHTML:"<div class='mh5_spinner_big_dark'></div>",cssClass:"mh5_spinnerContainer"},recommendations:{control:nokia.mh5.ui.Container,cssClass:"mh5_nearby_places",layout:{type:nokia.mh5.ui.RowLayout},children:["title","categoryToggle","categoryToggleBorder","indicator","list"],visible:!1,indicator:{control:nokia.mh5.ui.Control,cssClass:"mh5_recommendationIndicator mh5_primaryBorderColorBright",
innerHTML:"<div></div>"},title:{control:nokia.mh5.ui.Control,rootHtmlElementName:"h1",cssClass:"mh5_title",innerHTML:c("nearbyPlaces"),visible:!1},categoryToggle:{control:nokia.mh5.ui.SegmentedButton,cssClass:"mh5_nearbyCategoryToggle mh5_ColumnLayout mh5_primaryColorBright",items:a,onValueChange:function(a){var c=this.parent,d=c.parent,f=this.root.querySelector(".mh5_selected"),f=Math.round(f.offsetLeft+f.offsetWidth/2);d._selectedNearbyCategory=a;c.list.items=d.place&&d.place.recommendations?nokia.mh5.components.favourites.favouritize(d.place.recommendations[a]):
[];c.indicator.root.style[(g.ie?"ms":"webkit")+"Transform"]="translateX("+f+"px)";nokia.mh5.win.setTimeout(function(){d.resize(!0)},1)}},categoryToggleBorder:{control:nokia.mh5.ui.Control,cssClass:"mh5_primaryBackgroundColorBright"},list:{control:nokia.mh5.ui.List,visible:!1,itemClass:nokia.mh5.components.PlaceListItem,listeners:{tap:function(a){var c=a.data.item,d=this.getRootOwnerByClass(nokia.mh5.components.PlaceDetails),f={placeId:c.placeId,href:c.href,latitude:c.latitude,longitude:c.longitude,
address:c.address,category:c.category,icon:c.icon,name:c.name};c.placeId&&"pt"===c.placeId.substring(0,2)&&delete f.placeId;a=nokia.mh5.event.fire(d,"nearby",{place:f,index:a.data.index});if(!a.defaultPrevented)d.place=f}}}},fillup:{control:nokia.mh5.ui.Control,cssClass:"mh5_fillup"},legalNote:{control:nokia.mh5.ui.Container,rootHtmlElementName:"footer",cssClass:"mh5_RowLayout mh5_secondaryColorBright",innerHTML:"&copy; "+(new Date).getFullYear()+" Nokia",children:["ownerContentProvider","imageProviders"],
clear:function(){this.ownerContentProvider.clear();this.imageProviders.clear()},ownerContentProvider:{control:nokia.mh5.ui.Control,cssClass:"mh5_provider",innerHTML:"",clear:function(){this.innerHTML="";this.visible=!1}},imageProviders:{control:nokia.mh5.ui.Control,cssClass:"mh5_provider",innerHTML:"",clear:function(){this.innerHTML="";this.visible=!1}}},adapter:nokia.mh5.adapters.Search,cssClass:"mh5_PlaceDetails",constructor:function(a,e){var d,g,j,l,m,n,p,x;a||(a={});for(j=0;n=f[j];j++)if(n in
a)throw Error(c("Error.propertyCannotBeOverwritten",{name:n}));if(!a.hasOwnProperty("actions")||!0===a.actions)a.actions={};if(a.actions&&!a.actions.addFavourite)a.actions.addFavourite=null;h.constructor.call(this,a,e);if(this.customContent){d=[].concat(this.customContent);g=this.children;for(j=0;l=d[j];j++){m=l.control||nokia.mh5.ui.Control;m=new m(l,this);if(this[l.name])throw Error(c("Error.customContentNotAllowed",{name:l.name}));n=!this[l.name]&&l.name||"customContent"+(j+1);p=l.after&&g.indexOf(l.after);
x=p>=g.length-1;this[l.after&&x?"add":"insertBefore"](m,n,l.before||g[p+1])}}},build:function(){var a=this.parameters;Object.defineProperty(this,"parameters",{get:function(){return this._parameters},set:function(a){this._parameters={};nokia.mh5.each(a,function(a,b){this._parameters[b]="function"===typeof a?a.bind(this):a},this)}});if(a)this.parameters=a;g.ios&&d.addClass(this.root.firstChild.firstChild,"mh5_noFlicker");this.resize=this.resize.bind(this);h.build.call(this)},resize:function(a){var c=
this.getContentRoot(),f=c.parentNode,g=this._selectedNearbyCategory,h=this.recommendations.categoryToggle;c.offsetHeight>this.root.offsetHeight?d.addClass(f,"mh5_fillupDisable"):d.removeClass(f,"mh5_fillupDisable");this._scroll&&nokia.mh5.win.setTimeout(this._scroll.refresh,1);this.images&&this.images._scroll&&nokia.mh5.win.setTimeout(this.images._scroll.refresh,1);!a&&this.visible&&g&&h.select(g)},remove:function(a){if(~f.indexOf(a))throw Error(c("Error.unableToRemove",{name:a}));h.remove.call(this,
a)},_setContentData:function(a){var e="",f=this.legalNote,g,h;if(a.imageProviders){g=[];h=0;for(var l=a.imageProviders.length;h<l;h++)g.push(a.imageProviders[h].url?d.createHyperlinkHTML({href:a.imageProviders[h].url,target:"_blank"},a.imageProviders[h].name):a.imageProviders[h].name);if(f)f.imageProviders.root.innerHTML=c("imagesProvidedBy")+g.join(", "),f.imageProviders.visible=!0}a.extended&&nokia.mh5.each(a.extended,function(a){e+=this._renderSimpleContent(a.label,a.text)},this);e+=this._renderSimpleContent(c("PT"),
a.publicTransport);if(this.ownerContent){if(a.ownerContent&&(h=a.ownerContent,e+=this._renderOwnerContent(h),h.providerName&&f))g=h.providerName,h.providerUrl?(h=h.providerUrl,f.ownerContentProvider.root.innerHTML=c("contentProvidedBy")+d.createHyperlinkHTML({href:h,target:"_blank"},g)):f.ownerContentProvider.root.innerHTML=c("contentProvidedBy")+g,f.ownerContentProvider.visible=!0;this.ownerContent.visible=!!e;this.ownerContent.root.innerHTML=e}this.guides&&this.guides.update(a.premiumContent);this.reviews&&
this.reviews.update(a.reviews)},_setRecommendations:function(a){var c=!1,d=a.recommendations,f=this.recommendations,g=f.categoryToggle,h,m;if(d){g.select(null);nokia.mh5.each(g.items,function(a){if(d&&d[a.value]&&d[a.value].length){if(c=!0,delete a.disabled,void 0===h)h=a.value}else if(a.disabled=!0,this._selectedNearbyCategory===a.value)this._selectedNearbyCategory=void 0}.bind(this));g.update();if(void 0===this._selectedNearbyCategory&&h)this._selectedNearbyCategory=h;if("public-transport"===this._selectedNearbyCategory){g=
d[this._selectedNearbyCategory];for(m=0;m<g.length;m++)if(g[m].name===a.name){d[this._selectedNearbyCategory].splice(m,1);break}}f.visible=c;f.title.visible=c;f.list.visible=c;f.categoryToggle.visible=c;this.resize()}else f.visible=!1},showError:function(a){var e=this.fillup,d=this.actions,a="not found"===a?c("Notification.placeRemovedByOwner"):c("Notification.placeError");d&&["dial","share","route","website","favourite"].forEach(function(a){if(d[a])d[a].disabled=!0});if(e){if(e)e.root.innerHTML=
'<div class="mh5_error">'+a+"</div>"}else this._errorMessage=a},_formatDescription:function(a,c){return!a?"":'<p class="mh5_description">'+a.replace(/\n{2,}/g,'</p><p class="mh5_description">').replace(/\n/g,"<br>")+(c||"")+"</p>"},_renderSimpleContent:function(a,c){return!a||!c?"":'<div class="mh5_placeData"><h2 class="title">'+a+"</h2>"+this._formatDescription(c)+"</div>"},_renderOwnerContent:function(a){return!a?"":'<div class="mh5_ownerContent"><h1 class="mh5_title">'+c("placeDescription")+"</h1>"+
this._formatDescription(a)+"</div>"},vScroll:!0,bounce:!1,place:null,parameters:{},placeDidChange:function(a){delete this._errorMessage;var c=nokia.mh5.adapters.Search,d=this.adapter||c;this.update();a&&d.fetch(a,this.parameters,function(a){c.merge(this.place,a);this.update();nokia.mh5.event.fire(this,"done");if(!a.recommendations)this.spinner.visible=!0,c.getRecommendations(a,this.parameters,function(a){this.spinner.visible=!1;this._setRecommendations(a);this.resize()}.bind(this))}.bind(this),function(){this.showError.apply(this,
arguments);nokia.mh5.event.fire(this,"done")}.bind(this))},unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",update:function(){var a=this.place,c,f,g,h,l,m,n;if(a){this.summary.update(a);c=this.actions;f=a.phone;if(g=!!nokia.mh5.components.favourites.get(a))a.favourite=!0;if(this.images)this.images.imagePool=a.gallery;this.legalNote.clear();this._setContentData(a);this._setRecommendations(a);if(this.fillup)this.fillup.root.innerHTML="";if(c){h=c.dial;l=c.share;m=c.route;n=c.website;
c=c.addFavourite;if(h)h.link="tel:"+f,h.disabled=!f,h.update();if(l&&a.name&&(a.placeId||a.longitude&&a.latitude))l.disabled=!1,l.update();if(m&&a.name&&(a.placeId||a.longitude&&a.latitude))m.disabled=!1;if(n)n.link=a.website,n.disabled=!a.website,n.update();if(c){if(a.name&&(a.placeId||a.longitude&&a.latitude))c.disabled=!1;d[g?"addClass":"removeClass"](c.root,"saved")}}this.resize();nokia.mh5.event.fire(this,"update",a)}},visibleDidChange:function(a){h.visibleDidChange.call(this,a);a?(d.addEvent(nokia.mh5.win,
"viewportchange",this.resize,!1),this.resize(),this._errorMessage&&(nokia.mh5.event.fire(this,"error",{message:this._errorMessage}),delete this._errorMessage)):d.removeEvent(nokia.mh5.win,"viewportchange",this.resize,!1)},unitSystemDidChange:function(){this.recommendations&&this.recommendations.list.renderedItems&&this.recommendations.list.renderedItems.forEach(function(a){a.update&&a.update()})}}});nokia.mh5.provide("nokia.mh5.components.Search");
nokia.mh5.components.Search=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){function c(){var a=g.getLocalStorageValue("history");return a?JSON.parse(a):[]}var a,f,g=nokia.mh5.utils,d=function(a){return a.toLowerCase().charAt(0)===f.toLowerCase()},b=function(a){return 0<=a.toLowerCase().indexOf(f)};return{statics:{SEARCH_COMPLETION:{add:function(a){if(a){var b=c(),d=b.indexOf(a),d=~d&&b.splice(d,1)[0];100<b.unshift(d||a)&&b.pop();g.setLocalStorageValue("history",JSON.stringify(b))}},get:function(e,
g,h){var j=this.searchAdapter,l=this.parameters,m=l&&l.limit,n,p,e=e.trim();a&&clearTimeout(a);2<e.length&&j&&j.getSuggestions?a=setTimeout(function(){a=null;l.limit=h;j.getSuggestions(e,l,g);l.limit=m},200):(n=c(),f=e.toLowerCase(),m=e&&1==e.length&&n.filter(d),p=!(m&&m.length)&&b,g((p?n.filter(p):m||n).splice(0,h||4)))}}},children:["input","completion"],input:{control:nokia.mh5.ui.TextInput,type:"search"},cssClass:"mh5_Search",completion:{control:nokia.mh5.ui.List,cssClass:"mh5_SearchCompletion",
visible:!1,itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(a){return{rootHtmlElementName:"li",constructor:function(b,c){a.constructor.call(this,b,c);var d=RegExp(this.parent.parent.query.replace(/[#-.]|[\[-\^]|[?|{}\/]/g,"\\$&"),"i");this.root.innerHTML=nokia.mh5.utils.escapeHTML(this.text).replace(d,'<span class="mh5_secondaryColorBright">$&</span>')}}}),listeners:{tap:function(a){var b=this.parent;b.query=a.data.item.text;b.input.blur();b.search()}}},searchAdapter:nokia.mh5.adapters.Search,
completionAdapter:nokia.mh5.components.Search.SEARCH_COMPLETION,parameters:{},constructor:function(a,b){this.searchAdapter=a.searchAdapter?a.searchAdapter:this.searchAdapter;this.completionAdapter=a.completionAdapter?a.completionAdapter:nokia.mh5.components.Search.SEARCH_COMPLETION;h.constructor.call(this,a,b)},build:function(){var a=nokia.mh5.event.add,b=this.input,c=this.query,d=this.parameters;Object.defineProperty(this,"parameters",{get:function(){return this._parameters},set:function(a){this._parameters=
{};nokia.mh5.each(a,function(a,b){this._parameters[b]="function"===typeof a?a.bind(this):a},this)}});if(d)this.parameters=d;Object.defineProperty(this,"query",{get:function(){return b.value},set:function(a){b.value=a}});if(c)this.query=c;this.completionAdapter&&nokia.mh5.ui.Control.watch(b,"value",this,this._updateCompletion);a(b,"submit",this.search.bind(this));a(b,"focus",this._onFocus.bind(this));a(b,"blur",this._onBlur.bind(this));h.build.call(this)},search:function(){var a=nokia.mh5.event.fire;
this.completion.visible=!1;this.query?(this.completionAdapter&&this.completionAdapter.add(this.query),a(this,"beforesearch",{query:this.query}).defaultPrevented||this.searchAdapter.search(this.query,this.parameters,function(b){a(this,"success",b)}.bind(this),function(b){a(this,"error",b)}.bind(this))):a(this,"clear")},_onFocus:function(){if(this.completionAdapter)this._updateCompletion(),this.completion.visible=!0},_onBlur:function(){var a=this.completion;a.visible&&setTimeout(function(){a.visible=
!1},nokia.mh5.platform.blackberry?1E3:250)},_updateCompletion:function(){var a=this.completion;this.completionAdapter.get.call(this,this.input.value,function(b){a.items=b.map(function(a){return{text:a}})},4)}}});nokia.mh5.provide("nokia.mh5.components.Route");
nokia.mh5.components.Route=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){var c=nokia.mh5.geolocation,a=nokia.mh5.i18n,f=a("currentLocation"),g=nokia.mh5.ui.Control.prototype.getRootOwnerByClass,d=new nokia.mh5.Class(nokia.mh5.ui.Control,function(){var a=nokia.mh5.dom.addClass,b=nokia.mh5.dom.removeClass;return{rootHtmlElementName:"li",innerHTML:"<div class='mh5_ListItem_name'>"+f+"</div><div></div>",update:function(c){var d=this.root.lastChild;switch(c){case "active":b(d,"mh5_spinner","mh5_hidden");
a(d,"mh5_position_available");break;case "waiting":b(d,"mh5_position_available","mh5_hidden");a(d,"mh5_spinner");break;default:b(d,"mh5_spinner","mh5_position_available"),a(d,"mh5_hidden")}}}}),b;return{routeAdapter:nokia.mh5.adapters.Route,constructor:b=function(a,b){this.routeAdapter=a.routeAdapter?a.routeAdapter:this.routeAdapter;h.constructor.call(this,a,b)},build:function(){var a=this.parameters||{mode:"walk"},d=this.from,i=this.to,j=nokia.mh5.event,l=j.add,m=j.fire,n=this.inputs.from,p=this.inputs.to,
j=function(a){var d=g.call(this,b),e=p==a.target?"to":"from",h=d[e+"List"],a=a.data.results,i=0<a.length;(h.visible=i)?h.items=a:this.input.value=d[e]&&d[e].name||"from"==e&&c.available&&f||""},x=function(a){m(g.call(this,b),"error",a.data)};Object.defineProperties(this,{parameters:{enumerable:!0,get:function(){return this._routeParameters},set:function(a){this._routeParameters={};nokia.mh5.each(a,function(a,b){this._routeParameters[b]="function"===typeof a?a.bind(this):a},this);this.mode.button.select(this._routeParameters.mode);
this.route()}},from:{enumerable:!0,get:function(){return this._from},set:function(a){this._from=a;this.inputs.from.input.value=a&&a.name||"";this.route()}},to:{enumerable:!0,get:function(){return this._to},set:function(a){this._to=a;this.inputs.to.input.value=a&&a.name||"";this.route()}}});!a.mode&&(a.mode="walk");a&&(this.parameters=a);d&&(this.from=d);i&&(this.to=i);l(n,"beforesearch",function(a){if(a.data.query==f)a.preventDefault(),c.available?this.parent.parent.from={name:f,latitude:c.latitude,
longitude:c.longitude}:n.input.value=""});l(n,"success",j);l(n,"error",x);l(n,"clear",function(){var a=g.call(this,b);a.from&&a.from.name!=f&&c.available?a.from={name:f,latitude:c.latitude,longitude:c.longitude}:(a.from=void 0,m(a,"clear"))});l(p,"success",j);l(p,"error",x);l(p,"clear",function(){g.call(this,b).to=void 0;m(g.call(this,b),"clear")});l(c,"positionactivate",function(){var a=this.inputs.from,b=a.completion.renderedItems;""===a.input.value&&(this.from={name:f,latitude:c.latitude,longitude:c.longitude});
b.length&&b[0].update&&b[0].update("active")}.bind(this));l(c,["positionerror","positiondeactivate","positionlost"],function(){this.inputs.from.input.value==f&&(this.from=void 0)}.bind(this));h.build.call(this)},cssClass:"mh5_Route",children:["inputs","mode","fromList","toList"],inputs:{control:nokia.mh5.ui.Container,cssClass:"mh5_inputs",layout:{type:nokia.mh5.ui.ColumnLayout},children:["from","to"],from:{control:nokia.mh5.components.Search,completionAdapter:{get:function(a,b){var d=c.status,g="active"==
d||"waiting"==d;nokia.mh5.components.Search.SEARCH_COMPLETION.get.call(this,a,function(a){g&&a.unshift(f);b(a)},g?3:4)},add:function(a){a!=f&&nokia.mh5.components.Search.SEARCH_COMPLETION.add(a)}},completion:{itemsDidChange:function(a){var b=a.length&&a[0].text==f,g=c.status;b&&(a[0].itemClass=d);this.constructor.prototype.itemsDidChange.call(this,a);b&&this.renderedItems[0].update(g)}},input:{placeholder:a("from"),cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright"}},to:{control:nokia.mh5.components.Search,
input:{placeholder:a("to"),cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright"}}},mode:{control:nokia.mh5.ui.Container,children:["button"],button:{control:nokia.mh5.ui.SegmentedButton,cssClass:"mh5_SegmentedIconButton mh5_mode mh5_ColumnLayout",items:["drive","walk","pt"].map(function(a){return{iconClass:"mh5_icon_"+a,value:a}}),onValueChange:function(a){var c=g.call(this,b),d=c.parameters;if(d.mode!==a)d.mode=a,c.route()}}},fromList:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.components.PlaceListItem,
visible:!1,onClick:function(a){this.parent.from=this.items[a];this.visible=!1}},toList:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.components.PlaceListItem,visible:!1,onClick:function(a){this.parent.to=this.items[a];this.visible=!1}},route:function(){var a=nokia.mh5.event.fire,b=this,d=b.from&&b.from.name!=f&&b.from||c.available&&c.coords,g=b.to,h=b.parameters,m;if(d&&g&&(m=a(b,"beforeroute",{from:d,to:g,parameters:h}),!m.defaultPrevented))m=d.name==f&&delete d.name,b._from=b._from||{},b._from.latitude=
d.latitude,b._from.longitude=d.longitude,b.routeAdapter.fetch([d,g],h,function(c){a(b,"success",c)},function(c){a(b,"error",{message:c})}),m&&(d.name=f)}}});nokia.mh5.provide("nokia.mh5.components.IncidentDetails");
nokia.mh5.components.IncidentDetails=new nokia.mh5.Class(nokia.mh5.ui.Container,function(h){function c(a){return 10>a?"0"+a:a}function a(a){return a.toLocaleDateString()+" "+a.getHours()+":"+c(a.getMinutes())+":"+c(a.getSeconds())}var f=nokia.mh5.dom,g=nokia.mh5.i18n,d=nokia.mh5.win,b=[g("maps.Traffic.critical"),g("maps.Traffic.major"),g("maps.Traffic.minor")];return{control:nokia.mh5.ui.Container,children:["filler","title","data","fillup"],layout:{type:nokia.mh5.ui.RowLayout},filler:{control:nokia.mh5.ui.Control,
cssClass:"mh5_incidentDetailsFiller",onClick:function(){this.parent.visible=!1}},title:{control:nokia.mh5.ui.Container,cssClass:"mh5_incidentDetailsTitle mh5_standardBackgroundColorDark"},data:{control:nokia.mh5.ui.Container,cssClass:"mh5_incidentDetailsData"},fillup:{control:nokia.mh5.ui.Control,cssClass:"mh5_fillup"},cssClass:"mh5_IncidentDetails",build:function(){this.resize=this.resize.bind(this);h.build.call(this)},resize:function(){var a=this.getContentRoot();f[a.offsetHeight>this.root.offsetHeight?
"addClass":"removeClass"](a.parentNode,"mh5_fillupDisable");this._scroll&&d.setTimeout(this._scroll.refresh,1)},vScroll:!0,bounce:!1,incident:null,incidentDidChange:function(c){if(c){var f,h=c.icon,c=c.incident;f="<p>"+(g("maps.Traffic.incidentStartTime")+": "+a(c.startTime)+"<br>"+g("maps.Traffic.incidentEndTime")+": "+a(c.endTime)+"</p>");this.title.root.innerHTML=f;f="<div class='header'><img src='"+h+"'></img><h1 class='mh5_title'>"+c.type+"</h1></div>"+(c.origin?"<p>"+g("maps.Traffic.incidentDescription"+
(c.direction?"":"NoDirection"),{origin:c.origin,direction:c.direction})+"</p>":"");h=c.end?c.bidirectional?"maps.Traffic.incidentBidir":"maps.Traffic.incidentUnidir":"maps.Traffic.incidentAt";f+="<p>"+(c.start?g(h,{start:c.start,end:c.end})+"<br>":"")+c.description+"</p><p>"+g("maps.Traffic.criticalityTitle")+": "+b[c.criticality]+"</p>";this.data.root.innerHTML=f}else this.title.root.innerHTML="",this.data.root.innerHTML="";var j=this;d.setTimeout(function(){j.resize()},500)},visibleDidChange:function(a){a?
(f.addEvent(d,"viewportchange",this.resize,!1),this.resize()):f.removeEvent(d,"viewportchange",this.resize,!1);h.visibleDidChange.call(this,a)}}});nokia.mh5.provide("nokia.mh5.maps.NavigationDisclaimerDialog");
nokia.mh5.maps.NavigationDisclaimerDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(h){var c=nokia.mh5,a=c.i18n,f,g=c.ui.Container,d=c.ui.Control,b=c.ui.Button,e=c.event,o=c.platform,i=c.dom.query(".mh5_audio")[0],j;return{cssClass:"mh5_NavigationDisclaimerDialog mh5_modal mh5_modalBg",control:g,children:["contents"],contents:{control:g,layout:{type:c.ui.RowLayout},children:["header","content","buttonContainer"],header:{control:g,children:["headline"],cssClass:"mh5_dialogHeader",headline:{control:g,
rootHtmlElementName:"h1",cssClass:"mh5_title",innerHTML:a("maps.Nav.disclaimerTitle")+" <label>("+a("beta")+")</label>"}},content:{control:g,cssClass:"mh5_content",children:["instructions","successText","spinner"],instructions:{control:d,cssClass:"mh5_instructions mh5_primaryColorDark",innerHTML:"<ul><li>"+a("maps.Nav.disclaimerPoint1")+"</li><li>"+a("maps.Nav.disclaimerPoint2")+"</li><li>"+a("maps.Nav.disclaimerPoint3")+"</li><li>"+a("maps.Nav.disclaimerPoint4")+"</li></ul>"},successText:{control:d,
visible:!1,cssClass:"mh5_actionText",innerHTML:a("maps.Nav.success")},spinner:{control:d,visible:!1,cssClass:"mh5_spinner_big_bright"}},buttonContainer:{control:g,cssClass:"mh5_screenContainer",children:["buttons"],buttons:{control:g,cssClass:"mh5_buttonContainer",children:["cancelButton","downloadButton","startButton"],cancelButton:{control:b,cssClass:"mh5_Button mh5_textButton",text:a("cancel"),onClick:function(){f.visible=!1}},downloadButton:{control:b,cssClass:"mh5_Button mh5_textButton",text:a("maps.Nav.load")},
startButton:{control:b,cssClass:"mh5_Button mh5_textButton",visible:!1,text:a("maps.Nav.start"),onClick:function(){f._startJourney()}}}}},disableUpdatePosition:!0,allowScrolling:!0,build:function(){f=this;i&&i.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&~i.currentSrc.indexOf(c.components.settings.get("unitSystem")+"_audio.mp3")?(f._readyToStart(),f.contents.content.successText.visible=!1):e.add(f.contents.buttonContainer.buttons.downloadButton.root,"down",f._downloadAudio);h.build.call(this)},
_downloadAudio:function(){var a=f.contents.content,b=f.contents.buttonContainer.buttons.downloadButton,d=c.components.settings.get("unitSystem"),g=i&&!~i.currentSrc.indexOf(d+"_audio.mp3"),h=5;if(!i||g)g&&i.parentNode.removeChild(i),i=c.doc.createElement("audio"),i.src=o.android_webview?"http://m.maps.nokia.com/fw/audio/"+d+"_audio.mp3":c.assetsPath+"audio/"+d+"_audio.mp3",c.dom.addClass(i,"mh5_audio"),c.doc.body.appendChild(i);e.add(i,"canplaythrough",function C(){e.remove(i,"canplaythrough",C);
c.win.clearTimeout(j);f._readyToStart()});e.add(i,"error",function E(){h--?i.load():(e.remove(i,"error",E),h=5,f._showError())});j=c.win.setTimeout(f._showError,15E3);a.spinner.visible=b.disabled=!0;o.ios&&i.readyState===HTMLMediaElement.HAVE_NOTHING?i.load():i.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&f._readyToStart()},_showError:function(){var b=f.contents.content,d=f.contents.buttonContainer.buttons.downloadButton;b.spinner.visible=d.disabled=!1;d.text=a("retry");b.successText.root.innerHTML=
a("maps.Nav.tryAgain");b.successText.visible=!0;c.win.clearTimeout(j)},_readyToStart:function(){var a=f.contents.content,b=f.contents.buttonContainer.buttons;a.spinner.visible=b.downloadButton.visible=!1;a.successText.visible=b.startButton.visible=!0},_startJourney:function(){f._closeDialog();f.onFinish&&f.onFinish()}}});nokia.mh5.provide("nokia.mh5.app.commonLayout");
(function(h){var c=Math.PI,a=c/2,f=3*a,g,d=nokia.mh5.maps.analytics,b=function(a){var b,c;o(a);if(a==nokia.mh5.app.controller.current.page.details&&a!=a.parent._shadowDetails)b=a.parent.map,(c=b.getPois(a.place,!0))&&b.moveTo(a.getMapCenterToShowPoiInGap(c,-c.image.height/2))},e=function(a){var b=nokia.mh5.maps.analytics;b.log({gn:"infobubble:place details",c44:b.getPlaceId(a),v44:"~c44",c19:b.getContext(a),v19:"~c19",c32:"infobubble click",v32:"~c32",ev:"prodView",v34:a.ownerContent?"prime":"not prime"})},
o=function(a){"_resizeTimeout"in a&&(h.clearTimeout(a._resizeTimeout),delete a._resizeTimeout)},i=function(a){return this=="routeInfo"in a.data},j=nokia.mh5.dom,l=nokia.mh5.event,m=nokia.mh5.geolocation,n=nokia.mh5.i18n,p=nokia.mh5.platform,x=nokia.mh5.utils,B=nokia.mh5.components.settings,C=nokia.mh5.math,E=function(a,b,c,d,e){var c=d.geoToPoint(d.center),f=d.size.width/2,g=d.size.height/2,a=d.geoToPoint(a);return d.pointToGeo({x:c.x-(d.size.width/2-(f-(c.x-a.x))),y:c.y-(e.offsetTop+e.offsetHeight/
2-(g-(c.y-a.y)))+b})},y=n("currentLocation"),F={map:function(){return this.parent.parent.parent.parent.map}},w=function(b,d,e,h,i){g.beginPath();g.moveTo(28*b,d*(15+i));g.lineTo(b*(18+i+h),d*(15+i));g.arc(b*(18+i+h),d*(15+i+h),h,0<d?f:a,0<b?c:0,0<b*d);g.lineTo(b*(18+i),d*e)},A=function(b,d,e){var h=e.time,i=e.distance,t=B.current.unitSystem,q=b.size,j=b.geoToPoint(d),l=b.geoToPoint(b.box[0]),d={summary:e,latitude:d.latitude,longitude:d.longitude,routeInfo:!0,locationX:160>j.x-l.x&&j.x-l.x<q.width/
2?0:1,locationY:50>=q.height-(j.y-l.y)?1:0},e=nokia.mh5.extend({background:!1,renderOnly:!0,privilegeLevel:0},b.infoBubbleParams);i&&h?h=x.formatDistance(i,t)+", "+x.formatTime(h):(h=600*Math.ceil(h/600),h=Math.floor(h/3600)+"hr "+h/60%60+"min");var j=h,h=document.createElement("canvas"),m=l=0,n=0,i=Math.round(32/12),o=Math.round(16/12),p=Math.round(160/12),u=0,t=d.locationX,q=d.locationY,y,L;g=h.getContext("2d");n+=p+4.5;g.font="10pt Arial";g.textBaseline="bottom";g.fillStyle="rgb(255,255,255)";
u=Math.max(u,g.measureText(j||" ").width);m+=u+16;n=n-4.5+10;h.width=m+16;h.height=n+14;g.save();g.translate(t?0:16,q?0:14);p=o/2;u=i+p;y=m-u;L=n-u;g.fillStyle="rgba(0,15,26,0.85)";g.lineWidth=o;g.lineCap="round";g.moveTo(u,p);m=[y,p,y,u,i,f,0,m-p,L,y,L,i,0,a,u,n-p,u,L,i,a,c,p,u,u,u,i,c,f];n=0;for(o=m.length;n<o;)g.lineTo(m[n++],m[n++]),g.arc(m[n++],m[n++],m[n++],m[n++],m[n++]);g.fill();g.textBaseline="top";g.fillStyle="#FFFFFF";g.font="10pt Arial";g.fillText(j,l+8,3.5);g.restore();j=t?-1:1;l=q?-1:
1;g.translate(h.width*t,h.height*q);w(j,l,h.height,i,-1);g.strokeStyle="rgb(255,255,255)";g.stroke();w(j,l,h.height,i,0);g.lineTo(0,0);g.closePath();g.fillStyle="rgba(0,15,26,0.85)";g.fill();e.image=h;b.showInfoBubble(d,e)},z={control:nokia.mh5.components.IncidentDetails,visible:!1,detailsPoi:null,visibleDidChange:function(a,b){var c=this,d=c.parent,e=d.map;if(a)e.passive=!0,e.hideInfoBubble(e.infoBubbles.filter(i,!1)),c.detailsPoi=e.createPoi(c.incident.icon,c.incident),c.detailsPoi.privileged=!0,
h.setTimeout(function(){j.transition({node:c.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_bottom",toTransformClass:"mh5_transition_middle"},function(){j.removeClass(c.root,"mh5_transition_slide","mh5_transition_middle");e.moveTo(E(c.detailsPoi,-c.detailsPoi.image.height/2,c.getRootOwnerByClass(nokia.mh5.ui.Page),e,c.filler.root));h.setTimeout(function(){if(d.incidentDetails.visible)d.detailsClose.visible=!0},400)});c.constructor.prototype.visibleDidChange.call(c,
a,b)},0);else if(b){o(c);if(c.detailsPoi)e.removePoi(c.detailsPoi),c.detailsPoi=null;d.detailsClose.visible=!1;h.setTimeout(function(){j.transition({node:c.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_middle",toTransformClass:"mh5_transition_bottom"},function(){c.constructor.prototype.visibleDidChange.call(c,a,b);j.removeClass(c.root,"mh5_transition_slide","mh5_transition_bottom");if(c===d.incidentDetails){e.passive=!1;var f=c.parent.model.selection;if(f){var f=e.getPois(f,
!0),g=nokia.mh5.extend({renderOnly:!0,left:f.data.icon},e.infoBubbleParams);g.content=["title","description"];e.showInfoBubble(f,g)}}})},0)}else c.constructor.prototype.visibleDidChange.call(c,a,b)}},u=new nokia.mh5.Class(nokia.mh5.ui.Control,function(){return{rootHtmlElementName:"li",cssClass:"noresults"}});nokia.mh5.app.commonLayout={pages:["search","route","share","favourites"],controller:nokia.mh5.app.controller,search:{children:"header,map,traffic,detailsClose,list,details,incidentDetails,notification".split(","),
layout:{type:nokia.mh5.ui.RowLayout},model:{query:"",data:[],selection:null,searchCenter:null,reset:function(){this.query="";this.data=[];this.searchCenter=this.selection=null}},adapter:nokia.mh5.adapters.Search,unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",onlineStatusBinding:"nokia.mh5.components.settings#current.isOnline",header:{control:nokia.mh5.ui.Container,layout:{type:nokia.mh5.ui.ColumnLayout,align:"stretch"},rootHtmlElementName:"header",cssClass:"mh5_baseBackgroundColor",
search:{control:nokia.mh5.components.Search,input:{cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright",placeholder:n("searchPlaces")},parameters:{map:function(){return this.parent.parent.map}},listeners:{beforesearch:function(){var a=this.parent.parent,b=a.model;b.reset();a.map.hideInfoBubble();b.searchCenter=a.map.center;b.query=this.query;a.details.visible=!1;a.incidentDetails.visible=!1;a.showNotification(B.get("isOnline")?n("searching")+"...":n("Notification.goOnline"))},
success:function(a){var b=a.data.results,a=a.data.box,c=this.parent.parent;c.resetNotification();0<b.length?(c.model.data=b,c.model.selection=b[0],c.map.hideInfoBubble(),c.map.showInfoBubble(c.map.getPois(b[0],!0)),c.map.box=a||b,nokia.mh5.app.controller.updateHistoryEntry(),c.map.save(),nokia.mh5.maps.analytics.log({gn:c.map.visible?"map:search results":"list:search results",c36:c.model.query,c37:c.model.data.length,v39:"+1",c32:"search performed",ev:"event14"})):c.map.visible&&c.showNotification(n("Notification.noResultFound"),
nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)},error:function(){var a=this.parent.parent;a.resetNotification();a.showNotification(n("Notification.searchProblem"))},clear:function(){var a=this.parent.parent,b=a.details;a.model.reset();a.map.hideInfoBubble();a.resetNotification();b.visible=!1}}}},detailsClose:{control:nokia.mh5.ui.Control,visible:!1,cssClass:"mh5_showDetails"},map:{control:nokia.mh5.components.Map,infoBubble:{content:["title"],listeners:{click:function(){var a=this.parent.parent,b=nokia.mh5.app.controller;
e(this.data);a.model.mapMode=!0;b.updateHistoryEntry();(this.data.incident?a.incidentDetails:a.details).visible=!0;b.pushHistoryEntry("search",a.getNavigationState(),a.getHash())}}},listeners:{poiclick:function(a){a=a.data[0];a.infoBubble||d.log({gn:"map:infobubble",c44:d.getPlaceId(a.data),v44:"~c44",c19:d.getContext(a.data),v19:"~c19",c32:"poi click",ev:"event47",v32:"~c32"});this.parent.model.selection=a.data;nokia.mh5.app.controller.updateHistoryEntry()},maplongpress:function(a){this.parent.model.selection=
a.data;nokia.mh5.app.controller.updateHistoryEntry()},mapclick:function(){var a=this.parent.model;if(a.selection)a.selection=null,nokia.mh5.app.controller.updateHistoryEntry()}}},traffic:{control:nokia.mh5.components.Traffic,visible:!1},list:{control:nokia.mh5.ui.List,visible:!1,cssClass:"mh5_List mh5_searchResults"},openDetailsTracking:function(a){var b=nokia.mh5.maps.analytics;b.log({gn:"list:place details",c44:b.getPlaceId(a),v44:"~c44",c19:b.getContext(a),v19:"~c19",c32:"list item click",v32:"~c32",
ev:"prodView",v34:a.ownerContent?"prime":"not prime"})},details:{control:nokia.mh5.components.PlaceDetails,visible:!1,customContent:{name:"mapoffset",cssClass:"mh5_PlaceDetailsMapOffset",before:"summary",onClick:function(){this.parent.visible=!1}},resize:function(){this.constructor.prototype.resize.apply(this,arguments);if(this.visible)o(this),this._resizeTimeout=h.setTimeout(b,1E3,this)},listeners:{dial:function(a){d.log({gn:"place:contact",c44:d.getPlaceId(a.data),v44:"~c44",c19:d.getContext(a.data),
v19:"~c19",c32:"place contact click",ev:"event21"})},nearby:function(a){var b=a.data.place,c=a.data.index,e=this.getRootOwnerByClass(nokia.mh5.ui.Page),f=e.map,g=e.model,c=this.recommendations.list.renderedItems[c];d.log({gn:"place:place",c44:d.getPlaceId(b),v44:"~c44",c19:d.getContext(b),v19:"~c19",c32:"open nearby place",v32:"~c32"});o(this);if(e.transitionBetweenDetails){if(!c.distance)c.distance=1,c.update();j.query(".mh5_ListItem_distance",c.root)[0].innerHTML='<span class="mh5_spinner"></span>'}a.preventDefault();
g.reset();0<f.getPois().length&&f.removePoi(e.map.getPois());g.data=[b];g.selection=b;nokia.mh5.app.controller.pushHistoryEntry("search",e.getNavigationState(),e.getHash())},share:function(a){d.log({gn:"place:share",c44:d.getPlaceId(a.data),v44:"~c44",c19:d.getContext(a.data),v19:"~c19",c32:"place share click",v32:"~c32",ev:"event22"});nokia.mh5.app.controller.updateHistoryEntry();nokia.mh5.app.controller.share({data:a.data,metadata:{}})},route:function(a){d.log({gn:"place:directions",c44:d.getPlaceId(a.data),
v44:"~c44",c19:d.getContext(a.data),v19:"~c19",c32:"place directions click",v32:"~c32",ev:"event24"});nokia.mh5.app.controller.route({from:m.available&&{name:y,latitude:m.latitude,longitude:m.longitude},to:a.data})},website:function(a){d.log({gn:"place:website",c44:d.getPlaceId(a.data),v44:"~c44",c19:d.getContext(a.data),v19:"~c19",c32:"place website click",v32:"~c32",ev:"event25"})},favourite:function(a){switch(a.data.status){case "added":d.log({gn:"place details",c32:"place added to favourites",
v32:"~c32",c44:d.getPlaceId(a.data),v44:"~v44"})}},error:function(a){this.parent.showNotification(a.data.message,nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)}},getMapCenterToShowPoiInGap:function(a,b){var c=this.getRootOwnerByClass(nokia.mh5.ui.Page);return E(a,b,c,c.map,c.details.mapoffset.root)},visibleDidChange:function(a,b){var c,d,e,f;a?(c=this.parent,d=c.map,e=this,d.passive=!0,d.hideInfoBubble(),c.traffic.hideIncidents(),d.removePoi(d.getPois()),f=d.createPoi(x.place.getCategoryIcon(e.place),
e.place),h.setTimeout(function(){j.transition({node:e.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_bottom",toTransformClass:"mh5_transition_middle"},function(){j.removeClass(e.root,"mh5_transition_slide","mh5_transition_middle");d.moveTo(e.getMapCenterToShowPoiInGap.call(e,f,-f.image.height/2));h.setTimeout(function(){c.details.visible&&j.removeClass(c.detailsClose.root,"mh5_hidden")},400)});e.constructor.prototype.visibleDidChange.call(e,a,b)},0)):b?(e=this,c=e.parent,
d=c.map,o(e),j.addClass(c.detailsClose.root,"mh5_hidden"),h.setTimeout(function(){j.transition({node:e.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_middle",toTransformClass:"mh5_transition_bottom"},function(){e.constructor.prototype.visibleDidChange.call(e,a,b);j.removeClass(e.root,"mh5_transition_slide","mh5_transition_bottom");if(e===c.details){d.passive=!1;var f=e.parent.model,g=f.selection;d.removePoi(d.getPois());f.data.forEach(function(a){d.createPoi(x.place.getCategoryIcon(a),
a)});B.get("trafficIncidentsEnabled")&&c.traffic.showIncidents();g&&d.showInfoBubble(!~f.data.indexOf(g)?g:d.getPois(g,!0),nokia.mh5.extend({renderOnly:!0},d.infoBubbleParams))}})},0)):this.constructor.prototype.visibleDidChange.apply(this,arguments)}},incidentDetails:z,notification:{control:nokia.mh5.ui.Notification,visible:!1},showNotification:function(a,b){var c=this.notification;c.text=a;c.timeout=b||nokia.mh5.ui.Notification.TIMEOUT_INFINITY;c.visible=!0},resetNotification:function(){var a=this.notification;
a.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT;a.visible=!1},build:function(){this.constructor.prototype.build.call(this);if(this.transitionBetweenDetails)this._shadowDetails=new nokia.mh5.components.PlaceDetails(nokia.mh5.app.layout.search.details),this._shadowDetails.parent=this;this.traffic.map=this.map},setModel:function(a){function b(){var c=e.parent.details,f;c.visible&&a.showDetails?(d.passive=!0,d.hideInfoBubble(),d.removePoi(d.getPois()),f=d.createPoi(x.place.getCategoryIcon(a.selection),
a.selection),d.moveTo(c.getMapCenterToShowPoiInGap(f,-f.image.height/2))):c.visible=!!a.showDetails}var c=this.model,d=this.map,e=this.details,f=a.searchCenter,g=c.searchCenter;if(a&&a.hasOwnProperty("mapMode"))this.mapMode=a.mapMode||a.showDetails;if(a.data&&c.data!==a.data)c.reset(),c.data=a.data;if(f&&(!g||g.longitude!=f.longitude||g.latitude!=f.latitude))d.center=c.searchCenter=a.searchCenter;if(a.query&&c.query!==a.query&&(c.query=a.query,!a.data&&this.header&&this.header.search))this.header.search.query=
a.query,this.header.search.search();if(!a.query&&a.selection&&c.selection!==a.selection)if(0>c.data.indexOf(a.selection)){if(this.header&&this.header.search)this.header.search.query="";c.reset();e.adapter.fetch(a.selection,null,function(a){c.data=[a];c.selection=a;d.zoom=17;b()},function(){c.selection=a.selection;b()})}else c.selection=a.selection,b();else if(a.selection&&c.selection!==a.selection)c.selection=a.selection,b();if(a.selection&&a.selection.longitude&&a.selection.latitude&&!e.visible)d.center=
a.selection;(c.selection&&a.showDetails||e.visible)&&b()},unitSystemDidChange:function(){this.list.update()},onlineStatusDidChange:function(a){if(this.header&&this.header.search){var b=this.header.search;if(a){if(this._onlinePlaceHolder)b.input.placeholder=this._onlinePlaceHolder;this.resetNotification()}else b.query="",this._onlinePlaceHolder=b.input.placeholder,b.input.placeholder=n("Notification.goOnlinePlaceHolder"),this.model.reset(),this.map.hideInfoBubble()}},onFavouritesChanged:function(a){if(a){var b=
this.map.getPois(a,!0),c=new Image;if(b)c.src=x.place.getCategoryIcon(a),b.infoBubble?b.originalImage=c:c.onload=function(){b.image=c},this.list.update()}},_updateDetails:function(a){var b=this;if(a.incident)b.incidentDetails.incident=a;else if(b.details.visible&&b._shadowDetails){var c=function(){var a=b.details;l.remove(b._shadowDetails,"done",c);b.getContentRoot().insertBefore(b._shadowDetails.root,a.root.nextSibling);b._shadowDetails._scroll.scrollToElement(a.parent.root);b.details=b._shadowDetails;
b.details._selectedNearbyCategory=a._selectedNearbyCategory;b._shadowDetails=a;b._shadowDetails.visible=!1;b.details.visible=!0};l.add(b._shadowDetails,"done",c);b._shadowDetails.place=a}else b.details.place=a},getNavigationState:function(){var a=this.constructor.prototype.getNavigationState.call(this);a.showDetails=this.details.visible;return a},visibleDidChange:function(a,b){this.constructor.prototype.visibleDidChange.call(this,a);nokia.mh5.ui.Control[a?"watch":"removeBinding"](nokia.mh5.components.favourites,
"changedFavourite",this,this.onFavouritesChanged);a&&this.details.visible?this.details.resize():o(this.details);a&&!b&&this.traffic.reloadIncidents()}},route:{model:{from:null,to:null,parameters:{mode:"walk"},selection:null,data:[],reset:function(){this.selection=this.to=this.from=null;this.data=[]}},children:"header,map,traffic,maneuversContainer,detailsClose,incidentDetails,notification".split(","),layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,rootHtmlElementName:"header",
cssClass:"mh5_baseBackgroundColor",children:["route"],route:{control:nokia.mh5.components.Route,children:["inputs","border","mode","fromList","toList"],border:{control:nokia.mh5.ui.Control,cssClass:"mh5_border mh5_secondaryBackgroundColorDark"},inputs:{from:{parameters:F},to:{parameters:F}},mode:{children:["button","timetravel","toggle","go"],cssClass:"mh5_bottomPart",layout:{type:nokia.mh5.ui.ColumnLayout},timetravel:{control:nokia.mh5.ui.Container,cssClass:"mh5_box-flex1"},toggle:{control:nokia.mh5.ui.Button,
cssClass:"mh5_maneuvers",visible:!1,onClick:function(){var a=this.parent.parent.parent.parent.maneuversContainer,b={type:"fade",mode:a.visible?"out":"in",node:a.root,persistence:!0,callback:a.visible&&function(){a.visible=!1;j.removeClass(this.root,"mh5_ListMode");l.fire(nokia.mh5.win,"hideAddressBar")}.bind(this)};nokia.mh5.maps.analytics.log({gn:"directions:maneuvers",c32:a.visible?"close maneuvers":"show maneuvers",v32:"~c32"});j.doTransition(b);if(!a.visible)a.visible=!0,j.addClass(this.root,
"mh5_ListMode")},index:0},go:{control:nokia.mh5.ui.Button,cssClass:"mh5_navigation",visible:!1,onClick:function(){var a=this.getRootOwnerByClass(nokia.mh5.ui.Page),b=this.parent.parent;m.available&&5E4<C.pointDistance(m.coords,b.to)?(b=B.current.unitSystem,a.showNotification(n("Error.tooLongWalkingDistance",{maxWalkingDistance:("mi"==b?30:50)+b}))):(new nokia.mh5.maps.NavigationDisclaimerDialog({onFinish:function(){var b=this.from;nokia.mh5.app.controller.navigate(this.to,(!("name"in b)||b.name==
y)&&{shape:a.map.route,maneuvers:a.maneuversContainer.maneuvers.items});nokia.mh5.maps.analytics.log({gn:"disclaimer",c32:"start navigation",v32:"~c32"})}.bind(b)}),nokia.mh5.maps.analytics.log({gn:"directions:disclaimer",c32:"disclaimer shown",v32:"~c32"}))}}},fromList:{visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);if(a=this.parent.parent.parent)j[this.visible?"addClass":"removeClass"](a.notification.root,"mh5_listmode")}},toList:{visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,
a);if(a=this.parent.parent.parent)j[this.visible?"addClass":"removeClass"](a.notification.root,"mh5_listmode")}}}},map:{control:nokia.mh5.components.Map,addressLookup:!1,moveToUserPosition:!1,infobubble:{content:["title"],listeners:{click:function(){var a=nokia.mh5.app.controller,b=this.data;b.incident?(b=this.parent.parent,a.updateHistoryEntry(),b.incidentDetails.visible=!0,a.pushHistoryEntry("route",b.getNavigationState(),b.getHash())):b.routeInfo||(e(b),a.details(b))}}},listeners:{poiclick:function(a){var b=
a.data[0];this.parent.model.selection=b.data;nokia.mh5.app.controller.updateHistoryEntry();a.defaultPrevented||(a.preventDefault(),b.infoBubble||(this.hideInfoBubble(this.infoBubbles.filter(i,!1)),b.data.name?this.showInfoBubble(b):this._triggerReverseGeoCoding(b)))},maplongpress:function(a){this.parent.model.selection=a.data;nokia.mh5.app.controller.updateHistoryEntry();this.hideInfoBubble(this.infoBubbles.filter(i,!1));a.preventDefault()},mapclick:function(a){var b=this.parent.model;if(b.selection)b.selection=
null,nokia.mh5.app.controller.updateHistoryEntry();this.hideInfoBubble(this.infoBubbles.filter(i,!1));a.preventDefault()}},_triggerReverseGeoCoding:function(a){var b=this,c=nokia.mh5.adapters.Search,d=a.data;c.reverseGeoCode(d,{appId:this.appId,appCode:this.appCode},function(e){c.merge(d,e);b.showInfoBubble(a,void 0)})}},traffic:{control:nokia.mh5.components.Traffic,visible:!1},unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",onlineStatusBinding:"nokia.mh5.components.settings#current.isOnline",
unitSystemDidChange:function(){var a=this.model,b=this.map.infoBubbles.filter(i,!0)[0];b&&(this.map.hideInfoBubble(b),A(this.map,a.to,b.data.summary));this.maneuversContainer.maneuvers.renderedItems.forEach(function(a){a.update&&a.update()})},onlineStatusDidChange:function(a,b){a&&!1===b?this.resetNotification():b&&this.showNotification(n("Notification.goOnline"))},maneuversContainer:{children:["maneuvers","disclaimer"],control:nokia.mh5.ui.Container,cssClass:"mh5_ManeuversContainer",visible:!1,maneuvers:{control:nokia.mh5.ui.List,
cssClass:"mh5_List mh5_Maneuvers",itemClass:nokia.mh5.components.RouteListItem},disclaimer:{control:nokia.mh5.ui.Control,cssClass:"mh5_pt_disclaimer mh5_primaryColorBright",visible:!1}},detailsClose:{control:nokia.mh5.ui.Control,visible:!1,cssClass:"mh5_showDetails"},incidentDetails:z,notification:{control:nokia.mh5.ui.Notification,visible:!1},_pushSearchResultListToHistory:!0,cssClass:"mh5_Page mh5_RoutePage mh5_TrafficPage",build:function(){var a=l.add,b=l.remove,c=this,d=c.map,e=c.header.route.inputs,
f=e.from,g=e.to,O=f.input,o=g.input,D=c.header.route,e=m.status,w=function(){b(c.map.root,"down",this._inputBlurBound);b(c.maneuversContainer.maneuvers.root,"down",this._inputBlurBound)},x=function(b){var d=this,e=D.inputs,f=o==b.target?"to":"from",g="from"==f?"to":"from",h=d.value===y&&m.available;c.map.tracking=!1;e[g].visible=!1;j.removeClass(d.root.firstChild,h?"mh5_current":"mh5_"+f);this._inputBlurBound=this._inputBlurBound||function(){h=d.value===y&&m.available;e[g].visible=!0;d.value&&j.addClass(d.root.firstChild,
h?"mh5_current":"mh5_"+f);d.blur()};a(c.map.root,"down",this._inputBlurBound);a(c.maneuversContainer.maneuvers.root,"down",this._inputBlurBound)},H=function(a){c.incidentDetails.visible=!1;f==a.target&&a.data.query==y?(a.preventDefault(),g.visible=!0):B.get("isOnline")?c.showNotification(n("searching")+"..."):(a.preventDefault(),(g==a.target?f:g).visible=!0,c.showNotification(n("Notification.goOnline")))},z=function(a){var b="from"==(g==a.target?"to":"from")?"to":"from",a=0<a.data.results.length;
c.listMode=c.listMode||c.maneuversContainer.visible;c.resetNotification();if(a){if(c._pushSearchResultListToHistory)nokia.mh5.app.controller.pushHistoryEntry("route",c.getNavigationState(),c.getHash()),c._pushSearchResultListToHistory=!1;c.maneuversContainer.visible=!1}else c.showNotification("No results found",nokia.mh5.ui.Notification.TIMEOUT_DEFAULT),D.inputs[b].visible=!0},E=function(a){var b=D.toList==a.target?"to":"from",e=c.model;D.mode.toggle.visible=c.maneuversContainer.visible=c.listMode;
c.listMode=!1;j.addClass(D.inputs[b].input.root.firstChild,"mh5_"+b);D.inputs["to"==b?"from":"to"].visible=!0;c[b+"Poi"]&&d.removePoi(c[b+"Poi"]);c[b+"Poi"]=d.createPoi(nokia.mh5.assetsPath+"img/"+b+".png",a.data.item);c[b+"Poi"].privilegeLevel=1;if(!m.available)e[b]=D[b],e.parameters=D.parameters,nokia.mh5.app.controller.updateHistoryEntry()};c.constructor.prototype.build.call(this);a(O,"focus",x);a(O,"blur",w);a(o,"focus",x);a(o,"blur",w);a(f,"beforesearch",H);a(g,"beforesearch",H);a(f,"success",
z);a(g,"success",z);a(D,"beforeroute",function(a){var b=a.data,e=D.mode,f=this.inputs.from.input,g=this.inputs.to.input,h=b.from,q=b.to,i=b.parameters.mode,t=c.model;if("pt"==i)this.originalMapSchema=B.get("mapSchema"),B.set("mapSchema","normal.day.grey");else if(this.originalMapSchema)B.set("mapSchema",this.originalMapSchema),this.originalMapSchema=null;d.box=[h,q];d._map.route=[];d.hideInfoBubble();c.fromPoi&&d.removePoi(c.fromPoi);c.toPoi&&d.removePoi(c.toPoi);j.removeClass(f.root.firstChild,"mh5_from",
"mh5_current");j.removeClass(g.root.firstChild,"mh5_to");c.fromPoi=d.createPoi(nokia.mh5.assetsPath+"img/from.png",h);c.toPoi=d.createPoi(nokia.mh5.assetsPath+"img/to.png",q);c.fromPoi.privilegeLevel=c.toPoi.privilegeLevel=1;j.addClass(f.root.firstChild,h.name?"mh5_from":"mh5_current");j.addClass(g.root.firstChild,"mh5_to");t.from=h;t.to=q;t.parameters=b.parameters;c.visible&&nokia.mh5.app.controller.updateHistoryEntry();c.traffic&&c.traffic.reloadIncidents();"walk"==i&&5E4<C.pointDistance(h,q)?(b=
B.current.unitSystem,c.showNotification(n("Error.routeTooLong",{maxWalkingDistance:("mi"==b?30:50)+b})),e.toggle.visible=e.go.visible=!1,a.preventDefault()):c.showNotification(n("Notification.routeCalculation"))});a(D,"success",function(a){var b=this.parameters.mode,e=D.mode,f=D.inputs,a=a.data,g=c.model,q=d.infoBubbles.filter(i,!0)[0],t;t=a.shape;c.timeTraveling?c.showNotification(n("Notification.trafficInBeta"),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT):c.resetNotification();nokia.mh5.dom["pt"==
b&&a.summary.disclaimers?"addClass":"removeClass"](c.maneuversContainer.root,"mh5_pt_disclaimer");"pt"==b?(c.maneuversContainer.disclaimer.root.innerHTML=n("RA.disclaimer"),a.summary.disclaimers&&a.summary.disclaimers.forEach(function(a){c.maneuversContainer.disclaimer.root.innerHTML+=j.createHyperlinkHTML({href:a.link,target:"_blank"},a.name)}),c.maneuversContainer.disclaimer.visible=!!a.summary.disclaimers):c.maneuversContainer.disclaimer.visible="pt"==b;c.maneuversContainer.maneuvers.items=a.maneuvers;
e.toggle.visible=f.from.visible=f.to.visible=!0;h.setTimeout(function(){d._map.route=t},10);d.box=a.box||t;q&&d.hideInfoBubble(q);A(d,g.to,a.summary);c._pushSearchResultListToHistory=!0;nokia.mh5.maps.analytics.log({gn:"directions",c32:"route displayed",ev:"event26",c35:b,v35:"~c35"})});a(D,"error",function(a){var b=D.mode;nokia.mh5.dom.removeClass(c.maneuversContainer.root,"mh5_pt_disclaimer");b.toggle.visible=c.listMode||c.maneuversContainer.visible;b.go.visible=!1;D.inputs.from.visible=D.inputs.to.visible=
!0;c.maneuversContainer.disclaimer.visible=!1;c.showNotification(a.data.message||n("Notification.noRoutingService"),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT);c.maneuversContainer.maneuvers.items=[{itemClass:u}];c._pushSearchResultListToHistory=!0});a(D,"clear",function(){var a=D.inputs,b=D.mode,e=c.model;D.from||d.removePoi(c.fromPoi);D.to||d.removePoi(c.toPoi);d.route=[];var f=d.infoBubbles.filter(i,!0)[0];d.hideInfoBubble(f);c.maneuversContainer.maneuvers.items=[];a.from.visible=a.to.visible=!0;
b.go.visible=b.toggle.visible=!1;e.from=D.from;e.to=D.to;e.parameters=D.parameters;nokia.mh5.app.controller.updateHistoryEntry()});a(D.fromList,"tap",E);a(D.toList,"tap",E);a(m,"positionactivate",function(){var a=D.mode.go,b=!(p.android&&2.2>=p.android.version)&&"walk"==D.parameters.mode;D.to||c.resetNotification();if(!c.fromPoi)c.fromPoi=d.createPoi(nokia.mh5.assetsPath+"img/from.png",{latitude:m.latitude,longitude:m.longitude,name:y});c.fromPoi.privilegeLevel=1;O.value==y||""===O.value?(j.addClass(O.root.firstChild,
"mh5_current"),a.visible=b&&!!D.to&&5E4>C.pointDistance(m.coords,D.to)):a.visible=b&&!(!D.to||!D.from)});a(m,["positionerror","positionlost","positiondeactivate"],function(){D.mode.go.visible=!1;D.from||c.showNotification(n("Notification.cantFindLocation"))});nokia.mh5.ui.Control.watch(this.model,"selection",this,function(a){c.incidentDetails.incident=a&&a.incident?a:null});if(("inactive"==e||"waiting"==e||"error"==e)&&(!D.from||!D.from.latitude||!D.from.longitude))c.showNotification(n("Notification.lookingForCurrentPosition")),
("inactive"==e||"error"==e)&&m.activate();this.traffic.map=d},showNotification:function(a,b){var c=this.notification;c.timeout=b||nokia.mh5.ui.Notification.TIMEOUT_INFINITY;c.text=a;c.visible=!0},resetNotification:function(){var a=this.notification;a.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT;a.visible=!1},visibleDidChange:function(a,b){var c=this.header.route,d=c.inputs,e=d.from.input,f=e.root.firstChild,d=d.to.input.root.firstChild,g=this.map;nokia.mh5.maps.analytics.logIfVisible(this,{gn:"directions",
c32:"directions"});(g.visible=a)&&!b&&this.traffic.reloadIncidents();if(m.available&&(""===e.value||e.value==y)){if(!this.fromPoi)this.fromPoi=g.createPoi(nokia.mh5.assetsPath+"img/from.png",m.coords);this.fromPoi.privilegeLevel=1;e.value=y;j.addClass(f,"mh5_current")}else j.removeClass(f,"mh5_from","mh5_current"),j.removeClass(d,"mh5_to"),c.from&&j.addClass(f,"mh5_from"),c.to&&j.addClass(d,"mh5_to")},setModel:function(a){var b=this.header.route,c=this.model,d=this.map,e=this.traffic,f=l.add;if(a.traffic&&
!c.traffic)c.traffic=b.traffic=!0,c.parameters=b.parameters={mode:"drive"},B.isFirstTime=!1,f(m,"positionactivate",function(){d.zoom=11}),f(m,["positionerror","positionlost","positiondeactivate"],function(){d.zoom=9}),l.one(d,"ready",function(){e.enableTraffic()});if(!a.showDetails&&this.incidentDetails.visible)this.incidentDetails.visible=!1;this._pushSearchResultListToHistory=!0;b.fromList.visible=b.toList.visible=!1;b.inputs.from.visible=b.inputs.to.visible=!0;if(this.listMode)this.maneuversContainer.visible=
!0;f=function(){if(c.parameters!=a.parameters)c.parameters=b.parameters=a.parameters||b.parameters||{mode:"walk"};if(c.from!=a.from)c.from=b.from=a.from||b.from;if(c.to!=a.to)c.to=b.to=a.to||b.to;var d=b.inputs.from.input.value==y;b.inputs.from.input.value=c.from&&c.from.name||(m.available?y:"");c.from&&(d=b.inputs.from.input.value==y,j.addClass(b.inputs.from.input.root.firstChild,d?"mh5_current":"mh5_from"));c.to?(b.inputs.to.input.value=c.to.name||"",j.addClass(b.inputs.to.input.root.firstChild,
"mh5_to")):b.inputs.to.input.value=""};if(!1===d.isReady)l.one(d,"ready",f);else f()}},share:{children:["storyCreator"],model:{data:null},storyCreator:{control:nokia.mh5.connectors.story.StoryCreator},setModel:function(a){this.model.data=a.data;this.storyCreator.update(a.data)},visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);this.storyCreator.visible=a}},favourites:{children:["favourites"],cssClass:"mh5_Page mh5_FavouritePage",favourites:{control:nokia.mh5.connectors.favourites.FavouritesViewer},
visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);this.favourites.visible=a}}}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.components.PlaceTabletListItem");
nokia.mh5.components.PlaceTabletListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(c,a){h.constructor.call(this,c,a);this.update()},update:function(){var c,a=!(!this.distance||!this.ratingValue),f=/(\d+(\.\d+)?)(\w+)/;c=""+('<img src="'+nokia.mh5.utils.place.getCategoryIcon(this)+'"></img>');c=c+'<div class="mh5_RowLayout"><div class="mh5_ListItem_name">'+(!this.placeId&&this.name?this.name.split(",")[0]:this.name);
c+="</div>";this.address&&(c=c+'<div class="mh5_ListItem_address">'+(this.address.replace(/(.*?)\,\ (.*)/,'$1,<br><span class="mh5_ellipsis">$2</span>')+"</div>"));a&&(c+='<div class="mh5_ColumnLayout">');if(this.ratingValue)this._rating=this._rating||new nokia.mh5.ui.Rating,this._rating.value=this.ratingValue,c+=this._rating.root.outerHTML;this.distance&&(f=nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem).match(f),c+='<div class="mh5_ListItem_distance"><span>'+
f[1]+"</span>"+f[3]+"</div>");a&&(c+="</div>");this.root.innerHTML=c}}});nokia.mh5.provide("nokia.mh5.app.tabletLayout");
(function(){nokia.mh5.app.tabletLayout={search:{cssClass:"mh5_Page mh5_SearchPage",header:{children:["search"]},list:{layout:{type:nokia.mh5.ui.ColumnLayout},itemClass:nokia.mh5.components.PlaceTabletListItem,hScroll:!0,itemsDidChange:function(c){this.constructor.prototype.itemsDidChange.call(this,c);this.visible=0<c.length?!0:!1;this.parent.map.resize()},listeners:{tap:function(c){var c=c.data.item,a=this.parent,f=a.map,g=nokia.mh5.app.controller;a.model.selection!==c?(this.parent.model.selection=
c,g.updateHistoryEntry(),f.hideInfoBubble(),f.showInfoBubble(f.getPois(c,!0))):(a.details.visible=!0,g.pushHistoryEntry("search",a.getNavigationState(),a.getHash()),a.openDetailsTracking(c))}}},build:function(){nokia.mh5.app.commonLayout.search.build.call(this);var c=this.header;if(c&&c.search){var a=c.search.input,f=nokia.mh5.event.add;f(a,"focus",function(){this.map.tracking=!1;if(!this._mapTapEventHandler)this._mapTapEventHandler=function(){a.blur();if(nokia.mh5.platform.android){var c=document.createElement("input");
c.setAttribute("type","text");document.body.appendChild(c);setTimeout(function(){c.focus();setTimeout(function(){c.setAttribute("style","display:none;");document.body.removeChild(c)},5)},5)}},f(this.map.root,"down",this._mapTapEventHandler);f(this.map.root,"down",this._mapTapEventHandler);f(this.list.root,"down",this._mapTapEventHandler)}.bind(this));f(a,"blur",function(){nokia.mh5.event.remove(this.map.root,"down",this._mapTapEventHandler);nokia.mh5.event.remove(this.list.root,"down",this._mapTapEventHandler)}.bind(this))}nokia.mh5.ui.Control.watch(this.model,
"selection",this,function(a,c){var b=this.list;if(c){var e=b.items.indexOf(c);0<=e&&(nokia.mh5.dom.removeClass(b.renderedItems[e].root,"mh5_selected"),nokia.mh5.dom.removeClass(b.root,"mh5_selected"))}if(a){this._updateDetails(a);var f=b.items.indexOf(a);if(0<=f&&(nokia.mh5.dom.addClass(b.renderedItems[f].root,"mh5_selected"),nokia.mh5.dom.addClass(b.root,"mh5_selected"),b._scroll)){var e=b.root.offsetLeft,h=b.root.offsetWidth,j=e+h,l=b.renderedItems[f].root.offsetLeft,f=b.renderedItems[f].root.offsetWidth,
m=l+f,n=b._scroll.x;l+n<e?b.scrollTo(-l+f/2,0):m+n>j&&b.scrollTo(-l+h-3*f/2,0)}}});nokia.mh5.ui.Control.watch(this.model,"data",this,function(a,c){if(0<a.length)this.list.items=a,a.forEach(function(a){this.map.createPoi(nokia.mh5.utils.place.getCategoryIcon(a),a)}.bind(this));else if(c&&0!==c.length)this.list.items=[],nokia.mh5.components.Traffic.removeNonTrafficPois(this.map)})},onFavouritesChanged:function(c){nokia.mh5.app.commonLayout.search.onFavouritesChanged.call(this,c);c=this.list.items.indexOf(this.model.selection);
0<=c&&nokia.mh5.dom.addClass(this.list.renderedItems[c].root,"mh5_selected")},unitSystemDidChange:function(){nokia.mh5.app.commonLayout.search.unitSystemDidChange.call(this);var c=this.list;if(this.model.selection){var a=c.items.indexOf(this.model.selection);0<=a&&(nokia.mh5.dom.addClass(c.renderedItems[a].root,"mh5_selected"),nokia.mh5.dom.addClass(c.root,"mh5_selected"))}},visibleDidChange:function(c){nokia.mh5.app.commonLayout.search.visibleDidChange.apply(this,arguments);this.map.visible=c}}};
var h={};nokia.mh5.extendDeep(h,nokia.mh5.app.commonLayout);nokia.mh5.extendDeep(h,nokia.mh5.app.tabletLayout);h.controller=nokia.mh5.app.commonLayout.controller;nokia.mh5.app.tabletLayout=h})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.phoneLayout");
(function(){var h=nokia.mh5.i18n;nokia.mh5.app.phoneLayout={search:{children:"header,map,traffic,detailsClose,list,details,incidentDetails,noResults,notification".split(","),cssClass:"mh5_Page mh5_SearchPage",noResults:{cssClass:"mh5_noresults",control:nokia.mh5.ui.Control,innerHTML:'<div class="mh5_noresultstxt">'+h("Notification.noResult")+"</div>",visible:!1},mapMode:!0,mapModeDidChange:function(c,a){if(void 0!==a){var f=this,g=f.map,d=f.details,b=f.model,e=0<b.data.length?f.list:f.noResults,h=
{type:"fade",mode:f.mapMode?"out":"in",node:e.root,persistence:!0};if(f.header)nokia.mh5.dom[c?"removeClass":"addClass"](f.header.toggle.root,"mh5_ListMode");f.mapMode?(h.callback=function(){g.resize();e.visible=!1;if(f._showDetailsAfterListFading&&b.selection)d.visible=!0,f._showDetailsAfterListFading=!1},g.visible=!0,nokia.mh5.event.fire(nokia.mh5.win,"hideAddressBar",{},!0,!0)):(h.callback=function(){g.visible=!1},e.visible=!0);nokia.mh5.dom.doTransition(h)}},header:{children:["search","toggle"],
layout:{type:nokia.mh5.ui.ColumnLayout},search:{listeners:{clear:function(){nokia.mh5.app.commonLayout.search.header.search.listeners.clear.call(this);var c=this.parent.parent;if(!c.mapMode)c.mapMode=!0,c.header.toggle.visible=!1;nokia.mh5.app.controller.updateHistoryEntry()}}},toggle:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_modeToggle",visible:!1,onClick:function(){var c=this.parent.parent;nokia.mh5.maps.analytics.log({gn:c.mapMode?"map:list":"list:map",c32:c.mapMode?"list toggle":"map toggle",
v32:"~c32"});c.mapMode=!c.mapMode}}},list:{itemClass:nokia.mh5.components.PlaceListItem,itemsDidChange:function(c){this.constructor.prototype.itemsDidChange.call(this,c);var a=this.parent,f=a.header&&a.header.toggle,c=0<c.length;a.mapMode?f&&!a.details.visible&&(f.visible=c):(this.visible=c,a.noResults.visible=!c)},listeners:{tap:function(c){var c=c.data.item,a=this.parent,f=a.map,g=nokia.mh5.app.controller;if(a.model.selection!==c)a.model.selection=c,f.hideInfoBubble(),f.showInfoBubble(f.getPois(c,
!0));a.model.mapMode=!1;g.updateHistoryEntry();g.pushHistoryEntry("search",a.getNavigationState(),a.getHash());a._showDetailsAfterListFading=a.mapMode=!0;a.openDetailsTracking(c)}}},details:{visibleDidChange:function(c){var a=this.parent;if(a&&this!==a._shadowDetails){var f=a.header&&a.header.toggle;f&&(f.visible=!c&&0<a.model.data.length)}nokia.mh5.app.commonLayout.search.details.visibleDidChange.apply(this,arguments)}},incidentDetails:{visibleDidChange:function(c){var a=this.parent,f=a.header&&
a.header.toggle;if(f)f.visible=!c&&0<a.model.data.length;nokia.mh5.app.commonLayout.search.incidentDetails.visibleDidChange.apply(this,arguments)}},build:function(){nokia.mh5.app.commonLayout.search.build.call(this);var c=this.header;if(c&&c.search){var a=c.search.input,f=nokia.mh5.event.add;f(a,"focus",function(){this.map.tracking=!1;c.toggle.visible=!1;if(!this._mapTapEventHandler)this._mapTapEventHandler=function(){a.blur();if(nokia.mh5.platform.android){var c=document.createElement("input");c.setAttribute("type",
"text");document.body.appendChild(c);setTimeout(function(){c.focus();setTimeout(function(){c.setAttribute("style","display:none;");document.body.removeChild(c)},5)},5)}},f(this.map.root,"down",this._mapTapEventHandler)}.bind(this));f(a,"blur",function(){nokia.mh5.event.remove(this.map.root,"down",this._mapTapEventHandler);this._mapTapEventHandler=null;c.toggle.visible=!(!this.model.data.length&&this.mapMode||this.details.visible)}.bind(this))}nokia.mh5.ui.Control.watch(this.model,"data",this,function(a,
c){if(0<a.length)this.list.items=a,a.forEach(function(a){this.map.createPoi(nokia.mh5.utils.place.getCategoryIcon(a),a)}.bind(this));else if(c&&0!==c.length)this.list.items=[],nokia.mh5.components.Traffic.removeNonTrafficPois(this.map)});nokia.mh5.ui.Control.watch(this.model,"selection",this,function(a){a&&this._updateDetails(a)})},visibleDidChange:function(c){nokia.mh5.app.commonLayout.search.visibleDidChange.apply(this,arguments);if(this.mapMode)this.map.visible=c}}};h={};nokia.mh5.extendDeep(h,
nokia.mh5.app.commonLayout);nokia.mh5.extendDeep(h,nokia.mh5.app.phoneLayout);h.controller=nokia.mh5.app.commonLayout.controller;nokia.mh5.app.phoneLayout=h})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.configurator");
(function(){var h=nokia.mh5.resolve,c=nokia.mh5.components.settings,a=Object.prototype.hasOwnProperty,f={search:{searchAdapter:"header.search",placeholder:"header.search.input"}},g=["phone","tablet"],d=["from","to"];nokia.mh5.app.configure=function(b,e){var o,i,j,l,m=b.phoneLayout,n=b.tabletLayout,p=nokia.mh5.extendDeep,x=e.details&&e.details.customContent;e.distanceUnit&&c.set("unitSystem",e.distanceUnit);e.positionDisabled&&nokia.mh5.geolocation.disable();if(e.details&&(delete e.details.customContent,
j=m.search.details,l=n.search.details,p(j,e.details),p(l,e.details),x))j.customContent=[].concat(j.customContent).concat(x),l.customContent=[].concat(l.customContent).concat(x),e.details.customContent=x;if(a.call(e,"search")&&!e.search)m.search.header=n.search.header=null;if(e.map){e.map.schema&&c.set("mapSchema",e.map.schema);j=m.search.map;l=n.search.map;o=m.route.map;i=n.route.map;if(a.call(e.map,"positionButton")&&!e.map.positionButton)j.positionButton=l.positionButton=o.positionButton=i.positionButton=
null;if(a.call(e.map,"settingsButton")&&!e.map.settingsButton)j.settingsButton=l.settingsButton=o.settingsButton=i.settingsButton=null}if(e.route)for(j=0;l=g[j];j++)for(p=0;x=d[p];p++)if(i=e.route[x+"Placeholder"])o=b[l+"Layout"].route.header.route.inputs[x],o.input=o.input||{},o.input.placeholder=i;for(o in f)if(a.call(e,o)&&e[o])for(i in f[o])a.call(e[o],i)&&(j=h(f[o][i],m[o]),l=h(f[o][i],n[o]),j[i]=l[i]=e[o][i])}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.Application");
(function(){var h=nokia.mh5.i18n,c=nokia.mh5.components.settings;nokia.mh5.app.Application=new nokia.mh5.Class(function(){return{layouts:["phoneLayout","tabletLayout"],phoneLayout:nokia.mh5.app.phoneLayout,tabletLayout:nokia.mh5.app.tabletLayout,constructor:function(a){nokia.mh5.extendDeep(this,a);if(this.appId)nokia.mh5.appId=this.appId;if(this.appCode)nokia.mh5.appCode=this.appCode;if(!nokia.mh5.appId||!nokia.mh5.appCode)throw Error(h("Error.applicationCredential"));this.configuration&&nokia.mh5.app.configure(this,
this.configuration);var c=this.getLayout(),g=nokia.mh5.app.layout=this[c],d=nokia.mh5.app.controller=g.controller;d.manipulateUrl=a.manipulateUrl||!1;d.browserHistory=void 0===this.browserHistory?!0:this.browserHistory;this.hideAddressBar&&(nokia.mh5.dom.addEvent(nokia.mh5.win,"load",nokia.mh5.platform.hideAddressBar,!1),nokia.mh5.dom.addEvent(nokia.mh5.win,"hideAddressBar",nokia.mh5.platform.hideAddressBar,!1),nokia.mh5.dom.addEvent(nokia.mh5.win,"orientationchange",nokia.mh5.platform.hideAddressBar,
!1),nokia.mh5.event.fire(nokia.mh5.win,"orientationchange",{},!0,!0));d.domNode=this.domNode?nokia.mh5.doc.querySelector(this.domNode):nokia.mh5.doc.body;this.bindIsOnline();nokia.mh5.sso.init();nokia.mh5.dom.addClass(d.domNode,"mh5_app");nokia.mh5.dom.addClass(d.domNode,"mh5_"+c);"default"===nokia.mh5.platform.android.browser&&4<=nokia.mh5.platform.android.version&&nokia.mh5.dom.addClass(d.domNode,"mh5_android4");d.setConfiguration(g);if(!g.pages||!g.pages.length)throw Error("no pages are defined in "+
c);if(!~g.pages.indexOf(g.initialPage))g.initialPage=g.pages[0];d.switchTo(g.initialPage,this.startParams||{},{replaceLastHistoryEntry:!0});this.checkForOfflineMaps()},checkForOfflineMaps:function(){function a(a){c.set("hasOfflineMaps",!!a)}var f=nokia.mh5,g=f.app.controller.getMap(),d=g&&g.schema;f.platform.offlineStorageSupported?"normal.day"==d&&!c.current.isOnline&&g.showStoredTiles(a,a):setTimeout(a,0,0)},bindIsOnline:function(){function a(a){c.set("isOnline","online"==a.type)}c.set("isOnline",
nokia.mh5.win.navigator.onLine);nokia.mh5.win.addEventListener("online",a,!1);nokia.mh5.win.addEventListener("offline",a,!1)},getLayout:function(){return 1==this.layouts.length?this.layouts[0]:nokia.mh5.platform.phone?"phoneLayout":"tabletLayout"}}});nokia.mh5.app.embed=function(a){return new nokia.mh5.app.Application(a)}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.internals.LoginDialog");
nokia.mh5.internals.LoginDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(){return{allowScrolling:!0,content:{cssClass:"mh5_LoginDialog",control:nokia.mh5.ui.Control,rootHtmlElementName:"iframe",build:function(){this.root.src="http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/sso/login_frame.php"}}}});nokia.mh5.provide("nokia.mh5.xhr");
(function(){nokia.mh5.xhr=function(h){var c=new XMLHttpRequest,a=h.handler,f=h.errorHandler,g=h.uri;c.onreadystatechange=function(){if(4==c.readyState)if(c.status&&(200>c.status||299<c.status))f&&f(Error("nokia.mh5.xhr: Error while loading "+g+": "+c.statusText||"unknown error occured"));else if(a)try{var d;a:switch(h.handleAs){case "JSON":d=c.responseText?JSON.parse(c.responseText):{};break a;case "XML":d=c.responseXML||{};break a;default:d=c.responseText}a(d)}catch(b){f&&f(b)}};c.open(h.method||
"GET",g,!h.sync);h.headers&&nokia.mh5.each(h.headers,function(a,b){c.setRequestHeader(b,a)});if("withCredentials"in c)c.withCredentials=!0;c.send(h.payload||null)}})();nokia.mh5.provide("nokia.mh5.ui.ProgressBar");
nokia.mh5.ui.ProgressBar=new nokia.mh5.Class(nokia.mh5.ui.Control,function(h){return{rootHtmlElementName:"div",innerHTML:"<div class='left'></div><div class='right'></div><div class='overlay'><div><div class='left'></div><div class='right'></div></div></div>",cssClass:"mh5_ProgressBar",progressRatio:0,targetProgressRatio:0,progressIncrement:0.02,refreshTimeout:1E3/30,constructor:function(){h.constructor.apply(this,arguments);this.refresh=this.refresh.bind(this);this.update()},update:function(){this.refresh()},
setProgress:function(c){c=Math.min(1,c);this.targetProgressRatio=c=Math.max(0,c);this.refresh()},refresh:function(){var c=this.targetProgressRatio-this.progressRatio,a;if(c)a=Math.abs(c),a<=this.progressIncrement?this.progressRatio=this.targetProgressRatio:(c/=Math.abs(c),this.progressRatio+=c*this.progressIncrement,setTimeout(this.refresh,this.refreshTimeout)),this.updateProgressDOM()},updateProgressDOM:function(){var c=this.root.children[0],a=this.root.children[1],f=this.root.children[2],g=f.children[0],
d=c.clientWidth+a.clientWidth;f.style.width=this.progressRatio*(c.clientWidth+2*a.clientWidth)+"px";g.style.width=d+"px"}}});var mappings={search:"search",details:"search",route:"route"};
(function(h,c){function a(a){if(""===d)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return d+a}var f=Math,g=c.createElement("div").style,d=function(){for(var a="t,webkitT,MozT,msT,OT".split(","),b,c=0,d=a.length;c<d;c++)if(b=a[c]+"ransform",b in g)return a[c].substr(0,a[c].length-1);return!1}(),b=d?"-"+d.toLowerCase()+"-":"",e=a("transform"),o=a("transitionProperty"),i=a("transitionDuration"),j=a("transformOrigin"),l=a("transitionTimingFunction"),m=a("transitionDelay"),n=/android/gi.test(navigator.appVersion),
p=/iphone|ipad/gi.test(navigator.appVersion),x=/hp-tablet/gi.test(navigator.appVersion),B=a("perspective")in g,C="ontouchstart"in h&&!x,E=!!d,y=a("transition")in g,F="onorientationchange"in h?"orientationchange":"resize",w=C?"touchstart":"mousedown",A=C?"touchmove":"mousemove",z=C?"touchend":"mouseup",u=C?"touchcancel":"mouseup",v="Moz"==d?"DOMMouseScroll":"mousewheel",K;K=!1===d?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[d];var G=
function(){return h.requestAnimationFrame||h.webkitRequestAnimationFrame||h.mozRequestAnimationFrame||h.oRequestAnimationFrame||h.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),J=h.cancelRequestAnimationFrame||h.webkitCancelAnimationFrame||h.webkitCancelRequestAnimationFrame||h.mozCancelRequestAnimationFrame||h.oCancelRequestAnimationFrame||h.msCancelRequestAnimationFrame||clearTimeout,M=B?" translateZ(0)":"",x=function(a,d){var f=this,g;f.wrapper="object"==typeof a?a:c.getElementById(a);
f.wrapper.style.overflow="hidden";f.scroller=f.wrapper.children[0];f.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:n,hideScrollbar:p,fadeScrollbar:p&&B,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,
onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(g in d)f.options[g]=d[g];f.x=f.options.x;f.y=f.options.y;f.options.useTransform=E&&f.options.useTransform;f.options.hScrollbar=f.options.hScroll&&f.options.hScrollbar;f.options.vScrollbar=f.options.vScroll&&f.options.vScrollbar;f.options.zoom=f.options.useTransform&&f.options.zoom;f.options.useTransition=y&&f.options.useTransition;f.options.zoom&&
n&&(M="");f.scroller.style[o]=f.options.useTransform?b+"transform":"top left";f.scroller.style[i]="0";f.scroller.style[j]="0 0";f.options.useTransition&&(f.scroller.style[l]="cubic-bezier(0.33,0.66,0.66,1)");f.options.useTransform?f.scroller.style[e]="translate("+f.x+"px,"+f.y+"px)"+M:f.scroller.style.cssText+=";position:absolute;top:"+f.y+"px;left:"+f.x+"px";if(f.options.useTransition)f.options.fixedScrollbar=!0;f.refresh();f._bind(F,h);f._bind(w);C||"none"!=f.options.wheelAction&&f._bind(v);if(f.options.checkDOMChanges)f.checkDOMTime=
setInterval(function(){f._checkDOMChanges()},500)};x.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case w:if(!C&&0!==a.button)break;this._start(a);break;case A:this._move(a);break;case z:case u:this._end(a);break;case F:this._resize();break;case v:this._wheel(a);break;case K:this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&!this.zoomed&&!(this.animating||this.scrollerW==
this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)&&this.refresh()},_scrollbar:function(a){var d;if(this[a+"Scrollbar"]){if(!this[a+"ScrollbarWrapper"]){d=c.createElement("div");this.options.scrollbarClass?d.className=this.options.scrollbarClass+a.toUpperCase():d.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px");
d.style.cssText+=";pointer-events:none;"+b+"transition-property:opacity;"+b+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1");this.wrapper.appendChild(d);this[a+"ScrollbarWrapper"]=d;d=c.createElement("div");if(!this.options.scrollbarClass)d.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+b+"background-clip:padding-box;"+b+"box-sizing:border-box;"+("h"==a?
"height:100%":"width:100%")+";"+b+"border-radius:3px;border-radius:3px";d.style.cssText+=";pointer-events:none;"+b+"transition-property:"+b+"transform;"+b+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+b+"transition-duration:0;"+b+"transform: translate(0,0)"+M;this.options.useTransition&&(d.style.cssText+=";"+b+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");this[a+"ScrollbarWrapper"].appendChild(d);this[a+"ScrollbarIndicator"]=d}"h"==a?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,
this.hScrollbarIndicatorSize=f.max(f.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=f.max(f.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=
this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(a,!0)}else this[a+"ScrollbarWrapper"]&&(E&&(this[a+"ScrollbarIndicator"].style[e]=""),this[a+"ScrollbarWrapper"].parentNode.removeChild(this[a+"ScrollbarWrapper"]),this[a+"ScrollbarWrapper"]=null,this[a+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},n?200:0)},_pos:function(a,
b){if(!this.zoomed)a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[e]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+M:(a=f.round(a),b=f.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(a,b){var c="h"==a?this.x:this.y;if(this[a+"Scrollbar"])c*=this[a+"ScrollbarProp"],0>c?(this.options.fixedScrollbar||(c=this[a+"ScrollbarIndicatorSize"]+f.round(3*
c),8>c&&(c=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px"),c=0):c>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?c=this[a+"ScrollbarMaxScroll"]:(c=this[a+"ScrollbarIndicatorSize"]-f.round(3*(c-this[a+"ScrollbarMaxScroll"])),8>c&&(c=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px",c=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-c))),this[a+"ScrollbarWrapper"].style[m]="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?
"0":"1",this[a+"ScrollbarIndicator"].style[e]="translate("+("h"==a?c+"px,0)":"0,"+c+"px)")+M},_start:function(a){var b=C?a.touches[0]:a,c,d;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,a);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.zoom&&C&&1<a.touches.length)d=f.abs(a.touches[0].pageX-a.touches[1].pageX),
c=f.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDistStart=f.sqrt(d*d+c*c),this.originX=f.abs(a.touches[0].pageX+a.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=f.abs(a.touches[0].pageY+a.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,a);if(this.options.momentum&&(this.options.useTransform?(c=getComputedStyle(this.scroller,null)[e].replace(/[^0-9\-.,]/g,"").split(","),d=+c[4],c=+c[5]):(d=+getComputedStyle(this.scroller,
null).left.replace(/[^0-9-]/g,""),c=+getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),d!=this.x||c!=this.y))this.options.useTransition?this._unbind(K):J(this.aniTime),this.steps=[],this._pos(d,c),this.options.onScrollEnd&&this.options.onScrollEnd.call(this);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=b.pageX;this.pointY=b.pageY;this.startTime=a.timeStamp||Date.now();this.options.onScrollStart&&this.options.onScrollStart.call(this,a);
this._bind(A,h);this._bind(z,h);this._bind(u,h)}},_move:function(a){var b=C?a.touches[0]:a,c=b.pageX-this.pointX,d=b.pageY-this.pointY,g=this.x+c,h=this.y+d,i=a.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,a);if(this.options.zoom&&C&&1<a.touches.length)g=f.abs(a.touches[0].pageX-a.touches[1].pageX),h=f.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDist=f.sqrt(g*g+h*h),this.zoomed=!0,b=1/this.touchesDistStart*this.touchesDist*this.scale,
b<this.options.zoomMin?b=0.5*this.options.zoomMin*Math.pow(2,b/this.options.zoomMin):b>this.options.zoomMax&&(b=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/b)),this.lastScale=b/this.scale,g=this.originX-this.originX*this.lastScale+this.x,h=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[e]="translate("+g+"px,"+h+"px) scale("+b+")"+M,this.options.onZoom&&this.options.onZoom.call(this,a);else{this.pointX=b.pageX;this.pointY=b.pageY;if(0<g||g<this.maxScrollX)g=this.options.bounce?
this.x+c/2:0<=g||0<=this.maxScrollX?0:this.maxScrollX;if(h>this.minScrollY||h<this.maxScrollY)h=this.options.bounce?this.y+d/2:h>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=c;this.distY+=d;this.absDistX=f.abs(this.distX);this.absDistY=f.abs(this.distY);if(!(6>this.absDistX&&6>this.absDistY)){if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)h=this.y,d=0;else if(this.absDistY>this.absDistX+5)g=this.x,c=0;this.moved=!0;this._pos(g,h);this.dirX=0<c?-1:
0>c?1:0;this.dirY=0<d?-1:0>d?1:0;if(300<i-this.startTime)this.startTime=i,this.startX=this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,a)}}},_end:function(a){if(!(C&&0!==a.touches.length)){var b=this,d=C?a.changedTouches[0]:a,g,j,l={dist:0,time:0},m={dist:0,time:0},n=(a.timeStamp||Date.now())-b.startTime,o=b.x,p=b.y;b._unbind(A,h);b._unbind(z,h);b._unbind(u,h);b.options.onBeforeScrollEnd&&b.options.onBeforeScrollEnd.call(b,a);if(b.zoomed)o=b.scale*b.lastScale,
o=Math.max(b.options.zoomMin,o),o=Math.min(b.options.zoomMax,o),b.lastScale=o/b.scale,b.scale=o,b.x=b.originX-b.originX*b.lastScale+b.x,b.y=b.originY-b.originY*b.lastScale+b.y,b.scroller.style[i]="200ms",b.scroller.style[e]="translate("+b.x+"px,"+b.y+"px) scale("+b.scale+")"+M,b.zoomed=!1,b.refresh(),b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a);else{if(b.moved){if(300>n&&b.options.momentum){l=o?b._momentum(o-b.startX,n,-b.x,b.scrollerW-b.wrapperW+b.x,b.options.bounce?b.wrapperW:0):l;m=p?b._momentum(p-
b.startY,n,-b.y,0>b.maxScrollY?b.scrollerH-b.wrapperH+b.y-b.minScrollY:0,b.options.bounce?b.wrapperH:0):m;o=b.x+l.dist;p=b.y+m.dist;if(0<b.x&&0<o||b.x<b.maxScrollX&&o<b.maxScrollX)l={dist:0,time:0};if(b.y>b.minScrollY&&p>b.minScrollY||b.y<b.maxScrollY&&p<b.maxScrollY)m={dist:0,time:0}}if(l.dist||m.dist){l=f.max(f.max(l.time,m.time),10);if(b.options.snap)m=o-b.absStartX,n=p-b.absStartY,f.abs(m)<b.options.snapThreshold&&f.abs(n)<b.options.snapThreshold?b.scrollTo(b.absStartX,b.absStartY,200):(m=b._snap(o,
p),o=m.x,p=m.y,l=f.max(m.time,l));b.scrollTo(f.round(o),f.round(p),l)}else b.options.snap?(m=o-b.absStartX,n=p-b.absStartY,f.abs(m)<b.options.snapThreshold&&f.abs(n)<b.options.snapThreshold?b.scrollTo(b.absStartX,b.absStartY,200):(m=b._snap(b.x,b.y),(m.x!=b.x||m.y!=b.y)&&b.scrollTo(m.x,m.y,m.time))):b._resetPos(200)}else{if(C)if(b.doubleTapTimer&&b.options.zoom)clearTimeout(b.doubleTapTimer),b.doubleTapTimer=null,b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.zoom(b.pointX,b.pointY,1==b.scale?
b.options.doubleTapZoom:1),b.options.onZoomEnd&&setTimeout(function(){b.options.onZoomEnd.call(b,a)},200);else if(this.options.handleClick)b.doubleTapTimer=setTimeout(function(){b.doubleTapTimer=null;for(g=d.target;1!=g.nodeType;)g=g.parentNode;if("SELECT"!=g.tagName&&"INPUT"!=g.tagName&&"TEXTAREA"!=g.tagName)j=c.createEvent("MouseEvents"),j.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),j._fake=!0,g.dispatchEvent(j)},
b.options.zoom?250:0);b._resetPos(400)}b.options.onTouchEnd&&b.options.onTouchEnd.call(b,a)}}},_resetPos:function(a){var b=0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,c=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;if(b==this.x&&c==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)"webkit"==d&&(this.hScrollbarWrapper.style[m]="300ms"),
this.hScrollbarWrapper.style.opacity="0";if(this.vScrollbar&&this.options.hideScrollbar)"webkit"==d&&(this.vScrollbarWrapper.style[m]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(b,c,a||0)},_wheel:function(a){var b=this,c,d;if("wheelDeltaX"in a)c=a.wheelDeltaX/12,d=a.wheelDeltaY/12;else if("wheelDelta"in a)c=d=a.wheelDelta/12;else if("detail"in a)c=d=3*-a.detail;else return;if("zoom"==b.options.wheelAction){d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0));if(d<b.options.zoomMin)d=
b.options.zoomMin;if(d>b.options.zoomMax)d=b.options.zoomMax;d!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))}else{c=b.x+c;d=b.y+d;if(0<c)c=0;else if(c<b.maxScrollX)c=b.maxScrollX;if(d>b.minScrollY)d=b.minScrollY;else if(d<b.maxScrollY)d=b.maxScrollY;0>b.maxScrollY&&b.scrollTo(c,d,0)}},_transitionEnd:function(a){a.target==
this.scroller&&(this._unbind(K),this._startAni())},_startAni:function(){var a=this,b=a.x,c=a.y,d=Date.now(),e,g,h;if(!a.animating)if(a.steps.length){e=a.steps.shift();if(e.x==b&&e.y==c)e.time=0;a.animating=!0;a.moved=!0;a.options.useTransition?(a._transitionTime(e.time),a._pos(e.x,e.y),a.animating=!1,e.time?a._bind(K):a._resetPos(0)):(h=function(){var i=Date.now();if(i>=d+e.time)a._pos(e.x,e.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni();else if(i=(i-d)/
e.time-1,g=f.sqrt(1-i*i),i=(e.x-b)*g+b,a._pos(i,(e.y-c)*g+c),a.animating)a.aniTime=G(h)},h())}else a._resetPos(400)},_transitionTime:function(a){a+="ms";this.scroller.style[i]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[i]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[i]=a)},_momentum:function(a,b,c,d,e){var b=f.abs(a)/b,g=b*b/0.0012,h=0,h=0;0<a&&g>c?(c+=e/(6/(6.0E-4*(g/b))),b=b*c/g,g=c):0>a&&g>d&&(d+=e/(6/(6.0E-4*(g/b))),b=b*d/g,g=d);return{dist:g*(0>a?-1:1),time:f.round(b/6.0E-4)}},
_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,top:c}},_snap:function(a,b){var c,d,e;e=this.pagesX.length-1;for(c=0,d=this.pagesX.length;c<d;c++)if(a>=this.pagesX[c]){e=c;break}e==this.currPageX&&0<e&&0>this.dirX&&e--;a=this.pagesX[e];d=(d=f.abs(a-this.pagesX[this.currPageX]))?500*(f.abs(this.x-a)/d):0;this.currPageX=e;e=this.pagesY.length-1;for(c=0;c<e;c++)if(b>=this.pagesY[c]){e=
c;break}e==this.currPageY&&0<e&&0>this.dirY&&e--;b=this.pagesY[e];c=(c=f.abs(b-this.pagesY[this.currPageY]))?500*(f.abs(this.y-b)/c):0;this.currPageY=e;e=f.round(f.max(d,c))||200;return{x:a,y:b,time:e}},_bind:function(a,b){(b||this.scroller).addEventListener(a,this,!0)},_unbind:function(a,b){(b||this.scroller).removeEventListener(a,this,!0)},destroy:function(){this.scroller.style[e]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(F,h);this._unbind(w);this._unbind(A,
h);this._unbind(z,h);this._unbind(u,h);this.options.hasTouch||this._unbind(v);this.options.useTransition&&this._unbind(K);this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,b,c,d=0;b=0;if(this.scale<this.options.zoomMin)this.scale=this.options.zoomMin;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=f.round(this.scroller.offsetWidth*
this.scale);this.scrollerH=f.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=
this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];c=this.scroller.querySelectorAll(this.options.snap);for(a=0,b=c.length;a<b;a++)d=this._offset(c[a]),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,this.pagesX[a]=d.left<this.maxScrollX?this.maxScrollX:d.left*this.scale,this.pagesY[a]=d.top<this.maxScrollY?this.maxScrollY:
d.top*this.scale}else if(this.options.snap){for(this.pagesX=[];d>=this.maxScrollX;)this.pagesX[b]=d,d-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=d=0;for(this.pagesY=[];d>=this.maxScrollY;)this.pagesY[b]=d,d-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");
this._scrollbar("v");this.zoomed||(this.scroller.style[i]="0",this._resetPos(400))},scrollTo:function(a,b,c,d){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:c,relative:d}]);for(a=0,b=e.length;a<b;a++){if(e[a].relative)e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y;this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0})}this._startAni()},scrollToElement:function(a,b){var c;if(a=a.nodeType?a:this.scroller.querySelector(a))c=this._offset(a),c.left+=this.wrapperOffsetLeft,c.top+=this.wrapperOffsetTop,c.left=
0<c.left?0:c.left<this.maxScrollX?this.maxScrollX:c.left,c.top=c.top>this.minScrollY?this.minScrollY:c.top<this.maxScrollY?this.maxScrollY:c.top,b=void 0===b?f.max(2*f.abs(c.left),2*f.abs(c.top)):b,this.scrollTo(c.left,c.top,b)},scrollToPage:function(a,b,c){c=void 0===c?400:c;this.options.onScrollStart&&this.options.onScrollStart.call(this);if(this.options.snap)a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-
1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else{a*=-this.wrapperW;b*=-this.wrapperH;if(a<this.maxScrollX)a=this.maxScrollX;if(b<this.maxScrollY)b=this.maxScrollY}this.scrollTo(a,b,c)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(A,h);this._unbind(z,h);this._unbind(u,h)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(K):
J(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,b,c,d){var f=c/this.scale;if(this.options.useTransform)this.zoomed=!0,d=void 0===d?200:d,a=a-this.wrapperOffsetLeft-this.x,b=b-this.wrapperOffsetTop-this.y,this.x=a-a*f+this.x,this.y=b-b*f+this.y,this.scale=c,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[i]=d+"ms",this.scroller.style[e]=
"translate("+this.x+"px,"+this.y+"px) scale("+c+")"+M,this.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};g=null;"undefined"!==typeof exports?exports.iScroll=x:h.iScroll=x})(window,document);
